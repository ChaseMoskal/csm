(function t(e,i,s){function n(r,a){if(!i[r]){if(!e[r]){var l=typeof require=="function"&&require;if(!a&&l)return l(r,!0);if(o)return o(r,!0);var h=new Error("Cannot find module '"+r+"'");throw h.code="MODULE_NOT_FOUND",h}var u=i[r]={exports:{}};e[r][0].call(u.exports,function(t){var i=e[r][1][t];return n(i?i:t)},u,u.exports,t,e,i,s)}return i[r].exports}var o=typeof require=="function"&&require;for(var r=0;r<s.length;r++)n(s[r]);return n})({1:[function(t,e,i){"use strict";var s=t("tone");var n=function(){function t(t){var e=t.midiListener;var i=this;e.subscribe({onNote:function(t){return i.play(t)}});this.instrument=new s.PolySynth(6,s.Synth);this.instrument.set({oscillator:{type:"pwm",modulationFrequency:.4},envelope:{attack:.02,decay:.1,sustain:.2,release:.5}});this.instrument.toMaster()}t.prototype.play=function(t){var e=t.code,i=t.velocity,s=t.frequency;if(i>0)this.instrument.triggerAttack(s,undefined,i*2);else this.instrument.triggerRelease(s)};return t}();Object.defineProperty(i,"__esModule",{value:true});i.default=n},{tone:3}],2:[function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))(function(n,o){function r(t){try{l(s.next(t))}catch(t){o(t)}}function a(t){try{l(s["throw"](t))}catch(t){o(t)}}function l(t){t.done?n(t.value):new i(function(e){e(t.value)}).then(r,a)}l((s=s.apply(t,e||[])).next())})};var n=this&&this.__generator||function(t,e){var i={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},s,n,o;return{next:r(0),throw:r(1),return:r(2)};function r(t){return function(e){return a([t,e])}}function a(r){if(s)throw new TypeError("Generator is already executing.");while(i)try{if(s=1,n&&(o=n[r[0]&2?"return":r[0]?"throw":"next"])&&!(o=o.call(n,r[1])).done)return o;if(n=0,o)r=[0,o.value];switch(r[0]){case 0:case 1:o=r;break;case 4:i.label++;return{value:r[1],done:false};case 5:i.label++;n=r[1];r=[0];continue;case 7:r=i.ops.pop();i.trys.pop();continue;default:if(!(o=i.trys,o=o.length>0&&o[o.length-1])&&(r[0]===6||r[0]===2)){i=0;continue}if(r[0]===3&&(!o||r[1]>o[0]&&r[1]<o[3])){i.label=r[1];break}if(r[0]===6&&i.label<o[1]){i.label=o[1];o=r;break}if(o&&i.label<o[2]){i.label=o[2];i.ops.push(r);break}if(o[2])i.ops.pop();i.trys.pop();continue}r=e.call(t,i)}catch(t){r=[6,t];n=0}finally{s=o=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:true}}};var o=this;var r=t("midi-listener");var a=t("./Synth");(function(){return s(o,void 0,void 0,function(){var t,e,i,s,o;return n(this,function(i){switch(i.label){case 0:e=r.default.bind;s={};return[4,navigator.requestMIDIAccess()];case 1:t=new(e.apply(r.default,[void 0,(s.access=i.sent(),s)]));o=new a.default({midiListener:t});t.subscribe({onInputChange:function(t){return console.log("MIDI Input Change:",t.inputNames)},onMessage:function(t){return console.log("MIDI Message:",t)},onNote:function(t){return console.log(" - Note:",t)},onPad:function(t){return console.log(" - Pad:",t)},onPitchBend:function(t){return console.log(" - Pitch bend:",t)},onModWheel:function(t){return console.log(" - Mod wheel:",t)}});return[2]}})})})()},{"./Synth":1,"midi-listener":4}],3:[function(t,e,i){(function(t,i){if(typeof define==="function"&&define.amd){define(function(){return i()})}else if(typeof e==="object"){e.exports=i()}else{t.Tone=i()}})(this,function(){"use strict";var t;function e(e){t=e()}function i(e){e(t)}e(function(){function t(t){return typeof t==="undefined"}function e(t){return typeof t==="function"}var i;if(t(window.AudioContext)){window.AudioContext=window.webkitAudioContext}if(t(window.OfflineAudioContext)){window.OfflineAudioContext=window.webkitOfflineAudioContext}if(!t(AudioContext)){i=new AudioContext}else{throw new Error("Web Audio is not supported in this browser")}if(!e(AudioContext.prototype.createGain)){AudioContext.prototype.createGain=AudioContext.prototype.createGainNode}if(!e(AudioContext.prototype.createDelay)){AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode}if(!e(AudioContext.prototype.createPeriodicWave)){AudioContext.prototype.createPeriodicWave=AudioContext.prototype.createWaveTable}if(!e(AudioBufferSourceNode.prototype.start)){AudioBufferSourceNode.prototype.start=AudioBufferSourceNode.prototype.noteGrainOn}if(!e(AudioBufferSourceNode.prototype.stop)){AudioBufferSourceNode.prototype.stop=AudioBufferSourceNode.prototype.noteOff}if(!e(OscillatorNode.prototype.start)){OscillatorNode.prototype.start=OscillatorNode.prototype.noteOn}if(!e(OscillatorNode.prototype.stop)){OscillatorNode.prototype.stop=OscillatorNode.prototype.noteOff}if(!e(OscillatorNode.prototype.setPeriodicWave)){OscillatorNode.prototype.setPeriodicWave=OscillatorNode.prototype.setWaveTable}if(t(AudioNode.prototype._nativeConnect)){AudioNode.prototype._nativeConnect=AudioNode.prototype.connect;AudioNode.prototype.connect=function(e,i,s){if(e.input){if(Array.isArray(e.input)){if(t(s)){s=0}this.connect(e.input[s])}else{this.connect(e.input,i,s)}}else{try{if(e instanceof AudioNode){this._nativeConnect(e,i,s)}else{this._nativeConnect(e,i)}}catch(t){throw new Error("error connecting to node: "+e)}}}}var s=function(e,i){if(t(e)||e===1){this.input=this.context.createGain()}else if(e>1){this.input=new Array(e)}if(t(i)||i===1){this.output=this.context.createGain()}else if(i>1){this.output=new Array(e)}};s.prototype.set=function(e,i,n){if(this.isObject(e)){n=i}else if(this.isString(e)){var o={};o[e]=i;e=o}for(var r in e){i=e[r];var a=this;if(r.indexOf(".")!==-1){var l=r.split(".");for(var h=0;h<l.length-1;h++){a=a[l[h]]}r=l[l.length-1]}var u=a[r];if(t(u)){continue}if(s.Signal&&u instanceof s.Signal||s.Param&&u instanceof s.Param){if(u.value!==i){if(t(n)){u.value=i}else{u.rampTo(i,n)}}}else if(u instanceof AudioParam){if(u.value!==i){u.value=i}}else if(u instanceof s){u.set(i)}else if(u!==i){a[r]=i}}return this};s.prototype.get=function(i){if(t(i)){i=this._collectDefaults(this.constructor)}else if(this.isString(i)){i=[i]}var n={};for(var o=0;o<i.length;o++){var r=i[o];var a=this;var l=n;if(r.indexOf(".")!==-1){var h=r.split(".");for(var u=0;u<h.length-1;u++){var p=h[u];l[p]=l[p]||{};l=l[p];a=a[p]}r=h[h.length-1]}var c=a[r];if(this.isObject(i[r])){l[r]=c.get()}else if(s.Signal&&c instanceof s.Signal){l[r]=c.value}else if(s.Param&&c instanceof s.Param){l[r]=c.value}else if(c instanceof AudioParam){l[r]=c.value}else if(c instanceof s){l[r]=c.get()}else if(!e(c)&&!t(c)){l[r]=c}}return n};s.prototype._collectDefaults=function(e){var i=[];if(!t(e.defaults)){i=Object.keys(e.defaults)}if(!t(e._super)){var s=this._collectDefaults(e._super);for(var n=0;n<s.length;n++){if(i.indexOf(s[n])===-1){i.push(s[n])}}}return i};s.prototype.toString=function(){for(var t in s){var i=t[0].match(/^[A-Z]$/);var n=s[t]===this.constructor;if(e(s[t])&&i&&n){return t}}return"Tone"};s.context=i;s.prototype.context=s.context;s.prototype.bufferSize=2048;s.prototype.blockTime=128/s.context.sampleRate;s.prototype.sampleTime=1/s.context.sampleRate;s.prototype.dispose=function(){if(!this.isUndef(this.input)){if(this.input instanceof AudioNode){this.input.disconnect()}this.input=null}if(!this.isUndef(this.output)){if(this.output instanceof AudioNode){this.output.disconnect()}this.output=null}return this};var n=null;s.prototype.noGC=function(){this.output.connect(n);return this};AudioNode.prototype.noGC=function(){this.connect(n);return this};s.prototype.connect=function(t,e,i){if(Array.isArray(this.output)){e=this.defaultArg(e,0);this.output[e].connect(t,0,i)}else{this.output.connect(t,e,i)}return this};s.prototype.disconnect=function(t){if(Array.isArray(this.output)){t=this.defaultArg(t,0);this.output[t].disconnect()}else if(!this.isUndef(t)){this.output.disconnect(t)}else{this.output.disconnect()}return this};s.prototype.connectSeries=function(){if(arguments.length>1){var t=arguments[0];for(var e=1;e<arguments.length;e++){var i=arguments[e];t.connect(i);t=i}}return this};s.prototype.chain=function(){if(arguments.length>0){var t=this;for(var e=0;e<arguments.length;e++){var i=arguments[e];t.connect(i);t=i}}return this};s.prototype.fan=function(){if(arguments.length>0){for(var t=0;t<arguments.length;t++){this.connect(arguments[t])}}return this};AudioNode.prototype.chain=s.prototype.chain;AudioNode.prototype.fan=s.prototype.fan;s.prototype.defaultArg=function(e,i){if(this.isObject(e)&&this.isObject(i)){var s={};for(var n in e){s[n]=this.defaultArg(i[n],e[n])}for(var o in i){s[o]=this.defaultArg(e[o],i[o])}return s}else{return t(e)?i:e}};s.prototype.optionsObject=function(t,e,i){var s={};if(t.length===1&&this.isObject(t[0])){s=t[0]}else{for(var n=0;n<e.length;n++){s[e[n]]=t[n]}}if(!this.isUndef(i)){return this.defaultArg(s,i)}else{return s}};s.prototype.isUndef=t;s.prototype.isFunction=e;s.prototype.isNumber=function(t){return typeof t==="number"};s.prototype.isObject=function(t){return Object.prototype.toString.call(t)==="[object Object]"&&t.constructor===Object};s.prototype.isBoolean=function(t){return typeof t==="boolean"};s.prototype.isArray=function(t){return Array.isArray(t)};s.prototype.isString=function(t){return typeof t==="string"};s.noOp=function(){};s.prototype._readOnly=function(t){if(Array.isArray(t)){for(var e=0;e<t.length;e++){this._readOnly(t[e])}}else{Object.defineProperty(this,t,{writable:false,enumerable:true})}};s.prototype._writable=function(t){if(Array.isArray(t)){for(var e=0;e<t.length;e++){this._writable(t[e])}}else{Object.defineProperty(this,t,{writable:true})}};s.State={Started:"started",Stopped:"stopped",Paused:"paused"};s.prototype.equalPowerScale=function(t){var e=.5*Math.PI;return Math.sin(t*e)};s.prototype.dbToGain=function(t){return Math.pow(2,t/6)};s.prototype.gainToDb=function(t){return 20*(Math.log(t)/Math.LN10)};s.prototype.intervalToFrequencyRatio=function(t){return Math.pow(2,t/12)};s.prototype.now=function(){return this.context.currentTime};s.now=function(){return s.context.currentTime};s.extend=function(e,i){if(t(i)){i=s}function n(){}n.prototype=i.prototype;e.prototype=new n;e.prototype.constructor=e;e._super=i};var o=[];s._initAudioContext=function(t){t(s.context);o.push(t)};s.setContext=function(t){s.prototype.context=t;s.context=t;for(var e=0;e<o.length;e++){o[e](t)}};s._initAudioContext(function(t){s.prototype.blockTime=128/t.sampleRate;s.prototype.sampleTime=1/t.sampleRate;n=t.createGain();n.gain.value=0;n.connect(t.destination)});s.version="r8";if(!window.TONE_SILENCE_VERSION_LOGGING){console.log("%c * Tone.js "+s.version+" * ","background: #000; color: #fff")}return s});i(function(t){t.SignalBase=function(){};t.extend(t.SignalBase);t.SignalBase.prototype.connect=function(e,i,s){if(t.Signal&&t.Signal===e.constructor||t.Param&&t.Param===e.constructor||t.TimelineSignal&&t.TimelineSignal===e.constructor){e._param.cancelScheduledValues(0);e._param.value=0;e.overridden=true}else if(e instanceof AudioParam){e.cancelScheduledValues(0);e.value=0}t.prototype.connect.call(this,e,i,s);return this};return t.SignalBase});i(function(t){t.WaveShaper=function(t,e){this._shaper=this.input=this.output=this.context.createWaveShaper();this._curve=null;if(Array.isArray(t)){this.curve=t}else if(isFinite(t)||this.isUndef(t)){this._curve=new Float32Array(this.defaultArg(t,1024))}else if(this.isFunction(t)){this._curve=new Float32Array(this.defaultArg(e,1024));this.setMap(t)}};t.extend(t.WaveShaper,t.SignalBase);t.WaveShaper.prototype.setMap=function(t){for(var e=0,i=this._curve.length;e<i;e++){var s=e/(i-1)*2-1;this._curve[e]=t(s,e)}this._shaper.curve=this._curve;return this};Object.defineProperty(t.WaveShaper.prototype,"curve",{get:function(){return this._shaper.curve},set:function(t){this._curve=new Float32Array(t);this._shaper.curve=this._curve}});Object.defineProperty(t.WaveShaper.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(t){if(["none","2x","4x"].indexOf(t)!==-1){this._shaper.oversample=t}else{throw new RangeError("Tone.WaveShaper: oversampling must be either 'none', '2x', or '4x'")}}});t.WaveShaper.prototype.dispose=function(){t.prototype.dispose.call(this);this._shaper.disconnect();this._shaper=null;this._curve=null;return this};return t.WaveShaper});i(function(t){t.TimeBase=function(e,i){if(this instanceof t.TimeBase){this._expr=this._noOp;if(e instanceof t.TimeBase){this.copy(e)}else if(!this.isUndef(i)||this.isNumber(e)){i=this.defaultArg(i,this._defaultUnits);var s=this._primaryExpressions[i].method;this._expr=s.bind(this,e)}else if(this.isString(e)){this.set(e)}else if(this.isUndef(e)){this._expr=this._defaultExpr()}}else{return new t.TimeBase(e,i)}};t.extend(t.TimeBase);t.TimeBase.prototype.set=function(t){this._expr=this._parseExprString(t);return this};t.TimeBase.prototype.clone=function(){var t=new this.constructor;t.copy(this);return t};t.TimeBase.prototype.copy=function(t){var e=t._expr();return this.set(e)};t.TimeBase.prototype._primaryExpressions={n:{regexp:/^(\d+)n/i,method:function(t){t=parseInt(t);if(t===1){return this._beatsToUnits(this._timeSignature())}else{return this._beatsToUnits(4/t)}}},t:{regexp:/^(\d+)t/i,method:function(t){t=parseInt(t);return this._beatsToUnits(8/(parseInt(t)*3))}},m:{regexp:/^(\d+)m/i,method:function(t){return this._beatsToUnits(parseInt(t)*this._timeSignature())}},i:{regexp:/^(\d+)i/i,method:function(t){return this._ticksToUnits(parseInt(t))}},hz:{regexp:/^(\d+(?:\.\d+)?)hz/i,method:function(t){return this._frequencyToUnits(parseFloat(t))}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method:function(t,e,i){var s=0;if(t&&t!=="0"){s+=this._beatsToUnits(this._timeSignature()*parseFloat(t))}if(e&&e!=="0"){s+=this._beatsToUnits(parseFloat(e))}if(i&&i!=="0"){s+=this._beatsToUnits(parseFloat(i)/4)}return s}},s:{regexp:/^(\d+(?:\.\d+)?s)/,method:function(t){return this._secondsToUnits(parseFloat(t))}},samples:{regexp:/^(\d+)samples/,method:function(t){return parseInt(t)/this.context.sampleRate}},default:{regexp:/^(\d+(?:\.\d+)?)/,method:function(t){return this._primaryExpressions[this._defaultUnits].method.call(this,t)}}};t.TimeBase.prototype._binaryExpressions={"+":{regexp:/^\+/,precedence:2,method:function(t,e){return t()+e()}},"-":{regexp:/^\-/,precedence:2,method:function(t,e){return t()-e()}},"*":{regexp:/^\*/,precedence:1,method:function(t,e){return t()*e()}},"/":{regexp:/^\//,precedence:1,method:function(t,e){return t()/e()}}};t.TimeBase.prototype._unaryExpressions={neg:{regexp:/^\-/,method:function(t){return-t()}}};t.TimeBase.prototype._syntaxGlue={"(":{regexp:/^\(/},")":{regexp:/^\)/}};t.TimeBase.prototype._tokenize=function(t){var e=-1;var i=[];while(t.length>0){t=t.trim();var s=n(t,this);i.push(s);t=t.substr(s.value.length)}function n(t,e){var i=["_binaryExpressions","_unaryExpressions","_primaryExpressions","_syntaxGlue"];for(var s=0;s<i.length;s++){var n=e[i[s]];for(var o in n){var r=n[o];var a=r.regexp;var l=t.match(a);if(l!==null){return{method:r.method,precedence:r.precedence,regexp:r.regexp,value:l[0]}}}}throw new SyntaxError("Tone.TimeBase: Unexpected token "+t)}return{next:function(){return i[++e]},peek:function(){return i[e+1]}}};t.TimeBase.prototype._matchGroup=function(t,e,i){var s=false;if(!this.isUndef(t)){for(var n in e){var o=e[n];if(o.regexp.test(t.value)){if(!this.isUndef(i)){if(o.precedence===i){return o}}else{return o}}}}return s};t.TimeBase.prototype._parseBinary=function(t,e){if(this.isUndef(e)){e=2}var i;if(e<0){i=this._parseUnary(t)}else{i=this._parseBinary(t,e-1)}var s=t.peek();while(s&&this._matchGroup(s,this._binaryExpressions,e)){s=t.next();i=s.method.bind(this,i,this._parseBinary(t,e-1));s=t.peek()}return i};t.TimeBase.prototype._parseUnary=function(t){var e,i;e=t.peek();var s=this._matchGroup(e,this._unaryExpressions);if(s){e=t.next();i=this._parseUnary(t);return s.method.bind(this,i)}return this._parsePrimary(t)};t.TimeBase.prototype._parsePrimary=function(t){var e,i;e=t.peek();if(this.isUndef(e)){throw new SyntaxError("Tone.TimeBase: Unexpected end of expression")}if(this._matchGroup(e,this._primaryExpressions)){e=t.next();var s=e.value.match(e.regexp);return e.method.bind(this,s[1],s[2],s[3])}if(e&&e.value==="("){t.next();i=this._parseBinary(t);e=t.next();if(!(e&&e.value===")")){throw new SyntaxError("Expected )")}return i}throw new SyntaxError("Tone.TimeBase: Cannot process token "+e.value)};t.TimeBase.prototype._parseExprString=function(t){if(!this.isString(t)){t=t.toString()}var e=this._tokenize(t);var i=this._parseBinary(e);return i};t.TimeBase.prototype._noOp=function(){return 0};t.TimeBase.prototype._defaultExpr=function(){return this._noOp};t.TimeBase.prototype._defaultUnits="s";t.TimeBase.prototype._frequencyToUnits=function(t){return 1/t};t.TimeBase.prototype._beatsToUnits=function(e){return 60/t.Transport.bpm.value*e};t.TimeBase.prototype._secondsToUnits=function(t){return t};t.TimeBase.prototype._ticksToUnits=function(e){return e*(this._beatsToUnits(1)/t.Transport.PPQ)};t.TimeBase.prototype._timeSignature=function(){return t.Transport.timeSignature};t.TimeBase.prototype._pushExpr=function(e,i,s){if(!(e instanceof t.TimeBase)){e=new this.constructor(e,s)}this._expr=this._binaryExpressions[i].method.bind(this,this._expr,e._expr);return this};t.TimeBase.prototype.add=function(t,e){return this._pushExpr(t,"+",e)};t.TimeBase.prototype.sub=function(t,e){return this._pushExpr(t,"-",e)};t.TimeBase.prototype.mult=function(t,e){return this._pushExpr(t,"*",e)};t.TimeBase.prototype.div=function(t,e){return this._pushExpr(t,"/",e)};t.TimeBase.prototype.eval=function(){return this._expr()};t.TimeBase.prototype.dispose=function(){this._expr=null};return t.TimeBase});i(function(t){t.Time=function(e,i){if(this instanceof t.Time){this._plusNow=false;t.TimeBase.call(this,e,i)}else{return new t.Time(e,i)}};t.extend(t.Time,t.TimeBase);t.Time.prototype._unaryExpressions=Object.create(t.TimeBase.prototype._unaryExpressions);t.Time.prototype._unaryExpressions.quantize={regexp:/^@/,method:function(e){return t.Transport.nextSubdivision(e())}};t.Time.prototype._unaryExpressions.now={regexp:/^\+/,method:function(t){this._plusNow=true;return t()}};t.Time.prototype.quantize=function(t,e){e=this.defaultArg(e,1);this._expr=function(t,e,i){t=t();e=e.toSeconds();var s=Math.round(t/e);var n=s*e;var o=n-t;return t+o*i}.bind(this,this._expr,new this.constructor(t),e);return this};t.Time.prototype.addNow=function(){this._plusNow=true;return this};t.Time.prototype._defaultExpr=function(){this._plusNow=true;return this._noOp};t.Time.prototype.copy=function(e){t.TimeBase.prototype.copy.call(this,e);this._plusNow=e._plusNow;return this};t.Time.prototype.toNotation=function(){var t=this.toSeconds();var e=["1m","2n","4n","8n","16n","32n","64n","128n"];var i=this._toNotationHelper(t,e);var s=["1m","2n","2t","4n","4t","8n","8t","16n","16t","32n","32t","64n","64t","128n"];var n=this._toNotationHelper(t,s);if(n.split("+").length<i.split("+").length){return n}else{return i}};t.Time.prototype._toNotationHelper=function(t,e){var i=this._notationToUnits(e[e.length-1]);var s="";for(var n=0;n<e.length;n++){var o=this._notationToUnits(e[n]);var r=t/o;var a=1e-6;if(1-r%1<a){r+=a}r=Math.floor(r);if(r>0){if(r===1){s+=e[n]}else{s+=r.toString()+"*"+e[n]}t-=r*o;if(t<i){break}else{s+=" + "}}}if(s===""){s="0"}return s};t.Time.prototype._notationToUnits=function(t){var e=this._primaryExpressions;var i=[e.n,e.t,e.m];for(var s=0;s<i.length;s++){var n=i[s];var o=t.match(n.regexp);if(o){return n.method.call(this,o[1])}}};t.Time.prototype.toBarsBeatsSixteenths=function(){var t=this._beatsToUnits(1);var e=this.toSeconds()/t;var i=Math.floor(e/this._timeSignature());var s=e%1*4;e=Math.floor(e)%this._timeSignature();s=s.toString();if(s.length>3){s=parseFloat(s).toFixed(3)}var n=[i,e,s];return n.join(":")};t.Time.prototype.toTicks=function(){var e=this._beatsToUnits(1);var i=this.eval()/e;return Math.floor(i*t.Transport.PPQ)};t.Time.prototype.toSamples=function(){return this.toSeconds()*this.context.sampleRate};t.Time.prototype.toFrequency=function(){return 1/this.toSeconds()};t.Time.prototype.toSeconds=function(){return this.eval()};t.Time.prototype.toMilliseconds=function(){return this.toSeconds()*1e3};t.Time.prototype.eval=function(){var t=this._expr();return t+(this._plusNow?this.now():0)};return t.Time});i(function(t){t.Frequency=function(e,i){if(this instanceof t.Frequency){t.TimeBase.call(this,e,i)}else{return new t.Frequency(e,i)}};t.extend(t.Frequency,t.TimeBase);t.Frequency.prototype._primaryExpressions=Object.create(t.TimeBase.prototype._primaryExpressions);t.Frequency.prototype._primaryExpressions.midi={regexp:/^(\d+(?:\.\d+)?midi)/,method:function(t){return this.midiToFrequency(t)}};t.Frequency.prototype._primaryExpressions.note={regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method:function(t,i){var s=e[t.toLowerCase()];var n=s+(parseInt(i)+1)*12;return this.midiToFrequency(n)}};t.Frequency.prototype._primaryExpressions.tr={regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method:function(t,e,i){var s=1;if(t&&t!=="0"){s*=this._beatsToUnits(this._timeSignature()*parseFloat(t))}if(e&&e!=="0"){s*=this._beatsToUnits(parseFloat(e))}if(i&&i!=="0"){s*=this._beatsToUnits(parseFloat(i)/4)}return s}};t.Frequency.prototype.transpose=function(t){this._expr=function(t,e){var i=t();return i*this.intervalToFrequencyRatio(e)}.bind(this,this._expr,t);return this};t.Frequency.prototype.harmonize=function(t){this._expr=function(t,e){var i=t();var s=[];for(var n=0;n<e.length;n++){s[n]=i*this.intervalToFrequencyRatio(e[n])}return s}.bind(this,this._expr,t);return this};t.Frequency.prototype.toMidi=function(){return this.frequencyToMidi(this.eval())};t.Frequency.prototype.toNote=function(){var e=this.eval();var s=Math.log(e/t.Frequency.A4)/Math.LN2;var n=Math.round(12*s)+57;var o=Math.floor(n/12);if(o<0){n+=-12*o}var r=i[n%12];return r+o.toString()};t.Frequency.prototype.toSeconds=function(){return 1/this.eval()};t.Frequency.prototype.toFrequency=function(){return this.eval()};t.Frequency.prototype.toTicks=function(){var e=this._beatsToUnits(1);var i=this.eval()/e;return Math.floor(i*t.Transport.PPQ)};t.Frequency.prototype._frequencyToUnits=function(t){return t};t.Frequency.prototype._ticksToUnits=function(e){return 1/(e*60/(t.Transport.bpm.value*t.Transport.PPQ))};t.Frequency.prototype._beatsToUnits=function(e){return 1/t.TimeBase.prototype._beatsToUnits.call(this,e)};t.Frequency.prototype._secondsToUnits=function(t){return 1/t};t.Frequency.prototype._defaultUnits="hz";var e={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};var i=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];t.Frequency.A4=440;t.Frequency.prototype.midiToFrequency=function(e){return t.Frequency.A4*Math.pow(2,(e-69)/12)};t.Frequency.prototype.frequencyToMidi=function(e){return 69+12*Math.log(e/t.Frequency.A4)/Math.LN2};return t.Frequency});i(function(t){t.TransportTime=function(e,i){if(this instanceof t.TransportTime){t.Time.call(this,e,i)}else{return new t.TransportTime(e,i)}};t.extend(t.TransportTime,t.Time);t.TransportTime.prototype._unaryExpressions=Object.create(t.Time.prototype._unaryExpressions);t.TransportTime.prototype._unaryExpressions.quantize={regexp:/^@/,method:function(e){var i=this._secondsToTicks(e());var s=Math.ceil(t.Transport.ticks/i);return this._ticksToUnits(s*i)}};t.TransportTime.prototype._secondsToTicks=function(e){var i=this._beatsToUnits(1);var s=e/i;return Math.round(s*t.Transport.PPQ)};t.TransportTime.prototype.eval=function(){var e=this._secondsToTicks(this._expr());return e+(this._plusNow?t.Transport.ticks:0)};t.TransportTime.prototype.toTicks=function(){return this.eval()};t.TransportTime.prototype.toSeconds=function(){var e=this._expr();return e+(this._plusNow?t.Transport.seconds:0)};t.TransportTime.prototype.toFrequency=function(){return 1/this.toSeconds()};return t.TransportTime});i(function(t){t.Type={Default:"number",Time:"time",Frequency:"frequency",TransportTime:"transportTime",Ticks:"ticks",NormalRange:"normalRange",AudioRange:"audioRange",Decibels:"db",Interval:"interval",BPM:"bpm",Positive:"positive",Cents:"cents",Degrees:"degrees",MIDI:"midi",BarsBeatsSixteenths:"barsBeatsSixteenths",Samples:"samples",Hertz:"hertz",Note:"note",Milliseconds:"milliseconds",Seconds:"seconds",Notation:"notation"};t.prototype.toSeconds=function(e){if(this.isNumber(e)){return e}else if(this.isUndef(e)){return this.now()}else if(this.isString(e)){return new t.Time(e).toSeconds()}else if(e instanceof t.TimeBase){return e.toSeconds()}};t.prototype.toFrequency=function(e){if(this.isNumber(e)){return e}else if(this.isString(e)||this.isUndef(e)){return new t.Frequency(e).eval()}else if(e instanceof t.TimeBase){return e.toFrequency()}};t.prototype.toTicks=function(e){if(this.isNumber(e)||this.isString(e)){return new t.TransportTime(e).toTicks()}else if(this.isUndef(e)){return t.Transport.ticks}else if(e instanceof t.TimeBase){return e.toTicks()}};return t});i(function(t){t.Param=function(){var e=this.optionsObject(arguments,["param","units","convert"],t.Param.defaults);this._param=this.input=e.param;this.units=e.units;this.convert=e.convert;this.overridden=false;this._lfo=null;if(this.isObject(e.lfo)){this.value=e.lfo}else if(!this.isUndef(e.value)){this.value=e.value}};t.extend(t.Param);t.Param.defaults={units:t.Type.Default,convert:true,param:undefined};Object.defineProperty(t.Param.prototype,"value",{get:function(){return this._toUnits(this._param.value)},set:function(e){if(this.isObject(e)){if(this.isUndef(t.LFO)){throw new Error("Include 'Tone.LFO' to use an LFO as a Param value.")}if(this._lfo){this._lfo.dispose()}this._lfo=new t.LFO(e).start();this._lfo.connect(this.input)}else{var i=this._fromUnits(e);this._param.cancelScheduledValues(0);this._param.value=i}}});t.Param.prototype._fromUnits=function(e){if(this.convert||this.isUndef(this.convert)){switch(this.units){case t.Type.Time:return this.toSeconds(e);case t.Type.Frequency:return this.toFrequency(e);case t.Type.Decibels:return this.dbToGain(e);case t.Type.NormalRange:return Math.min(Math.max(e,0),1);case t.Type.AudioRange:return Math.min(Math.max(e,-1),1);case t.Type.Positive:return Math.max(e,0);default:return e}}else{return e}};t.Param.prototype._toUnits=function(e){if(this.convert||this.isUndef(this.convert)){switch(this.units){case t.Type.Decibels:return this.gainToDb(e);default:return e}}else{return e}};t.Param.prototype._minOutput=1e-5;t.Param.prototype.setValueAtTime=function(t,e){t=this._fromUnits(t);e=this.toSeconds(e);if(e<=this.now()+this.blockTime){this._param.value=t}else{this._param.setValueAtTime(t,e)}return this};t.Param.prototype.setRampPoint=function(t){t=this.defaultArg(t,this.now());var e=this._param.value;if(e===0){e=this._minOutput}this._param.setValueAtTime(e,t);return this};t.Param.prototype.linearRampToValueAtTime=function(t,e){t=this._fromUnits(t);this._param.linearRampToValueAtTime(t,this.toSeconds(e));return this};t.Param.prototype.exponentialRampToValueAtTime=function(t,e){t=this._fromUnits(t);t=Math.max(this._minOutput,t);this._param.exponentialRampToValueAtTime(t,this.toSeconds(e));return this};t.Param.prototype.exponentialRampToValue=function(t,e,i){i=this.toSeconds(i);this.setRampPoint(i);this.exponentialRampToValueAtTime(t,i+this.toSeconds(e));return this};t.Param.prototype.linearRampToValue=function(t,e,i){i=this.toSeconds(i);this.setRampPoint(i);this.linearRampToValueAtTime(t,i+this.toSeconds(e));return this};t.Param.prototype.setTargetAtTime=function(t,e,i){t=this._fromUnits(t);t=Math.max(this._minOutput,t);i=Math.max(this._minOutput,i);this._param.setTargetAtTime(t,this.toSeconds(e),i);return this};t.Param.prototype.setValueCurveAtTime=function(t,e,i){for(var s=0;s<t.length;s++){t[s]=this._fromUnits(t[s])}this._param.setValueCurveAtTime(t,this.toSeconds(e),this.toSeconds(i));return this};t.Param.prototype.cancelScheduledValues=function(t){this._param.cancelScheduledValues(this.toSeconds(t));return this};t.Param.prototype.rampTo=function(e,i,s){i=this.defaultArg(i,0);if(this.units===t.Type.Frequency||this.units===t.Type.BPM){this.exponentialRampToValue(e,i,s)}else{this.linearRampToValue(e,i,s)}return this};Object.defineProperty(t.Param.prototype,"lfo",{get:function(){return this._lfo}});t.Param.prototype.dispose=function(){t.prototype.dispose.call(this);this._param=null;if(this._lfo){this._lfo.dispose();this._lfo=null}return this};return t.Param});i(function(t){t.Gain=function(){var e=this.optionsObject(arguments,["gain","units"],t.Gain.defaults);this.input=this.output=this._gainNode=this.context.createGain();this.gain=new t.Param({param:this._gainNode.gain,units:e.units,value:e.gain,convert:e.convert});this._readOnly("gain")};t.extend(t.Gain);t.Gain.defaults={gain:1,convert:true};t.Gain.prototype.dispose=function(){t.Param.prototype.dispose.call(this);this._gainNode.disconnect();this._gainNode=null;this._writable("gain");this.gain.dispose();this.gain=null};t.prototype.createInsOuts=function(e,i){if(e===1){this.input=new t.Gain}else if(e>1){this.input=new Array(e)}if(i===1){this.output=new t.Gain}else if(i>1){this.output=new Array(e)}};return t.Gain});i(function(t){t.Signal=function(){var e=this.optionsObject(arguments,["value","units"],t.Signal.defaults);this.output=this._gain=this.context.createGain();e.param=this._gain.gain;t.Param.call(this,e);this.input=this._param=this._gain.gain;t.Signal._constant.chain(this._gain)};t.extend(t.Signal,t.Param);t.Signal.defaults={value:0,units:t.Type.Default,convert:true};t.Signal.prototype.connect=t.SignalBase.prototype.connect;t.Signal.prototype.dispose=function(){t.Param.prototype.dispose.call(this);this._param=null;this._gain.disconnect();this._gain=null;return this};t.Signal._constant=null;t._initAudioContext(function(e){var i=e.createBuffer(1,128,e.sampleRate);var s=i.getChannelData(0);for(var n=0;n<s.length;n++){s[n]=1}t.Signal._constant=e.createBufferSource();t.Signal._constant.channelCount=1;t.Signal._constant.channelCountMode="explicit";t.Signal._constant.buffer=i;t.Signal._constant.loop=true;t.Signal._constant.start(0);t.Signal._constant.noGC()});return t.Signal});i(function(t){t.Timeline=function(){var e=this.optionsObject(arguments,["memory"],t.Timeline.defaults);this._timeline=[];this._toRemove=[];this._iterating=false;this.memory=e.memory};t.extend(t.Timeline);t.Timeline.defaults={memory:Infinity};Object.defineProperty(t.Timeline.prototype,"length",{get:function(){return this._timeline.length}});t.Timeline.prototype.addEvent=function(t){if(this.isUndef(t.time)){throw new Error("Tone.Timeline: events must have a time attribute")}if(this._timeline.length){var e=this._search(t.time);this._timeline.splice(e+1,0,t)}else{this._timeline.push(t)}if(this.length>this.memory){var i=this.length-this.memory;this._timeline.splice(0,i)}return this};t.Timeline.prototype.removeEvent=function(t){if(this._iterating){this._toRemove.push(t)}else{var e=this._timeline.indexOf(t);if(e!==-1){this._timeline.splice(e,1)}}return this};t.Timeline.prototype.getEvent=function(t){var e=this._search(t);if(e!==-1){return this._timeline[e]}else{return null}};t.Timeline.prototype.getEventAfter=function(t){var e=this._search(t);if(e+1<this._timeline.length){return this._timeline[e+1]}else{return null}};t.Timeline.prototype.getEventBefore=function(t){var e=this._timeline.length;if(e>0&&this._timeline[e-1].time<t){return this._timeline[e-1]}var i=this._search(t);if(i-1>=0){return this._timeline[i-1]}else{return null}};t.Timeline.prototype.cancel=function(t){if(this._timeline.length>1){var e=this._search(t);if(e>=0){if(this._timeline[e].time===t){for(var i=e;i>=0;i--){if(this._timeline[i].time===t){e=i}else{break}}this._timeline=this._timeline.slice(0,e)}else{this._timeline=this._timeline.slice(0,e+1)}}else{this._timeline=[]}}else if(this._timeline.length===1){if(this._timeline[0].time>=t){this._timeline=[]}}return this};t.Timeline.prototype.cancelBefore=function(t){if(this._timeline.length){var e=this._search(t);if(e>=0){this._timeline=this._timeline.slice(e+1);
}}return this};t.Timeline.prototype._search=function(t){var e=0;var i=this._timeline.length;var s=i;if(i>0&&this._timeline[i-1].time<=t){return i-1}while(e<s){var n=Math.floor(e+(s-e)/2);var o=this._timeline[n];var r=this._timeline[n+1];if(o.time===t){for(var a=n;a<this._timeline.length;a++){var l=this._timeline[a];if(l.time===t){n=a}}return n}else if(o.time<t&&r.time>t){return n}else if(o.time>t){s=n}else if(o.time<t){e=n+1}}return-1};t.Timeline.prototype._iterate=function(t,e,i){this._iterating=true;e=this.defaultArg(e,0);i=this.defaultArg(i,this._timeline.length-1);for(var s=e;s<=i;s++){t(this._timeline[s])}this._iterating=false;if(this._toRemove.length>0){for(var n=0;n<this._toRemove.length;n++){var o=this._timeline.indexOf(this._toRemove[n]);if(o!==-1){this._timeline.splice(o,1)}}this._toRemove=[]}};t.Timeline.prototype.forEach=function(t){this._iterate(t);return this};t.Timeline.prototype.forEachBefore=function(t,e){var i=this._search(t);if(i!==-1){this._iterate(e,0,i)}return this};t.Timeline.prototype.forEachAfter=function(t,e){var i=this._search(t);this._iterate(e,i+1);return this};t.Timeline.prototype.forEachFrom=function(t,e){var i=this._search(t);while(i>=0&&this._timeline[i].time>=t){i--}this._iterate(e,i+1);return this};t.Timeline.prototype.forEachAtTime=function(t,e){var i=this._search(t);if(i!==-1){this._iterate(function(i){if(i.time===t){e(i)}},0,i)}return this};t.Timeline.prototype.dispose=function(){t.prototype.dispose.call(this);this._timeline=null;this._toRemove=null};return t.Timeline});i(function(t){t.TimelineSignal=function(){var e=this.optionsObject(arguments,["value","units"],t.Signal.defaults);this._events=new t.Timeline(10);t.Signal.apply(this,e);e.param=this._param;t.Param.call(this,e);this._initial=this._fromUnits(this._param.value)};t.extend(t.TimelineSignal,t.Param);t.TimelineSignal.Type={Linear:"linear",Exponential:"exponential",Target:"target",Curve:"curve",Set:"set"};Object.defineProperty(t.TimelineSignal.prototype,"value",{get:function(){var t=this.now();var e=this.getValueAtTime(t);return this._toUnits(e)},set:function(t){var e=this._fromUnits(t);this._initial=e;this.cancelScheduledValues();this._param.value=e}});t.TimelineSignal.prototype.setValueAtTime=function(e,i){e=this._fromUnits(e);i=this.toSeconds(i);this._events.addEvent({type:t.TimelineSignal.Type.Set,value:e,time:i});this._param.setValueAtTime(e,i);return this};t.TimelineSignal.prototype.linearRampToValueAtTime=function(e,i){e=this._fromUnits(e);i=this.toSeconds(i);this._events.addEvent({type:t.TimelineSignal.Type.Linear,value:e,time:i});this._param.linearRampToValueAtTime(e,i);return this};t.TimelineSignal.prototype.exponentialRampToValueAtTime=function(e,i){i=this.toSeconds(i);var s=this._searchBefore(i);if(s&&s.value===0){this.setValueAtTime(this._minOutput,s.time)}e=this._fromUnits(e);var n=Math.max(e,this._minOutput);this._events.addEvent({type:t.TimelineSignal.Type.Exponential,value:n,time:i});if(e<this._minOutput){this._param.exponentialRampToValueAtTime(this._minOutput,i-this.sampleTime);this.setValueAtTime(0,i)}else{this._param.exponentialRampToValueAtTime(e,i)}return this};t.TimelineSignal.prototype.setTargetAtTime=function(e,i,s){e=this._fromUnits(e);e=Math.max(this._minOutput,e);s=Math.max(this._minOutput,s);i=this.toSeconds(i);this._events.addEvent({type:t.TimelineSignal.Type.Target,value:e,time:i,constant:s});this._param.setTargetAtTime(e,i,s);return this};t.TimelineSignal.prototype.setValueCurveAtTime=function(e,i,s,n){n=this.defaultArg(n,1);var o=new Array(e.length);for(var r=0;r<o.length;r++){o[r]=this._fromUnits(e[r])*n}i=this.toSeconds(i);s=this.toSeconds(s);this._events.addEvent({type:t.TimelineSignal.Type.Curve,value:o,time:i,duration:s});this._param.setValueAtTime(o[0],i);for(var a=1;a<o.length;a++){var l=i+a/(o.length-1)*s;this._param.linearRampToValueAtTime(o[a],l)}return this};t.TimelineSignal.prototype.cancelScheduledValues=function(t){t=this.toSeconds(t);this._events.cancel(t);this._param.cancelScheduledValues(t);return this};t.TimelineSignal.prototype.setRampPoint=function(e){e=this.toSeconds(e);var i=this._toUnits(this.getValueAtTime(e));var s=this._searchBefore(e);if(s&&s.time===e){this.cancelScheduledValues(e+this.sampleTime)}else if(s&&s.type===t.TimelineSignal.Type.Curve&&s.time+s.duration>e){this.cancelScheduledValues(e);this.linearRampToValueAtTime(i,e)}else{var n=this._searchAfter(e);if(n){this.cancelScheduledValues(e);if(n.type===t.TimelineSignal.Type.Linear){this.linearRampToValueAtTime(i,e)}else if(n.type===t.TimelineSignal.Type.Exponential){this.exponentialRampToValueAtTime(i,e)}}this.setValueAtTime(i,e)}return this};t.TimelineSignal.prototype.linearRampToValueBetween=function(t,e,i){this.setRampPoint(e);this.linearRampToValueAtTime(t,i);return this};t.TimelineSignal.prototype.exponentialRampToValueBetween=function(t,e,i){this.setRampPoint(e);this.exponentialRampToValueAtTime(t,i);return this};t.TimelineSignal.prototype._searchBefore=function(t){return this._events.getEvent(t)};t.TimelineSignal.prototype._searchAfter=function(t){return this._events.getEventAfter(t)};t.TimelineSignal.prototype.getValueAtTime=function(e){e=this.toSeconds(e);var i=this._searchAfter(e);var s=this._searchBefore(e);var n=this._initial;if(s===null){n=this._initial}else if(s.type===t.TimelineSignal.Type.Target){var o=this._events.getEventBefore(s.time);var r;if(o===null){r=this._initial}else{r=o.value}n=this._exponentialApproach(s.time,r,s.value,s.constant,e)}else if(s.type===t.TimelineSignal.Type.Curve){n=this._curveInterpolate(s.time,s.value,s.duration,e)}else if(i===null){n=s.value}else if(i.type===t.TimelineSignal.Type.Linear){n=this._linearInterpolate(s.time,s.value,i.time,i.value,e)}else if(i.type===t.TimelineSignal.Type.Exponential){n=this._exponentialInterpolate(s.time,s.value,i.time,i.value,e)}else{n=s.value}return n};t.TimelineSignal.prototype.connect=t.SignalBase.prototype.connect;t.TimelineSignal.prototype._exponentialApproach=function(t,e,i,s,n){return i+(e-i)*Math.exp(-(n-t)/s)};t.TimelineSignal.prototype._linearInterpolate=function(t,e,i,s,n){return e+(s-e)*((n-t)/(i-t))};t.TimelineSignal.prototype._exponentialInterpolate=function(t,e,i,s,n){e=Math.max(this._minOutput,e);return e*Math.pow(s/e,(n-t)/(i-t))};t.TimelineSignal.prototype._curveInterpolate=function(t,e,i,s){var n=e.length;if(s>=t+i){return e[n-1]}else if(s<=t){return e[0]}else{var o=(s-t)/i;var r=Math.floor((n-1)*o);var a=Math.ceil((n-1)*o);var l=e[r];var h=e[a];if(a===r){return l}else{return this._linearInterpolate(r,l,a,h,o*(n-1))}}};t.TimelineSignal.prototype.dispose=function(){t.Signal.prototype.dispose.call(this);t.Param.prototype.dispose.call(this);this._events.dispose();this._events=null};return t.TimelineSignal});i(function(t){t.Pow=function(e){this._exp=this.defaultArg(e,1);this._expScaler=this.input=this.output=new t.WaveShaper(this._expFunc(this._exp),8192)};t.extend(t.Pow,t.SignalBase);Object.defineProperty(t.Pow.prototype,"value",{get:function(){return this._exp},set:function(t){this._exp=t;this._expScaler.setMap(this._expFunc(this._exp))}});t.Pow.prototype._expFunc=function(t){return function(e){return Math.pow(Math.abs(e),t)}};t.Pow.prototype.dispose=function(){t.prototype.dispose.call(this);this._expScaler.dispose();this._expScaler=null;return this};return t.Pow});i(function(t){t.Envelope=function(){var e=this.optionsObject(arguments,["attack","decay","sustain","release"],t.Envelope.defaults);this.attack=e.attack;this.decay=e.decay;this.sustain=e.sustain;this.release=e.release;this._attackCurve="linear";this._releaseCurve="exponential";this._sig=this.output=new t.TimelineSignal;this._sig.setValueAtTime(0,0);this.attackCurve=e.attackCurve;this.releaseCurve=e.releaseCurve};t.extend(t.Envelope);t.Envelope.defaults={attack:.01,decay:.1,sustain:.5,release:1,attackCurve:"linear",releaseCurve:"exponential"};Object.defineProperty(t.Envelope.prototype,"value",{get:function(){return this.getValueAtTime(this.now())}});Object.defineProperty(t.Envelope.prototype,"attackCurve",{get:function(){if(this.isString(this._attackCurve)){return this._attackCurve}else if(this.isArray(this._attackCurve)){for(var e in t.Envelope.Type){if(t.Envelope.Type[e].In===this._attackCurve){return e}}return this._attackCurve}},set:function(e){if(t.Envelope.Type.hasOwnProperty(e)){var i=t.Envelope.Type[e];if(this.isObject(i)){this._attackCurve=i.In}else{this._attackCurve=i}}else if(this.isArray(e)){this._attackCurve=e}else{throw new Error("Tone.Envelope: invalid curve: "+e)}}});Object.defineProperty(t.Envelope.prototype,"releaseCurve",{get:function(){if(this.isString(this._releaseCurve)){return this._releaseCurve}else if(this.isArray(this._releaseCurve)){for(var e in t.Envelope.Type){if(t.Envelope.Type[e].Out===this._releaseCurve){return e}}return this._releaseCurve}},set:function(e){if(t.Envelope.Type.hasOwnProperty(e)){var i=t.Envelope.Type[e];if(this.isObject(i)){this._releaseCurve=i.Out}else{this._releaseCurve=i}}else if(this.isArray(e)){this._releaseCurve=e}else{throw new Error("Tone.Envelope: invalid curve: "+e)}}});t.Envelope.prototype.triggerAttack=function(t,e){t=this.toSeconds(t);var i=this.toSeconds(this.attack);var s=i;var n=this.toSeconds(this.decay);e=this.defaultArg(e,1);var o=this.getValueAtTime(t);if(o>0){var r=1/s;var a=1-o;s=a/r}if(this._attackCurve==="linear"){this._sig.linearRampToValue(e,s,t)}else if(this._attackCurve==="exponential"){this._sig.exponentialRampToValue(e,s,t)}else if(s>0){this._sig.setRampPoint(t);var l=this._attackCurve;if(s<i){var h=1-s/i;var u=Math.floor(h*this._attackCurve.length);l=this._attackCurve.slice(u);l[0]=o}this._sig.setValueCurveAtTime(l,t,s,e)}this._sig.exponentialRampToValue(e*this.sustain,n,s+t);return this};t.Envelope.prototype.triggerRelease=function(t){t=this.toSeconds(t);var e=this.getValueAtTime(t);if(e>0){var i=this.toSeconds(this.release);if(this._releaseCurve==="linear"){this._sig.linearRampToValue(0,i,t)}else if(this._releaseCurve==="exponential"){this._sig.exponentialRampToValue(0,i,t)}else{var s=this._releaseCurve;if(this.isArray(s)){this._sig.setRampPoint(t);this._sig.setValueCurveAtTime(s,t,i,e)}}}return this};t.Envelope.prototype.getValueAtTime=function(t){return this._sig.getValueAtTime(t)};t.Envelope.prototype.triggerAttackRelease=function(t,e,i){e=this.toSeconds(e);this.triggerAttack(e,i);this.triggerRelease(e+this.toSeconds(t));return this};t.Envelope.prototype.cancel=function(t){this._sig.cancelScheduledValues(t);return this};t.Envelope.prototype.connect=t.Signal.prototype.connect;(function e(){var i=128;var s,n;var o=[];for(s=0;s<i;s++){o[s]=Math.sin(s/(i-1)*(Math.PI/2))}var r=[];var a=6.4;for(s=0;s<i-1;s++){n=s/(i-1);var l=Math.sin(n*(Math.PI*2)*a-Math.PI/2)+1;r[s]=l/10+n*.83}r[i-1]=1;var h=[];var u=5;for(s=0;s<i;s++){h[s]=Math.ceil(s/(i-1)*u)/u}var p=[];for(s=0;s<i;s++){n=s/(i-1);p[s]=.5*(1-Math.cos(Math.PI*n))}var c=[];for(s=0;s<i;s++){n=s/(i-1);var f=Math.pow(n,3)*4+.2;var d=Math.cos(f*Math.PI*2*n);c[s]=Math.abs(d*(1-n))}function _(t){var e=new Array(t.length);for(var i=0;i<t.length;i++){e[i]=1-t[i]}return e}function y(t){return t.slice(0).reverse()}t.Envelope.Type={linear:"linear",exponential:"exponential",bounce:{In:_(c),Out:c},cosine:{In:o,Out:y(o)},step:{In:h,Out:_(h)},ripple:{In:r,Out:_(r)},sine:{In:p,Out:_(p)}}})();t.Envelope.prototype.dispose=function(){t.prototype.dispose.call(this);this._sig.dispose();this._sig=null;this._attackCurve=null;this._releaseCurve=null;return this};return t.Envelope});i(function(t){t.AmplitudeEnvelope=function(){t.Envelope.apply(this,arguments);this.input=this.output=new t.Gain;this._sig.connect(this.output.gain)};t.extend(t.AmplitudeEnvelope,t.Envelope);t.AmplitudeEnvelope.prototype.dispose=function(){this.input.dispose();this.input=null;t.Envelope.prototype.dispose.call(this);return this};return t.AmplitudeEnvelope});i(function(t){t.Analyser=function(){var e=this.optionsObject(arguments,["type","size"],t.Analyser.defaults);this._analyser=this.input=this.output=this.context.createAnalyser();this._type=e.type;this._returnType=e.returnType;this._buffer=null;this.size=e.size;this.type=e.type;this.returnType=e.returnType;this.minDecibels=e.minDecibels;this.maxDecibels=e.maxDecibels};t.extend(t.Analyser);t.Analyser.defaults={size:1024,returnType:"byte",type:"fft",smoothing:.8,maxDecibels:-30,minDecibels:-100};t.Analyser.Type={Waveform:"waveform",FFT:"fft"};t.Analyser.ReturnType={Byte:"byte",Float:"float"};t.Analyser.prototype.analyse=function(){if(this._type===t.Analyser.Type.FFT){if(this._returnType===t.Analyser.ReturnType.Byte){this._analyser.getByteFrequencyData(this._buffer)}else{this._analyser.getFloatFrequencyData(this._buffer)}}else if(this._type===t.Analyser.Type.Waveform){if(this._returnType===t.Analyser.ReturnType.Byte){this._analyser.getByteTimeDomainData(this._buffer)}else{if(this.isFunction(AnalyserNode.prototype.getFloatTimeDomainData)){this._analyser.getFloatTimeDomainData(this._buffer)}else{var e=new Uint8Array(this._buffer.length);this._analyser.getByteTimeDomainData(e);for(var i=0;i<e.length;i++){this._buffer[i]=(e[i]-128)*.0078125}}}}return this._buffer};Object.defineProperty(t.Analyser.prototype,"size",{get:function(){return this._analyser.frequencyBinCount},set:function(t){this._analyser.fftSize=t*2;this.type=this._type}});Object.defineProperty(t.Analyser.prototype,"returnType",{get:function(){return this._returnType},set:function(e){if(e===t.Analyser.ReturnType.Byte){this._buffer=new Uint8Array(this._analyser.frequencyBinCount)}else if(e===t.Analyser.ReturnType.Float){this._buffer=new Float32Array(this._analyser.frequencyBinCount)}else{throw new TypeError("Tone.Analayser: invalid return type: "+e)}this._returnType=e}});Object.defineProperty(t.Analyser.prototype,"type",{get:function(){return this._type},set:function(e){if(e!==t.Analyser.Type.Waveform&&e!==t.Analyser.Type.FFT){throw new TypeError("Tone.Analyser: invalid type: "+e)}this._type=e}});Object.defineProperty(t.Analyser.prototype,"smoothing",{get:function(){return this._analyser.smoothingTimeConstant},set:function(t){this._analyser.smoothingTimeConstant=t}});Object.defineProperty(t.Analyser.prototype,"minDecibels",{get:function(){return this._analyser.minDecibels},set:function(t){this._analyser.minDecibels=t}});Object.defineProperty(t.Analyser.prototype,"maxDecibels",{get:function(){return this._analyser.maxDecibels},set:function(t){this._analyser.maxDecibels=t}});t.Analyser.prototype.dispose=function(){t.prototype.dispose.call(this);this._analyser.disconnect();this._analyser=null;this._buffer=null};return t.Analyser});i(function(t){t.Compressor=function(){var e=this.optionsObject(arguments,["threshold","ratio"],t.Compressor.defaults);this._compressor=this.input=this.output=this.context.createDynamicsCompressor();this.threshold=this._compressor.threshold;this.attack=new t.Param(this._compressor.attack,t.Type.Time);this.release=new t.Param(this._compressor.release,t.Type.Time);this.knee=this._compressor.knee;this.ratio=this._compressor.ratio;this._readOnly(["knee","release","attack","ratio","threshold"]);this.set(e)};t.extend(t.Compressor);t.Compressor.defaults={ratio:12,threshold:-24,release:.25,attack:.003,knee:30};t.Compressor.prototype.dispose=function(){t.prototype.dispose.call(this);this._writable(["knee","release","attack","ratio","threshold"]);this._compressor.disconnect();this._compressor=null;this.attack.dispose();this.attack=null;this.release.dispose();this.release=null;this.threshold=null;this.ratio=null;this.knee=null;return this};return t.Compressor});i(function(t){t.Add=function(e){this.createInsOuts(2,0);this._sum=this.input[0]=this.input[1]=this.output=new t.Gain;this._param=this.input[1]=new t.Signal(e);this._param.connect(this._sum)};t.extend(t.Add,t.Signal);t.Add.prototype.dispose=function(){t.prototype.dispose.call(this);this._sum.dispose();this._sum=null;this._param.dispose();this._param=null;return this};return t.Add});i(function(t){t.Multiply=function(e){this.createInsOuts(2,0);this._mult=this.input[0]=this.output=new t.Gain;this._param=this.input[1]=this.output.gain;this._param.value=this.defaultArg(e,0)};t.extend(t.Multiply,t.Signal);t.Multiply.prototype.dispose=function(){t.prototype.dispose.call(this);this._mult.dispose();this._mult=null;this._param=null;return this};return t.Multiply});i(function(t){t.Negate=function(){this._multiply=this.input=this.output=new t.Multiply(-1)};t.extend(t.Negate,t.SignalBase);t.Negate.prototype.dispose=function(){t.prototype.dispose.call(this);this._multiply.dispose();this._multiply=null;return this};return t.Negate});i(function(t){t.Subtract=function(e){this.createInsOuts(2,0);this._sum=this.input[0]=this.output=new t.Gain;this._neg=new t.Negate;this._param=this.input[1]=new t.Signal(e);this._param.chain(this._neg,this._sum)};t.extend(t.Subtract,t.Signal);t.Subtract.prototype.dispose=function(){t.prototype.dispose.call(this);this._neg.dispose();this._neg=null;this._sum.disconnect();this._sum=null;this._param.dispose();this._param=null;return this};return t.Subtract});i(function(t){t.GreaterThanZero=function(){this._thresh=this.output=new t.WaveShaper(function(t){if(t<=0){return 0}else{return 1}},127);this._scale=this.input=new t.Multiply(1e4);this._scale.connect(this._thresh)};t.extend(t.GreaterThanZero,t.SignalBase);t.GreaterThanZero.prototype.dispose=function(){t.prototype.dispose.call(this);this._scale.dispose();this._scale=null;this._thresh.dispose();this._thresh=null;return this};return t.GreaterThanZero});i(function(t){t.GreaterThan=function(e){this.createInsOuts(2,0);this._param=this.input[0]=new t.Subtract(e);this.input[1]=this._param.input[1];this._gtz=this.output=new t.GreaterThanZero;this._param.connect(this._gtz)};t.extend(t.GreaterThan,t.Signal);t.GreaterThan.prototype.dispose=function(){t.prototype.dispose.call(this);this._param.dispose();this._param=null;this._gtz.dispose();this._gtz=null;return this};return t.GreaterThan});i(function(t){t.Abs=function(){this._abs=this.input=this.output=new t.WaveShaper(function(t){if(t===0){return 0}else{return Math.abs(t)}},127)};t.extend(t.Abs,t.SignalBase);t.Abs.prototype.dispose=function(){t.prototype.dispose.call(this);this._abs.dispose();this._abs=null;return this};return t.Abs});i(function(t){t.Modulo=function(e){this.createInsOuts(1,0);this._shaper=new t.WaveShaper(Math.pow(2,16));this._multiply=new t.Multiply;this._subtract=this.output=new t.Subtract;this._modSignal=new t.Signal(e);this.input.fan(this._shaper,this._subtract);this._modSignal.connect(this._multiply,0,0);this._shaper.connect(this._multiply,0,1);this._multiply.connect(this._subtract,0,1);this._setWaveShaper(e)};t.extend(t.Modulo,t.SignalBase);t.Modulo.prototype._setWaveShaper=function(t){this._shaper.setMap(function(e){var i=Math.floor((e+1e-4)/t);return i})};Object.defineProperty(t.Modulo.prototype,"value",{get:function(){return this._modSignal.value},set:function(t){this._modSignal.value=t;this._setWaveShaper(t)}});t.Modulo.prototype.dispose=function(){t.prototype.dispose.call(this);this._shaper.dispose();this._shaper=null;this._multiply.dispose();this._multiply=null;this._subtract.dispose();this._subtract=null;this._modSignal.dispose();this._modSignal=null;return this};return t.Modulo});i(function(t){t.AudioToGain=function(){this._norm=this.input=this.output=new t.WaveShaper(function(t){return(t+1)/2})};t.extend(t.AudioToGain,t.SignalBase);t.AudioToGain.prototype.dispose=function(){t.prototype.dispose.call(this);this._norm.dispose();this._norm=null;return this};return t.AudioToGain});i(function(t){t.Expr=function(){var t=this._replacements(Array.prototype.slice.call(arguments));var e=this._parseInputs(t);this._nodes=[];this.input=new Array(e);for(var i=0;i<e;i++){this.input[i]=this.context.createGain()}var s=this._parseTree(t);var n;try{n=this._eval(s)}catch(e){this._disposeNodes();throw new Error("Tone.Expr: Could evaluate expression: "+t)}this.output=n};t.extend(t.Expr,t.SignalBase);function e(t,e,i){var s=new t;i._eval(e[0]).connect(s,0,0);i._eval(e[1]).connect(s,0,1);return s}function i(t,e,i){var s=new t;i._eval(e[0]).connect(s,0,0);return s}function s(t){return t?parseFloat(t):undefined}function n(t){return t&&t.args?parseFloat(t.args):undefined}t.Expr._Expressions={value:{signal:{regexp:/^\d+\.\d+|^\d+/,method:function(e){var i=new t.Signal(s(e));return i}},input:{regexp:/^\$\d/,method:function(t,e){return e.input[s(t.substr(1))]}}},glue:{"(":{regexp:/^\(/},")":{regexp:/^\)/},",":{regexp:/^,/}},func:{abs:{regexp:/^abs/,method:i.bind(this,t.Abs)},mod:{regexp:/^mod/,method:function(e,i){var s=n(e[1]);var o=new t.Modulo(s);i._eval(e[0]).connect(o);return o}},pow:{regexp:/^pow/,method:function(e,i){var s=n(e[1]);var o=new t.Pow(s);i._eval(e[0]).connect(o);return o}},a2g:{regexp:/^a2g/,method:function(e,i){var s=new t.AudioToGain;i._eval(e[0]).connect(s);return s}}},binary:{"+":{regexp:/^\+/,precedence:1,method:e.bind(this,t.Add)},"-":{regexp:/^\-/,precedence:1,method:function(s,n){if(s.length===1){return i(t.Negate,s,n)}else{return e(t.Subtract,s,n)}}},"*":{regexp:/^\*/,precedence:0,method:e.bind(this,t.Multiply)}},unary:{"-":{regexp:/^\-/,method:i.bind(this,t.Negate)},"!":{regexp:/^\!/,method:i.bind(this,t.NOT)}}};t.Expr.prototype._parseInputs=function(t){var e=t.match(/\$\d/g);var i=0;if(e!==null){for(var s=0;s<e.length;s++){var n=parseInt(e[s].substr(1))+1;i=Math.max(i,n)}}return i};t.Expr.prototype._replacements=function(t){var e=t.shift();for(var i=0;i<t.length;i++){e=e.replace(/\%/i,t[i])}return e};t.Expr.prototype._tokenize=function(e){var i=-1;var s=[];while(e.length>0){e=e.trim();var n=o(e);s.push(n);e=e.substr(n.value.length)}function o(e){for(var i in t.Expr._Expressions){var s=t.Expr._Expressions[i];for(var n in s){var o=s[n];var r=o.regexp;var a=e.match(r);if(a!==null){return{type:i,value:a[0],method:o.method}}}}throw new SyntaxError("Tone.Expr: Unexpected token "+e)}return{next:function(){return s[++i]},peek:function(){return s[i+1]}}};t.Expr.prototype._parseTree=function(e){var i=this._tokenize(e);var s=this.isUndef.bind(this);function n(t,e){return!s(t)&&t.type==="glue"&&t.value===e}function o(e,i,n){var o=false;var r=t.Expr._Expressions[i];if(!s(e)){for(var a in r){var l=r[a];if(l.regexp.test(e.value)){if(!s(n)){if(l.precedence===n){return true}}else{return true}}}}return o}function r(t){if(s(t)){t=5}var e;if(t<0){e=a()}else{e=r(t-1)}var n=i.peek();while(o(n,"binary",t)){n=i.next();e={operator:n.value,method:n.method,args:[e,r(t-1)]};n=i.peek()}return e}function a(){var t,e;t=i.peek();if(o(t,"unary")){t=i.next();e=a();return{operator:t.value,method:t.method,args:[e]}}return l()}function l(){var t,e;t=i.peek();if(s(t)){throw new SyntaxError("Tone.Expr: Unexpected termination of expression")}if(t.type==="func"){t=i.next();return h(t)}if(t.type==="value"){t=i.next();return{method:t.method,args:t.value}}if(n(t,"(")){i.next();e=r();t=i.next();if(!n(t,")")){throw new SyntaxError("Expected )")}return e}throw new SyntaxError("Tone.Expr: Parse error, cannot process token "+t.value)}function h(t){var e,s=[];e=i.next();if(!n(e,"(")){throw new SyntaxError('Tone.Expr: Expected ( in a function call "'+t.value+'"')}e=i.peek();if(!n(e,")")){s=u()}e=i.next();if(!n(e,")")){throw new SyntaxError('Tone.Expr: Expected ) in a function call "'+t.value+'"')}return{method:t.method,args:s,name:name}}function u(){var t,e,o=[];while(true){e=r();if(s(e)){break}o.push(e);t=i.peek();if(!n(t,",")){break}i.next()}return o}return r()};t.Expr.prototype._eval=function(t){if(!this.isUndef(t)){var e=t.method(t.args,this);this._nodes.push(e);return e}};t.Expr.prototype._disposeNodes=function(){for(var t=0;t<this._nodes.length;t++){var e=this._nodes[t];if(this.isFunction(e.dispose)){e.dispose()}else if(this.isFunction(e.disconnect)){e.disconnect()}e=null;this._nodes[t]=null}this._nodes=null};t.Expr.prototype.dispose=function(){t.prototype.dispose.call(this);this._disposeNodes()};return t.Expr});i(function(t){t.EqualPowerGain=function(){this._eqPower=this.input=this.output=new t.WaveShaper(function(t){if(Math.abs(t)<.001){return 0}else{return this.equalPowerScale(t)}}.bind(this),4096)};t.extend(t.EqualPowerGain,t.SignalBase);t.EqualPowerGain.prototype.dispose=function(){t.prototype.dispose.call(this);this._eqPower.dispose();this._eqPower=null;return this};return t.EqualPowerGain});i(function(t){t.CrossFade=function(e){this.createInsOuts(2,1);this.a=this.input[0]=new t.Gain;this.b=this.input[1]=new t.Gain;this.fade=new t.Signal(this.defaultArg(e,.5),t.Type.NormalRange);this._equalPowerA=new t.EqualPowerGain;this._equalPowerB=new t.EqualPowerGain;this._invert=new t.Expr("1 - $0");this.a.connect(this.output);this.b.connect(this.output);this.fade.chain(this._equalPowerB,this.b.gain);this.fade.chain(this._invert,this._equalPowerA,this.a.gain);this._readOnly("fade")};t.extend(t.CrossFade);t.CrossFade.prototype.dispose=function(){t.prototype.dispose.call(this);this._writable("fade");this._equalPowerA.dispose();this._equalPowerA=null;this._equalPowerB.dispose();this._equalPowerB=null;this.fade.dispose();this.fade=null;this._invert.dispose();this._invert=null;this.a.dispose();this.a=null;this.b.dispose();this.b=null;return this};return t.CrossFade});i(function(t){t.Filter=function(){this.createInsOuts(1,1);var e=this.optionsObject(arguments,["frequency","type","rolloff"],t.Filter.defaults);this._filters=[];this.frequency=new t.Signal(e.frequency,t.Type.Frequency);this.detune=new t.Signal(0,t.Type.Cents);this.gain=new t.Signal({value:e.gain,convert:false});this.Q=new t.Signal(e.Q);this._type=e.type;this._rolloff=e.rolloff;this.rolloff=e.rolloff;this._readOnly(["detune","frequency","gain","Q"])};t.extend(t.Filter);t.Filter.defaults={type:"lowpass",frequency:350,rolloff:-12,Q:1,gain:0};Object.defineProperty(t.Filter.prototype,"type",{get:function(){return this._type},set:function(t){var e=["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"];if(e.indexOf(t)===-1){throw new TypeError("Tone.Filter: invalid type "+t)}this._type=t;for(var i=0;i<this._filters.length;i++){this._filters[i].type=t}}});Object.defineProperty(t.Filter.prototype,"rolloff",{get:function(){return this._rolloff},set:function(t){t=parseInt(t,10);var e=[-12,-24,-48,-96];var i=e.indexOf(t);if(i===-1){throw new RangeError("Tone.Filter: rolloff can only be -12, -24, -48 or -96")}i+=1;this._rolloff=t;this.input.disconnect();for(var s=0;s<this._filters.length;s++){this._filters[s].disconnect();this._filters[s]=null}this._filters=new Array(i);for(var n=0;n<i;n++){var o=this.context.createBiquadFilter();o.type=this._type;this.frequency.connect(o.frequency);this.detune.connect(o.detune);this.Q.connect(o.Q);this.gain.connect(o.gain);this._filters[n]=o}var r=[this.input].concat(this._filters).concat([this.output]);this.connectSeries.apply(this,r)}});t.Filter.prototype.dispose=function(){t.prototype.dispose.call(this);for(var e=0;e<this._filters.length;e++){this._filters[e].disconnect();this._filters[e]=null}this._filters=null;this._writable(["detune","frequency","gain","Q"]);this.frequency.dispose();this.Q.dispose();this.frequency=null;this.Q=null;this.detune.dispose();this.detune=null;this.gain.dispose();this.gain=null;return this};return t.Filter});i(function(t){t.MultibandSplit=function(){var e=this.optionsObject(arguments,["lowFrequency","highFrequency"],t.MultibandSplit.defaults);this.input=new t.Gain;this.output=new Array(3);this.low=this.output[0]=new t.Filter(0,"lowpass");this._lowMidFilter=new t.Filter(0,"highpass");this.mid=this.output[1]=new t.Filter(0,"lowpass");this.high=this.output[2]=new t.Filter(0,"highpass");this.lowFrequency=new t.Signal(e.lowFrequency,t.Type.Frequency);this.highFrequency=new t.Signal(e.highFrequency,t.Type.Frequency);this.Q=new t.Signal(e.Q);this.input.fan(this.low,this.high);this.input.chain(this._lowMidFilter,this.mid);this.lowFrequency.connect(this.low.frequency);this.lowFrequency.connect(this._lowMidFilter.frequency);this.highFrequency.connect(this.mid.frequency);this.highFrequency.connect(this.high.frequency);this.Q.connect(this.low.Q);this.Q.connect(this._lowMidFilter.Q);this.Q.connect(this.mid.Q);this.Q.connect(this.high.Q);this._readOnly(["high","mid","low","highFrequency","lowFrequency"])};t.extend(t.MultibandSplit);t.MultibandSplit.defaults={lowFrequency:400,highFrequency:2500,Q:1};t.MultibandSplit.prototype.dispose=function(){t.prototype.dispose.call(this);this._writable(["high","mid","low","highFrequency","lowFrequency"]);this.low.dispose();this.low=null;this._lowMidFilter.dispose();this._lowMidFilter=null;this.mid.dispose();this.mid=null;this.high.dispose();this.high=null;this.lowFrequency.dispose();this.lowFrequency=null;this.highFrequency.dispose();this.highFrequency=null;this.Q.dispose();this.Q=null;return this};return t.MultibandSplit});i(function(t){t.EQ3=function(){var e=this.optionsObject(arguments,["low","mid","high"],t.EQ3.defaults);this.output=new t.Gain;this._multibandSplit=this.input=new t.MultibandSplit({lowFrequency:e.lowFrequency,highFrequency:e.highFrequency});this._lowGain=new t.Gain(e.low,t.Type.Decibels);this._midGain=new t.Gain(e.mid,t.Type.Decibels);this._highGain=new t.Gain(e.high,t.Type.Decibels);this.low=this._lowGain.gain;this.mid=this._midGain.gain;this.high=this._highGain.gain;this.Q=this._multibandSplit.Q;this.lowFrequency=this._multibandSplit.lowFrequency;this.highFrequency=this._multibandSplit.highFrequency;this._multibandSplit.low.chain(this._lowGain,this.output);this._multibandSplit.mid.chain(this._midGain,this.output);this._multibandSplit.high.chain(this._highGain,this.output);this._readOnly(["low","mid","high","lowFrequency","highFrequency"])};t.extend(t.EQ3);t.EQ3.defaults={low:0,mid:0,high:0,lowFrequency:400,highFrequency:2500};t.EQ3.prototype.dispose=function(){t.prototype.dispose.call(this);this._writable(["low","mid","high","lowFrequency","highFrequency"]);this._multibandSplit.dispose();this._multibandSplit=null;this.lowFrequency=null;this.highFrequency=null;this._lowGain.dispose();this._lowGain=null;this._midGain.dispose();this._midGain=null;this._highGain.dispose();this._highGain=null;this.low=null;this.mid=null;this.high=null;this.Q=null;return this};return t.EQ3});i(function(t){t.Scale=function(e,i){this._outputMin=this.defaultArg(e,0);this._outputMax=this.defaultArg(i,1);this._scale=this.input=new t.Multiply(1);this._add=this.output=new t.Add(0);this._scale.connect(this._add);this._setRange()};t.extend(t.Scale,t.SignalBase);Object.defineProperty(t.Scale.prototype,"min",{get:function(){return this._outputMin},set:function(t){this._outputMin=t;this._setRange()}});Object.defineProperty(t.Scale.prototype,"max",{get:function(){return this._outputMax},set:function(t){this._outputMax=t;this._setRange()}});t.Scale.prototype._setRange=function(){this._add.value=this._outputMin;this._scale.value=this._outputMax-this._outputMin};t.Scale.prototype.dispose=function(){t.prototype.dispose.call(this);this._add.dispose();this._add=null;this._scale.dispose();this._scale=null;return this};return t.Scale});i(function(t){t.ScaleExp=function(e,i,s){this._scale=this.output=new t.Scale(e,i);this._exp=this.input=new t.Pow(this.defaultArg(s,2));this._exp.connect(this._scale)};t.extend(t.ScaleExp,t.SignalBase);Object.defineProperty(t.ScaleExp.prototype,"exponent",{get:function(){return this._exp.value},set:function(t){this._exp.value=t}});Object.defineProperty(t.ScaleExp.prototype,"min",{get:function(){return this._scale.min},set:function(t){this._scale.min=t}});Object.defineProperty(t.ScaleExp.prototype,"max",{get:function(){return this._scale.max},set:function(t){this._scale.max=t}});t.ScaleExp.prototype.dispose=function(){t.prototype.dispose.call(this);this._scale.dispose();this._scale=null;this._exp.dispose();this._exp=null;return this};return t.ScaleExp});i(function(t){t.Delay=function(){var e=this.optionsObject(arguments,["delayTime","maxDelay"],t.Delay.defaults);this._delayNode=this.input=this.output=this.context.createDelay(this.toSeconds(e.maxDelay));this.delayTime=new t.Param({param:this._delayNode.delayTime,units:t.Type.Time,
value:e.delayTime});this._readOnly("delayTime")};t.extend(t.Delay);t.Delay.defaults={maxDelay:1,delayTime:0};t.Delay.prototype.dispose=function(){t.Param.prototype.dispose.call(this);this._delayNode.disconnect();this._delayNode=null;this._writable("delayTime");this.delayTime=null;return this};return t.Delay});i(function(t){t.FeedbackCombFilter=function(){var e=this.optionsObject(arguments,["delayTime","resonance"],t.FeedbackCombFilter.defaults);this._delay=this.input=this.output=new t.Delay(e.delayTime);this.delayTime=this._delay.delayTime;this._feedback=new t.Gain(e.resonance,t.Type.NormalRange);this.resonance=this._feedback.gain;this._delay.chain(this._feedback,this._delay);this._readOnly(["resonance","delayTime"])};t.extend(t.FeedbackCombFilter);t.FeedbackCombFilter.defaults={delayTime:.1,resonance:.5};t.FeedbackCombFilter.prototype.dispose=function(){t.prototype.dispose.call(this);this._writable(["resonance","delayTime"]);this._delay.dispose();this._delay=null;this.delayTime=null;this._feedback.dispose();this._feedback=null;this.resonance=null;return this};return t.FeedbackCombFilter});i(function(t){t.Follower=function(){this.createInsOuts(1,1);var e=this.optionsObject(arguments,["attack","release"],t.Follower.defaults);this._abs=new t.Abs;this._filter=this.context.createBiquadFilter();this._filter.type="lowpass";this._filter.frequency.value=0;this._filter.Q.value=-100;this._frequencyValues=new t.WaveShaper;this._sub=new t.Subtract;this._delay=new t.Delay(this.blockTime);this._mult=new t.Multiply(1e4);this._attack=e.attack;this._release=e.release;this.input.chain(this._abs,this._filter,this.output);this._abs.connect(this._sub,0,1);this._filter.chain(this._delay,this._sub);this._sub.chain(this._mult,this._frequencyValues,this._filter.frequency);this._setAttackRelease(this._attack,this._release)};t.extend(t.Follower);t.Follower.defaults={attack:.05,release:.5};t.Follower.prototype._setAttackRelease=function(e,i){var s=this.blockTime;e=t.Time(e).toFrequency();i=t.Time(i).toFrequency();e=Math.max(e,s);i=Math.max(i,s);this._frequencyValues.setMap(function(t){if(t<=0){return e}else{return i}})};Object.defineProperty(t.Follower.prototype,"attack",{get:function(){return this._attack},set:function(t){this._attack=t;this._setAttackRelease(this._attack,this._release)}});Object.defineProperty(t.Follower.prototype,"release",{get:function(){return this._release},set:function(t){this._release=t;this._setAttackRelease(this._attack,this._release)}});t.Follower.prototype.connect=t.Signal.prototype.connect;t.Follower.prototype.dispose=function(){t.prototype.dispose.call(this);this._filter.disconnect();this._filter=null;this._frequencyValues.disconnect();this._frequencyValues=null;this._delay.dispose();this._delay=null;this._sub.disconnect();this._sub=null;this._abs.dispose();this._abs=null;this._mult.dispose();this._mult=null;this._curve=null;return this};return t.Follower});i(function(t){t.ScaledEnvelope=function(){var e=this.optionsObject(arguments,["attack","decay","sustain","release"],t.Envelope.defaults);t.Envelope.call(this,e);e=this.defaultArg(e,t.ScaledEnvelope.defaults);this._exp=this.output=new t.Pow(e.exponent);this._scale=this.output=new t.Scale(e.min,e.max);this._sig.chain(this._exp,this._scale)};t.extend(t.ScaledEnvelope,t.Envelope);t.ScaledEnvelope.defaults={min:0,max:1,exponent:1};Object.defineProperty(t.ScaledEnvelope.prototype,"min",{get:function(){return this._scale.min},set:function(t){this._scale.min=t}});Object.defineProperty(t.ScaledEnvelope.prototype,"max",{get:function(){return this._scale.max},set:function(t){this._scale.max=t}});Object.defineProperty(t.ScaledEnvelope.prototype,"exponent",{get:function(){return this._exp.value},set:function(t){this._exp.value=t}});t.ScaledEnvelope.prototype.dispose=function(){t.Envelope.prototype.dispose.call(this);this._scale.dispose();this._scale=null;this._exp.dispose();this._exp=null;return this};return t.ScaledEnvelope});i(function(t){t.FrequencyEnvelope=function(){var e=this.optionsObject(arguments,["attack","decay","sustain","release"],t.Envelope.defaults);t.ScaledEnvelope.call(this,e);e=this.defaultArg(e,t.FrequencyEnvelope.defaults);this._octaves=e.octaves;this.baseFrequency=e.baseFrequency;this.octaves=e.octaves};t.extend(t.FrequencyEnvelope,t.Envelope);t.FrequencyEnvelope.defaults={baseFrequency:200,octaves:4,exponent:2};Object.defineProperty(t.FrequencyEnvelope.prototype,"baseFrequency",{get:function(){return this._scale.min},set:function(t){this._scale.min=this.toFrequency(t);this.octaves=this._octaves}});Object.defineProperty(t.FrequencyEnvelope.prototype,"octaves",{get:function(){return this._octaves},set:function(t){this._octaves=t;this._scale.max=this.baseFrequency*Math.pow(2,t)}});Object.defineProperty(t.FrequencyEnvelope.prototype,"exponent",{get:function(){return this._exp.value},set:function(t){this._exp.value=t}});t.FrequencyEnvelope.prototype.dispose=function(){t.ScaledEnvelope.prototype.dispose.call(this);return this};return t.FrequencyEnvelope});i(function(t){t.Gate=function(){this.createInsOuts(1,1);var e=this.optionsObject(arguments,["threshold","attack","release"],t.Gate.defaults);this._follower=new t.Follower(e.attack,e.release);this._gt=new t.GreaterThan(this.dbToGain(e.threshold));this.input.connect(this.output);this.input.chain(this._gt,this._follower,this.output.gain)};t.extend(t.Gate);t.Gate.defaults={attack:.1,release:.1,threshold:-40};Object.defineProperty(t.Gate.prototype,"threshold",{get:function(){return this.gainToDb(this._gt.value)},set:function(t){this._gt.value=this.dbToGain(t)}});Object.defineProperty(t.Gate.prototype,"attack",{get:function(){return this._follower.attack},set:function(t){this._follower.attack=t}});Object.defineProperty(t.Gate.prototype,"release",{get:function(){return this._follower.release},set:function(t){this._follower.release=t}});t.Gate.prototype.dispose=function(){t.prototype.dispose.call(this);this._follower.dispose();this._gt.dispose();this._follower=null;this._gt=null;return this};return t.Gate});i(function(t){t.TimelineState=function(e){t.Timeline.call(this);this._initial=e};t.extend(t.TimelineState,t.Timeline);t.TimelineState.prototype.getStateAtTime=function(t){var e=this.getEvent(t);if(e!==null){return e.state}else{return this._initial}};t.TimelineState.prototype.setStateAtTime=function(t,e){this.addEvent({state:t,time:e})};return t.TimelineState});i(function(t){t.Emitter=function(){this._events={}};t.extend(t.Emitter);t.Emitter.prototype.on=function(t,e){var i=t.split(/\W+/);for(var s=0;s<i.length;s++){var n=i[s];if(!this._events.hasOwnProperty(n)){this._events[n]=[]}this._events[n].push(e)}return this};t.Emitter.prototype.off=function(e,i){var s=e.split(/\W+/);for(var n=0;n<s.length;n++){e=s[n];if(this._events.hasOwnProperty(e)){if(t.prototype.isUndef(i)){this._events[e]=[]}else{var o=this._events[e];for(var r=0;r<o.length;r++){if(o[r]===i){o.splice(r,1)}}}}}return this};t.Emitter.prototype.emit=function(t){if(this._events){var e=Array.prototype.slice.call(arguments,1);if(this._events.hasOwnProperty(t)){var i=this._events[t];for(var s=0,n=i.length;s<n;s++){i[s].apply(this,e)}}}return this};t.Emitter.mixin=function(e){var i=["on","off","emit"];e._events={};for(var s=0;s<i.length;s++){var n=i[s];var o=t.Emitter.prototype[n];e[n]=o}};t.Emitter.prototype.dispose=function(){t.prototype.dispose.call(this);this._events=null;return this};return t.Emitter});i(function(t){t.Clock=function(){t.Emitter.call(this);var i=this.optionsObject(arguments,["callback","frequency"],t.Clock.defaults);this.callback=i.callback;this._lookAhead="auto";this._computedLookAhead=e/1e3;this._nextTick=-1;this._lastUpdate=-1;this.frequency=new t.TimelineSignal(i.frequency,t.Type.Frequency);this.ticks=0;this._state=new t.TimelineState(t.State.Stopped);this._boundLoop=this._loop.bind(this);t.Clock._worker.addEventListener("message",this._boundLoop);this._readOnly("frequency")};t.extend(t.Clock,t.Emitter);t.Clock.defaults={callback:t.noOp,frequency:1,lookAhead:"auto"};Object.defineProperty(t.Clock.prototype,"state",{get:function(){return this._state.getStateAtTime(this.now())}});Object.defineProperty(t.Clock.prototype,"lookAhead",{get:function(){return this._lookAhead},set:function(t){if(t==="auto"){this._lookAhead="auto"}else{this._lookAhead=this.toSeconds(t)}}});t.Clock.prototype.start=function(e,i){e=this.toSeconds(e);if(this._state.getStateAtTime(e)!==t.State.Started){this._state.addEvent({state:t.State.Started,time:e,offset:i})}return this};t.Clock.prototype.stop=function(e){e=this.toSeconds(e);this._state.cancel(e);this._state.setStateAtTime(t.State.Stopped,e);return this};t.Clock.prototype.pause=function(e){e=this.toSeconds(e);if(this._state.getStateAtTime(e)===t.State.Started){this._state.setStateAtTime(t.State.Paused,e)}return this};t.Clock.prototype._loop=function(){if(this._lookAhead==="auto"){var i=this.now();if(this._lastUpdate!==-1){var s=i-this._lastUpdate;s=Math.min(10*e/1e3,s);this._computedLookAhead=(9*this._computedLookAhead+s)/10}this._lastUpdate=i}else{this._computedLookAhead=this._lookAhead}var n=this.now();var o=this._computedLookAhead*2;var r=this._state.getEvent(n+o);var a=t.State.Stopped;if(r){a=r.state;if(this._nextTick===-1&&a===t.State.Started){this._nextTick=r.time;if(!this.isUndef(r.offset)){this.ticks=r.offset}this.emit("start",r.time,this.ticks)}}if(a===t.State.Started){while(n+o>this._nextTick){var l=this._nextTick;this._nextTick+=1/this.frequency.getValueAtTime(this._nextTick);this.callback(l);this.ticks++}}else if(a===t.State.Stopped){if(r&&this.ticks!==0){this.emit("stop",r.time)}this._nextTick=-1;this.ticks=0}else if(a===t.State.Paused){if(this._nextTick!==-1){this.emit("pause",r.time)}this._nextTick=-1}};t.Clock.prototype.getStateAtTime=function(t){t=this.toSeconds(t);return this._state.getStateAtTime(t)};t.Clock.prototype.dispose=function(){t.Emitter.prototype.dispose.call(this);t.TimelineState.prototype.dispose.call(this);t.Clock._worker.removeEventListener("message",this._boundLoop);this._writable("frequency");this.frequency.dispose();this.frequency=null;this._boundLoop=null;this._nextTick=Infinity;this.callback=null;this._state.dispose();this._state=null};window.URL=window.URL||window.webkitURL;var e=20;var i=new Blob(["setInterval(function(){self.postMessage('tick')}, "+e+")"]);var s=URL.createObjectURL(i);t.Clock._worker=new Worker(s);return t.Clock});i(function(t){t.IntervalTimeline=function(){this._root=null;this._length=0};t.extend(t.IntervalTimeline);t.IntervalTimeline.prototype.addEvent=function(t){if(this.isUndef(t.time)||this.isUndef(t.duration)){throw new Error("Tone.IntervalTimeline: events must have time and duration parameters")}var i=new e(t.time,t.time+t.duration,t);if(this._root===null){this._root=i}else{this._root.insert(i)}this._length++;while(i!==null){i.updateHeight();i.updateMax();this._rebalance(i);i=i.parent}return this};t.IntervalTimeline.prototype.removeEvent=function(t){if(this._root!==null){var e=[];this._root.search(t.time,e);for(var i=0;i<e.length;i++){var s=e[i];if(s.event===t){this._removeNode(s);this._length--;break}}}return this};Object.defineProperty(t.IntervalTimeline.prototype,"length",{get:function(){return this._length}});t.IntervalTimeline.prototype.cancel=function(t){this.forEachAfter(t,function(t){this.removeEvent(t)}.bind(this));return this};t.IntervalTimeline.prototype._setRoot=function(t){this._root=t;if(this._root!==null){this._root.parent=null}};t.IntervalTimeline.prototype._replaceNodeInParent=function(t,e){if(t.parent!==null){if(t.isLeftChild()){t.parent.left=e}else{t.parent.right=e}this._rebalance(t.parent)}else{this._setRoot(e)}};t.IntervalTimeline.prototype._removeNode=function(t){if(t.left===null&&t.right===null){this._replaceNodeInParent(t,null)}else if(t.right===null){this._replaceNodeInParent(t,t.left)}else if(t.left===null){this._replaceNodeInParent(t,t.right)}else{var e=t.getBalance();var i,s;if(e>0){if(t.left.right===null){i=t.left;i.right=t.right;s=i}else{i=t.left.right;while(i.right!==null){i=i.right}i.parent.right=i.left;s=i.parent;i.left=t.left;i.right=t.right}}else{if(t.right.left===null){i=t.right;i.left=t.left;s=i}else{i=t.right.left;while(i.left!==null){i=i.left}i.parent=i.parent;i.parent.left=i.right;s=i.parent;i.left=t.left;i.right=t.right}}if(t.parent!==null){if(t.isLeftChild()){t.parent.left=i}else{t.parent.right=i}}else{this._setRoot(i)}this._rebalance(s)}t.dispose()};t.IntervalTimeline.prototype._rotateLeft=function(t){var e=t.parent;var i=t.isLeftChild();var s=t.right;t.right=s.left;s.left=t;if(e!==null){if(i){e.left=s}else{e.right=s}}else{this._setRoot(s)}};t.IntervalTimeline.prototype._rotateRight=function(t){var e=t.parent;var i=t.isLeftChild();var s=t.left;t.left=s.right;s.right=t;if(e!==null){if(i){e.left=s}else{e.right=s}}else{this._setRoot(s)}};t.IntervalTimeline.prototype._rebalance=function(t){var e=t.getBalance();if(e>1){if(t.left.getBalance()<0){this._rotateLeft(t.left)}else{this._rotateRight(t)}}else if(e<-1){if(t.right.getBalance()>0){this._rotateRight(t.right)}else{this._rotateLeft(t)}}};t.IntervalTimeline.prototype.getEvent=function(t){if(this._root!==null){var e=[];this._root.search(t,e);if(e.length>0){var i=e[0];for(var s=1;s<e.length;s++){if(e[s].low>i.low){i=e[s]}}return i.event}}return null};t.IntervalTimeline.prototype.forEach=function(t){if(this._root!==null){var e=[];if(this._root!==null){this._root.traverse(function(t){e.push(t)})}for(var i=0;i<e.length;i++){var s=e[i].event;if(s){t(s)}}}return this};t.IntervalTimeline.prototype.forEachAtTime=function(t,e){if(this._root!==null){var i=[];this._root.search(t,i);for(var s=i.length-1;s>=0;s--){var n=i[s].event;if(n){e(n)}}}return this};t.IntervalTimeline.prototype.forEachAfter=function(t,e){if(this._root!==null){var i=[];this._root.searchAfter(t,i);for(var s=i.length-1;s>=0;s--){var n=i[s].event;if(n){e(n)}}}return this};t.IntervalTimeline.prototype.dispose=function(){var t=[];if(this._root!==null){this._root.traverse(function(e){t.push(e)})}for(var e=0;e<t.length;e++){t[e].dispose()}t=null;this._root=null;return this};var e=function(t,e,i){this.event=i;this.low=t;this.high=e;this.max=this.high;this._left=null;this._right=null;this.parent=null;this.height=0};e.prototype.insert=function(t){if(t.low<=this.low){if(this.left===null){this.left=t}else{this.left.insert(t)}}else{if(this.right===null){this.right=t}else{this.right.insert(t)}}};e.prototype.search=function(t,e){if(t>this.max){return}if(this.left!==null){this.left.search(t,e)}if(this.low<=t&&this.high>t){e.push(this)}if(this.low>t){return}if(this.right!==null){this.right.search(t,e)}};e.prototype.searchAfter=function(t,e){if(this.low>=t){e.push(this);if(this.left!==null){this.left.searchAfter(t,e)}}if(this.right!==null){this.right.searchAfter(t,e)}};e.prototype.traverse=function(t){t(this);if(this.left!==null){this.left.traverse(t)}if(this.right!==null){this.right.traverse(t)}};e.prototype.updateHeight=function(){if(this.left!==null&&this.right!==null){this.height=Math.max(this.left.height,this.right.height)+1}else if(this.right!==null){this.height=this.right.height+1}else if(this.left!==null){this.height=this.left.height+1}else{this.height=0}};e.prototype.updateMax=function(){this.max=this.high;if(this.left!==null){this.max=Math.max(this.max,this.left.max)}if(this.right!==null){this.max=Math.max(this.max,this.right.max)}};e.prototype.getBalance=function(){var t=0;if(this.left!==null&&this.right!==null){t=this.left.height-this.right.height}else if(this.left!==null){t=this.left.height+1}else if(this.right!==null){t=-(this.right.height+1)}return t};e.prototype.isLeftChild=function(){return this.parent!==null&&this.parent.left===this};Object.defineProperty(e.prototype,"left",{get:function(){return this._left},set:function(t){this._left=t;if(t!==null){t.parent=this}this.updateHeight();this.updateMax()}});Object.defineProperty(e.prototype,"right",{get:function(){return this._right},set:function(t){this._right=t;if(t!==null){t.parent=this}this.updateHeight();this.updateMax()}});e.prototype.dispose=function(){this.parent=null;this._left=null;this._right=null;this.event=null};return t.IntervalTimeline});i(function(t){t.Transport=function(){t.Emitter.call(this);this.loop=false;this._loopStart=0;this._loopEnd=0;this._ppq=e.defaults.PPQ;this._clock=new t.Clock({callback:this._processTick.bind(this),frequency:0});this._bindClockEvents();this.bpm=this._clock.frequency;this.bpm._toUnits=this._toUnits.bind(this);this.bpm._fromUnits=this._fromUnits.bind(this);this.bpm.units=t.Type.BPM;this.bpm.value=e.defaults.bpm;this._readOnly("bpm");this._timeSignature=e.defaults.timeSignature;this._scheduledEvents={};this._eventID=0;this._timeline=new t.Timeline;this._repeatedEvents=new t.IntervalTimeline;this._onceEvents=new t.Timeline;this._syncedSignals=[];this._swingTicks=e.defaults.PPQ/2;this._swingAmount=0};t.extend(t.Transport,t.Emitter);t.Transport.defaults={bpm:120,swing:0,swingSubdivision:"8n",timeSignature:4,loopStart:0,loopEnd:"4m",PPQ:192};t.Transport.prototype._processTick=function(e){var i=this._clock.ticks;if(this._swingAmount>0&&i%this._ppq!==0&&i%(this._swingTicks*2)!==0){var s=i%(this._swingTicks*2)/(this._swingTicks*2);var n=Math.sin(s*Math.PI)*this._swingAmount;e+=t.Time(this._swingTicks*2/3,"i").eval()*n}if(this.loop){if(i===this._loopEnd){this.emit("stop",e);this._clock.ticks=this._loopStart;i=this._loopStart;this.emit("start",e,this.seconds);this.emit("loop",e)}}this._onceEvents.forEachBefore(i,function(t){t.callback(e)});this._onceEvents.cancelBefore(i);this._timeline.forEachAtTime(i,function(t){t.callback(e)});this._repeatedEvents.forEachAtTime(i,function(t){if((i-t.time)%t.interval===0){t.callback(e)}})};t.Transport.prototype.schedule=function(t,e){var i={time:this.toTicks(e),callback:t};var s=this._eventID++;this._scheduledEvents[s.toString()]={event:i,timeline:this._timeline};this._timeline.addEvent(i);return s};t.Transport.prototype.scheduleRepeat=function(t,e,i,s){if(e<=0){throw new Error("Tone.Transport: repeat events must have an interval larger than 0")}var n={time:this.toTicks(i),duration:this.toTicks(this.defaultArg(s,Infinity)),interval:this.toTicks(e),callback:t};var o=this._eventID++;this._scheduledEvents[o.toString()]={event:n,timeline:this._repeatedEvents};this._repeatedEvents.addEvent(n);return o};t.Transport.prototype.scheduleOnce=function(t,e){var i={time:this.toTicks(e),callback:t};var s=this._eventID++;this._scheduledEvents[s.toString()]={event:i,timeline:this._onceEvents};this._onceEvents.addEvent(i);return s};t.Transport.prototype.clear=function(t){if(this._scheduledEvents.hasOwnProperty(t)){var e=this._scheduledEvents[t.toString()];e.timeline.removeEvent(e.event);delete this._scheduledEvents[t.toString()]}return this};t.Transport.prototype.cancel=function(t){t=this.defaultArg(t,0);t=this.toTicks(t);this._timeline.cancel(t);this._onceEvents.cancel(t);this._repeatedEvents.cancel(t);return this};t.Transport.prototype._bindClockEvents=function(){this._clock.on("start",function(e,i){i=t.Time(this._clock.ticks,"i").toSeconds();this.emit("start",e,i)}.bind(this));this._clock.on("stop",function(t){this.emit("stop",t)}.bind(this));this._clock.on("pause",function(t){this.emit("pause",t)}.bind(this))};Object.defineProperty(t.Transport.prototype,"state",{get:function(){return this._clock.getStateAtTime(this.now())}});t.Transport.prototype.start=function(t,e){if(!this.isUndef(e)){e=this.toTicks(e)}this._clock.start(t,e);return this};t.Transport.prototype.stop=function(t){this._clock.stop(t);return this};t.Transport.prototype.pause=function(t){this._clock.pause(t);return this};Object.defineProperty(t.Transport.prototype,"timeSignature",{get:function(){return this._timeSignature},set:function(t){if(this.isArray(t)){t=t[0]/t[1]*4}this._timeSignature=t}});Object.defineProperty(t.Transport.prototype,"loopStart",{get:function(){return t.TransportTime(this._loopStart,"i").toSeconds()},set:function(t){this._loopStart=this.toTicks(t)}});Object.defineProperty(t.Transport.prototype,"loopEnd",{get:function(){return t.TransportTime(this._loopEnd,"i").toSeconds()},set:function(t){this._loopEnd=this.toTicks(t)}});t.Transport.prototype.setLoopPoints=function(t,e){this.loopStart=t;this.loopEnd=e;return this};Object.defineProperty(t.Transport.prototype,"swing",{get:function(){return this._swingAmount},set:function(t){this._swingAmount=t}});Object.defineProperty(t.Transport.prototype,"swingSubdivision",{get:function(){return t.Time(this._swingTicks,"i").toNotation()},set:function(t){this._swingTicks=this.toTicks(t)}});Object.defineProperty(t.Transport.prototype,"position",{get:function(){return t.TransportTime(this.ticks,"i").toBarsBeatsSixteenths()},set:function(t){var e=this.toTicks(t);this.ticks=e}});Object.defineProperty(t.Transport.prototype,"seconds",{get:function(){return t.TransportTime(this.ticks,"i").toSeconds()},set:function(t){var e=this.toTicks(t);this.ticks=e}});Object.defineProperty(t.Transport.prototype,"progress",{get:function(){if(this.loop){return(this.ticks-this._loopStart)/(this._loopEnd-this._loopStart)}else{return 0}}});Object.defineProperty(t.Transport.prototype,"ticks",{get:function(){return this._clock.ticks},set:function(e){var i=this.now();if(this.state===t.State.Started){this.emit("stop",i);this._clock.ticks=e;this.emit("start",i,this.seconds)}else{this._clock.ticks=e}}});Object.defineProperty(t.Transport.prototype,"PPQ",{get:function(){return this._ppq},set:function(t){var e=this.bpm.value;this._ppq=t;this.bpm.value=e}});t.Transport.prototype._fromUnits=function(t){return 1/(60/t/this.PPQ)};t.Transport.prototype._toUnits=function(t){return t/this.PPQ*60};t.Transport.prototype.nextSubdivision=function(e){e=this.toSeconds(e);var i;if(this.state===t.State.Started){i=this._clock._nextTick}else{return 0}var s=t.Time(this.ticks,"i").eval();var n=e-s%e;if(n===0){n=e}return i+n};t.Transport.prototype.syncSignal=function(e,i){if(!i){if(e._param.value!==0){i=e._param.value/this.bpm._param.value}else{i=0}}var s=new t.Gain(i);this.bpm.chain(s,e._param);this._syncedSignals.push({ratio:s,signal:e,initial:e._param.value});e._param.value=0;return this};t.Transport.prototype.unsyncSignal=function(t){for(var e=this._syncedSignals.length-1;e>=0;e--){var i=this._syncedSignals[e];if(i.signal===t){i.ratio.dispose();i.signal._param.value=i.initial;this._syncedSignals.splice(e,1)}}return this};t.Transport.prototype.dispose=function(){t.Emitter.prototype.dispose.call(this);this._clock.dispose();this._clock=null;this._writable("bpm");this.bpm=null;this._timeline.dispose();this._timeline=null;this._onceEvents.dispose();this._onceEvents=null;this._repeatedEvents.dispose();this._repeatedEvents=null;return this};var e=t.Transport;t._initAudioContext(function(){if(typeof t.Transport==="function"){t.Transport=new t.Transport}else{t.Transport.stop();var i=t.Transport.get();t.Transport.dispose();e.call(t.Transport);t.Transport.set(i)}});return t.Transport});i(function(t){t.Volume=function(){var e=this.optionsObject(arguments,["volume"],t.Volume.defaults);this.output=this.input=new t.Gain(e.volume,t.Type.Decibels);this._unmutedVolume=0;this._muted=false;this.volume=this.output.gain;this._readOnly("volume");this.mute=e.mute};t.extend(t.Volume);t.Volume.defaults={volume:0,mute:false};Object.defineProperty(t.Volume.prototype,"mute",{get:function(){return this._muted},set:function(t){if(!this._muted&&t){this._unmutedVolume=this.volume.value;this.volume.value=-Infinity}else if(this._muted&&!t){this.volume.value=this._unmutedVolume}this._muted=t}});t.Volume.prototype.dispose=function(){this.input.dispose();t.prototype.dispose.call(this);this._writable("volume");this.volume.dispose();this.volume=null;return this};return t.Volume});i(function(t){t.Master=function(){this.createInsOuts(1,1);this._volume=this.output=new t.Volume;this.volume=this._volume.volume;this._readOnly("volume");this.input.chain(this.output,this.context.destination)};t.extend(t.Master);t.Master.defaults={volume:0,mute:false};Object.defineProperty(t.Master.prototype,"mute",{get:function(){return this._volume.mute},set:function(t){this._volume.mute=t}});t.Master.prototype.chain=function(){this.input.disconnect();this.input.chain.apply(this.input,arguments);arguments[arguments.length-1].connect(this.output)};t.Master.prototype.dispose=function(){t.prototype.dispose.call(this);this._writable("volume");this._volume.dispose();this._volume=null;this.volume=null};t.prototype.toMaster=function(){this.connect(t.Master);return this};AudioNode.prototype.toMaster=function(){this.connect(t.Master);return this};var e=t.Master;t._initAudioContext(function(){if(!t.prototype.isUndef(t.Master)){t.Master=new e}else{e.prototype.dispose.call(t.Master);e.call(t.Master)}});return t.Master});i(function(t){t.Source=function(e){e=this.defaultArg(e,t.Source.defaults);this._volume=this.output=new t.Volume(e.volume);this.volume=this._volume.volume;this._readOnly("volume");this._state=new t.TimelineState(t.State.Stopped);this._state.memory=10;this._synced=false;this._scheduled=[];this._volume.output.output.channelCount=2;this._volume.output.output.channelCountMode="explicit";this.mute=e.mute};t.extend(t.Source);t.Source.defaults={volume:0,mute:false};Object.defineProperty(t.Source.prototype,"state",{get:function(){if(this._synced){if(t.Transport.state===t.State.Started){return this._state.getStateAtTime(t.Transport.seconds)}else{return t.State.Stopped}}else{return this._state.getStateAtTime(this.now())}}});Object.defineProperty(t.Source.prototype,"mute",{get:function(){return this._volume.mute},set:function(t){this._volume.mute=t}});t.Source.prototype._start=t.noOp;t.Source.prototype._stop=t.noOp;t.Source.prototype.start=function(e,i,s){if(this.isUndef(e)&&this._synced){e=t.Transport.seconds}else{e=this.toSeconds(e)}if(this._state.getStateAtTime(e)===t.State.Started){this.stop(e)}this._state.setStateAtTime(t.State.Started,e);if(this._synced){var n=this._state.getEvent(e);n.offset=this.defaultArg(i,0);n.duration=s;var o=t.Transport.schedule(function(t){this._start(t,i,s)}.bind(this),e);this._scheduled.push(o)}else{this._start.apply(this,arguments)}return this};t.Source.prototype.stop=function(e){if(this.isUndef(e)&&this._synced){e=t.Transport.seconds}else{e=this.toSeconds(e)}this._state.cancel(e);this._state.setStateAtTime(t.State.Stopped,e);if(!this._synced){this._stop.apply(this,arguments)}else{var i=t.Transport.schedule(this._stop.bind(this),e);this._scheduled.push(i)}return this};t.Source.prototype.sync=function(){this._synced=true;t.Transport.on("start",function(e,i){if(i>0){var s=this._state.getEvent(i);if(s&&s.state===t.State.Started&&s.time!==i){var n=i-this.toSeconds(s.time);var o;if(s.duration){o=this.toSeconds(s.duration)-n}this._start(e,this.toSeconds(s.offset)+n,o)}}}.bind(this));t.Transport.on("stop pause",function(e){if(this._state.getStateAtTime(t.Transport.seconds)===t.State.Started){this._stop(e)}}.bind(this));return this};t.Source.prototype.unsync=function(){this._synced=false;t.Transport.off("start stop pause");for(var e=0;e<this._scheduled.length;e++){var i=this._scheduled[e];t.Transport.clear(i)}this._scheduled=[];this._state.cancel(0);return this};t.Source.prototype.dispose=function(){t.prototype.dispose.call(this);this.unsync();this._scheduled=null;this._writable("volume");this._volume.dispose();this._volume=null;this.volume=null;this._state.dispose();this._state=null};return t.Source});i(function(t){t.Oscillator=function(){var e=this.optionsObject(arguments,["frequency","type"],t.Oscillator.defaults);t.Source.call(this,e);this._oscillator=null;this.frequency=new t.Signal(e.frequency,t.Type.Frequency);this.detune=new t.Signal(e.detune,t.Type.Cents);this._wave=null;this._partials=this.defaultArg(e.partials,[1]);this._phase=e.phase;this._type=null;this.type=e.type;this.phase=this._phase;this._readOnly(["frequency","detune"])};t.extend(t.Oscillator,t.Source);t.Oscillator.defaults={type:"sine",frequency:440,detune:0,phase:0,partials:[]};t.Oscillator.Type={Sine:"sine",Triangle:"triangle",Sawtooth:"sawtooth",Square:"square",Custom:"custom"};t.Oscillator.prototype._start=function(t){this._oscillator=this.context.createOscillator();this._oscillator.setPeriodicWave(this._wave);this._oscillator.connect(this.output);this.frequency.connect(this._oscillator.frequency);this.detune.connect(this._oscillator.detune);this._oscillator.start(this.toSeconds(t))};t.Oscillator.prototype._stop=function(t){if(this._oscillator){this._oscillator.stop(this.toSeconds(t));this._oscillator=null}return this};t.Oscillator.prototype.syncFrequency=function(){t.Transport.syncSignal(this.frequency);return this};t.Oscillator.prototype.unsyncFrequency=function(){t.Transport.unsyncSignal(this.frequency);return this};Object.defineProperty(t.Oscillator.prototype,"type",{get:function(){return this._type},set:function(t){var e=this._getRealImaginary(t,this._phase);var i=this.context.createPeriodicWave(e[0],e[1]);this._wave=i;if(this._oscillator!==null){this._oscillator.setPeriodicWave(this._wave)}this._type=t}});t.Oscillator.prototype._getRealImaginary=function(e,i){var s=4096;var n=s/2;var o=new Float32Array(n);var r=new Float32Array(n);var a=1;if(e===t.Oscillator.Type.Custom){a=this._partials.length+1;n=a}else{var l=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(e);if(l){a=parseInt(l[2])+1;e=l[1];a=Math.max(a,2);n=a}}for(var h=1;h<n;++h){var u=2/(h*Math.PI);var p;switch(e){case t.Oscillator.Type.Sine:p=h<=a?1:0;break;case t.Oscillator.Type.Square:p=h&1?2*u:0;break;case t.Oscillator.Type.Sawtooth:p=u*(h&1?1:-1);break;case t.Oscillator.Type.Triangle:if(h&1){p=2*(u*u)*(h-1>>1&1?-1:1)}else{p=0}break;case t.Oscillator.Type.Custom:p=this._partials[h-1];break;default:throw new TypeError("Tone.Oscillator: invalid type: "+e)}if(p!==0){o[h]=-p*Math.sin(i*h);r[h]=p*Math.cos(i*h)}else{o[h]=0;r[h]=0}}return[o,r]};t.Oscillator.prototype._inverseFFT=function(t,e,i){var s=0;var n=t.length;for(var o=0;o<n;o++){s+=t[o]*Math.cos(o*i)+e[o]*Math.sin(o*i)}return s};t.Oscillator.prototype._getInitialValue=function(){var t=this._getRealImaginary(this._type,0);var e=t[0];var i=t[1];var s=0;var n=Math.PI*2;for(var o=0;o<8;o++){s=Math.max(this._inverseFFT(e,i,o/8*n),s)}return-this._inverseFFT(e,i,this._phase)/s};Object.defineProperty(t.Oscillator.prototype,"partials",{get:function(){if(this._type!==t.Oscillator.Type.Custom){return[]}else{return this._partials}},set:function(e){this._partials=e;this.type=t.Oscillator.Type.Custom}});Object.defineProperty(t.Oscillator.prototype,"phase",{get:function(){return this._phase*(180/Math.PI)},set:function(t){this._phase=t*Math.PI/180;this.type=this._type}});t.Oscillator.prototype.dispose=function(){t.Source.prototype.dispose.call(this);if(this._oscillator!==null){this._oscillator.disconnect();this._oscillator=null}this._wave=null;this._writable(["frequency","detune"]);this.frequency.dispose();this.frequency=null;this.detune.dispose();this.detune=null;this._partials=null;return this};return t.Oscillator});i(function(t){t.Zero=function(){this._gain=this.input=this.output=new t.Gain;t.Zero._zeros.connect(this._gain)};t.extend(t.Zero);t.Zero.prototype.dispose=function(){t.prototype.dispose.call(this);this._gain.dispose();this._gain=null;return this};t.Zero._zeros=null;t._initAudioContext(function(e){var i=e.createBuffer(1,128,e.sampleRate);var s=i.getChannelData(0);for(var n=0;n<s.length;n++){s[n]=0}t.Zero._zeros=e.createBufferSource();t.Zero._zeros.channelCount=1;t.Zero._zeros.channelCountMode="explicit";t.Zero._zeros.buffer=i;t.Zero._zeros.loop=true;t.Zero._zeros.start(0);t.Zero._zeros.noGC()});return t.Zero});i(function(t){t.LFO=function(){var e=this.optionsObject(arguments,["frequency","min","max"],t.LFO.defaults);this._oscillator=new t.Oscillator({frequency:e.frequency,type:e.type});this.frequency=this._oscillator.frequency;this.amplitude=this._oscillator.volume;this.amplitude.units=t.Type.NormalRange;this.amplitude.value=e.amplitude;this._stoppedSignal=new t.Signal(0,t.Type.AudioRange);this._zeros=new t.Zero;this._stoppedValue=0;this._a2g=new t.AudioToGain;
this._scaler=this.output=new t.Scale(e.min,e.max);this._units=t.Type.Default;this.units=e.units;this._oscillator.chain(this._a2g,this._scaler);this._zeros.connect(this._a2g);this._stoppedSignal.connect(this._a2g);this._readOnly(["amplitude","frequency"]);this.phase=e.phase};t.extend(t.LFO,t.Oscillator);t.LFO.defaults={type:"sine",min:0,max:1,phase:0,frequency:"4n",amplitude:1,units:t.Type.Default};t.LFO.prototype.start=function(t){t=this.toSeconds(t);this._stoppedSignal.setValueAtTime(0,t);this._oscillator.start(t);return this};t.LFO.prototype.stop=function(t){t=this.toSeconds(t);this._stoppedSignal.setValueAtTime(this._stoppedValue,t);this._oscillator.stop(t);return this};t.LFO.prototype.sync=function(){this._oscillator.sync();this._oscillator.syncFrequency();return this};t.LFO.prototype.unsync=function(){this._oscillator.unsync();this._oscillator.unsyncFrequency();return this};Object.defineProperty(t.LFO.prototype,"min",{get:function(){return this._toUnits(this._scaler.min)},set:function(t){t=this._fromUnits(t);this._scaler.min=t}});Object.defineProperty(t.LFO.prototype,"max",{get:function(){return this._toUnits(this._scaler.max)},set:function(t){t=this._fromUnits(t);this._scaler.max=t}});Object.defineProperty(t.LFO.prototype,"type",{get:function(){return this._oscillator.type},set:function(t){this._oscillator.type=t;this._stoppedValue=this._oscillator._getInitialValue();this._stoppedSignal.value=this._stoppedValue}});Object.defineProperty(t.LFO.prototype,"phase",{get:function(){return this._oscillator.phase},set:function(t){this._oscillator.phase=t;this._stoppedValue=this._oscillator._getInitialValue();this._stoppedSignal.value=this._stoppedValue}});Object.defineProperty(t.LFO.prototype,"units",{get:function(){return this._units},set:function(t){var e=this.min;var i=this.max;this._units=t;this.min=e;this.max=i}});Object.defineProperty(t.LFO.prototype,"mute",{get:function(){return this._oscillator.mute},set:function(t){this._oscillator.mute=t}});Object.defineProperty(t.LFO.prototype,"state",{get:function(){return this._oscillator.state}});t.LFO.prototype.connect=function(e){if(e.constructor===t.Signal||e.constructor===t.Param||e.constructor===t.TimelineSignal){this.convert=e.convert;this.units=e.units}t.Signal.prototype.connect.apply(this,arguments);return this};t.LFO.prototype._fromUnits=t.Param.prototype._fromUnits;t.LFO.prototype._toUnits=t.Param.prototype._toUnits;t.LFO.prototype.dispose=function(){t.prototype.dispose.call(this);this._writable(["amplitude","frequency"]);this._oscillator.dispose();this._oscillator=null;this._stoppedSignal.dispose();this._stoppedSignal=null;this._zeros.dispose();this._zeros=null;this._scaler.dispose();this._scaler=null;this._a2g.dispose();this._a2g=null;this.frequency=null;this.amplitude=null;return this};return t.LFO});i(function(t){t.Limiter=function(){var e=this.optionsObject(arguments,["threshold"],t.Limiter.defaults);this._compressor=this.input=this.output=new t.Compressor({attack:.001,decay:.001,threshold:e.threshold});this.threshold=this._compressor.threshold;this._readOnly("threshold")};t.extend(t.Limiter);t.Limiter.defaults={threshold:-12};t.Limiter.prototype.dispose=function(){t.prototype.dispose.call(this);this._compressor.dispose();this._compressor=null;this._writable("threshold");this.threshold=null;return this};return t.Limiter});i(function(t){t.LowpassCombFilter=function(){this.createInsOuts(1,1);var e=this.optionsObject(arguments,["delayTime","resonance","dampening"],t.LowpassCombFilter.defaults);this._delay=this.input=new t.Delay(e.delayTime);this.delayTime=this._delay.delayTime;this._lowpass=this.output=this.context.createBiquadFilter();this._lowpass.Q.value=-3.0102999566398125;this._lowpass.type="lowpass";this.dampening=new t.Param({param:this._lowpass.frequency,units:t.Type.Frequency,value:e.dampening});this._feedback=new t.Gain(e.resonance,t.Type.NormalRange);this.resonance=this._feedback.gain;this._delay.chain(this._lowpass,this._feedback,this._delay);this._readOnly(["dampening","resonance","delayTime"])};t.extend(t.LowpassCombFilter);t.LowpassCombFilter.defaults={delayTime:.1,resonance:.5,dampening:3e3};t.LowpassCombFilter.prototype.dispose=function(){t.prototype.dispose.call(this);this._writable(["dampening","resonance","delayTime"]);this.dampening.dispose();this.dampening=null;this.resonance.dispose();this.resonance=null;this._delay.dispose();this._delay=null;this.delayTime=null;this._lowpass.disconnect();this._lowpass=null;this._feedback.disconnect();this._feedback=null;return this};return t.LowpassCombFilter});i(function(t){t.Merge=function(){this.createInsOuts(2,0);this.left=this.input[0]=new t.Gain;this.right=this.input[1]=new t.Gain;this._merger=this.output=this.context.createChannelMerger(2);this.left.connect(this._merger,0,0);this.right.connect(this._merger,0,1);this.left.channelCount=1;this.right.channelCount=1;this.left.channelCountMode="explicit";this.right.channelCountMode="explicit"};t.extend(t.Merge);t.Merge.prototype.dispose=function(){t.prototype.dispose.call(this);this.left.dispose();this.left=null;this.right.dispose();this.right=null;this._merger.disconnect();this._merger=null;return this};return t.Merge});i(function(t){t.Meter=function(){var e=this.optionsObject(arguments,["type","smoothing"],t.Meter.defaults);this.type=e.type;this.input=this.output=this._analyser=new t.Analyser("waveform",512);this._analyser.returnType="float";this.smoothing=e.smoothing;this._lastValue=0};t.extend(t.Meter);t.Meter.Type={Level:"level",Signal:"signal"};t.Meter.defaults={smoothing:.8,type:t.Meter.Type.Level};Object.defineProperty(t.Meter.prototype,"value",{get:function(){var e=this._analyser.analyse();if(this.type===t.Meter.Type.Level){var i=0;for(var s=0;s<e.length;s++){i+=Math.pow(e[s],2)}var n=Math.sqrt(i/e.length);n=Math.max(n,this._lastValue*this.smoothing);this._lastValue=n;var o=.35;var r=n/o;return Math.sqrt(r)}else{return e[0]}}});t.Meter.prototype.dispose=function(){t.prototype.dispose.call(this);this._analyser.dispose();this._analyser=null;return this};return t.Meter});i(function(t){t.Split=function(){this.createInsOuts(0,2);this._splitter=this.input=this.context.createChannelSplitter(2);this.left=this.output[0]=new t.Gain;this.right=this.output[1]=new t.Gain;this._splitter.connect(this.left,0,0);this._splitter.connect(this.right,1,0)};t.extend(t.Split);t.Split.prototype.dispose=function(){t.prototype.dispose.call(this);this._splitter.disconnect();this.left.dispose();this.left=null;this.right.dispose();this.right=null;this._splitter=null;return this};return t.Split});i(function(t){t.MidSideSplit=function(){this.createInsOuts(0,2);this._split=this.input=new t.Split;this.mid=this.output[0]=new t.Expr("($0 + $1) * $2");this.side=this.output[1]=new t.Expr("($0 - $1) * $2");this._split.connect(this.mid,0,0);this._split.connect(this.mid,1,1);this._split.connect(this.side,0,0);this._split.connect(this.side,1,1);e.connect(this.mid,0,2);e.connect(this.side,0,2)};t.extend(t.MidSideSplit);var e=null;t._initAudioContext(function(){e=new t.Signal(1/Math.sqrt(2))});t.MidSideSplit.prototype.dispose=function(){t.prototype.dispose.call(this);this.mid.dispose();this.mid=null;this.side.dispose();this.side=null;this._split.dispose();this._split=null;return this};return t.MidSideSplit});i(function(t){t.MidSideMerge=function(){this.createInsOuts(2,0);this.mid=this.input[0]=new t.Gain;this._left=new t.Expr("($0 + $1) * $2");this.side=this.input[1]=new t.Gain;this._right=new t.Expr("($0 - $1) * $2");this._merge=this.output=new t.Merge;this.mid.connect(this._left,0,0);this.side.connect(this._left,0,1);this.mid.connect(this._right,0,0);this.side.connect(this._right,0,1);this._left.connect(this._merge,0,0);this._right.connect(this._merge,0,1);e.connect(this._left,0,2);e.connect(this._right,0,2)};t.extend(t.MidSideMerge);var e=null;t._initAudioContext(function(){e=new t.Signal(1/Math.sqrt(2))});t.MidSideMerge.prototype.dispose=function(){t.prototype.dispose.call(this);this.mid.dispose();this.mid=null;this.side.dispose();this.side=null;this._left.dispose();this._left=null;this._right.dispose();this._right=null;this._merge.dispose();this._merge=null;return this};return t.MidSideMerge});i(function(t){t.MidSideCompressor=function(e){e=this.defaultArg(e,t.MidSideCompressor.defaults);this._midSideSplit=this.input=new t.MidSideSplit;this._midSideMerge=this.output=new t.MidSideMerge;this.mid=new t.Compressor(e.mid);this.side=new t.Compressor(e.side);this._midSideSplit.mid.chain(this.mid,this._midSideMerge.mid);this._midSideSplit.side.chain(this.side,this._midSideMerge.side);this._readOnly(["mid","side"])};t.extend(t.MidSideCompressor);t.MidSideCompressor.defaults={mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},side:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10}};t.MidSideCompressor.prototype.dispose=function(){t.prototype.dispose.call(this);this._writable(["mid","side"]);this.mid.dispose();this.mid=null;this.side.dispose();this.side=null;this._midSideSplit.dispose();this._midSideSplit=null;this._midSideMerge.dispose();this._midSideMerge=null;return this};return t.MidSideCompressor});i(function(t){t.Mono=function(){this.createInsOuts(1,0);this._merge=this.output=new t.Merge;this.input.connect(this._merge,0,0);this.input.connect(this._merge,0,1);this.input.gain.value=this.dbToGain(-10)};t.extend(t.Mono);t.Mono.prototype.dispose=function(){t.prototype.dispose.call(this);this._merge.dispose();this._merge=null;return this};return t.Mono});i(function(t){t.MultibandCompressor=function(e){e=this.defaultArg(arguments,t.MultibandCompressor.defaults);this._splitter=this.input=new t.MultibandSplit({lowFrequency:e.lowFrequency,highFrequency:e.highFrequency});this.lowFrequency=this._splitter.lowFrequency;this.highFrequency=this._splitter.highFrequency;this.output=new t.Gain;this.low=new t.Compressor(e.low);this.mid=new t.Compressor(e.mid);this.high=new t.Compressor(e.high);this._splitter.low.chain(this.low,this.output);this._splitter.mid.chain(this.mid,this.output);this._splitter.high.chain(this.high,this.output);this._readOnly(["high","mid","low","highFrequency","lowFrequency"])};t.extend(t.MultibandCompressor);t.MultibandCompressor.defaults={low:t.Compressor.defaults,mid:t.Compressor.defaults,high:t.Compressor.defaults,lowFrequency:250,highFrequency:2e3};t.MultibandCompressor.prototype.dispose=function(){t.prototype.dispose.call(this);this._splitter.dispose();this._writable(["high","mid","low","highFrequency","lowFrequency"]);this.low.dispose();this.mid.dispose();this.high.dispose();this._splitter=null;this.low=null;this.mid=null;this.high=null;this.lowFrequency=null;this.highFrequency=null;return this};return t.MultibandCompressor});i(function(t){t.Panner=function(e){if(this._hasStereoPanner){this._panner=this.input=this.output=this.context.createStereoPanner();this.pan=this._panner.pan}else{this._crossFade=new t.CrossFade;this._merger=this.output=new t.Merge;this._splitter=this.input=new t.Split;this.pan=new t.Signal(0,t.Type.AudioRange);this._zero=new t.Zero;this._a2g=new t.AudioToGain;this._zero.connect(this._a2g);this.pan.chain(this._a2g,this._crossFade.fade);this._splitter.connect(this._crossFade,0,0);this._splitter.connect(this._crossFade,1,1);this._crossFade.a.connect(this._merger,0,0);this._crossFade.b.connect(this._merger,0,1)}this.pan.value=this.defaultArg(e,0);this._readOnly("pan")};t.extend(t.Panner);t.Panner.prototype._hasStereoPanner=t.prototype.isFunction(t.context.createStereoPanner);t.Panner.prototype.dispose=function(){t.prototype.dispose.call(this);this._writable("pan");if(this._hasStereoPanner){this._panner.disconnect();this._panner=null;this.pan=null}else{this._zero.dispose();this._zero=null;this._crossFade.dispose();this._crossFade=null;this._splitter.dispose();this._splitter=null;this._merger.dispose();this._merger=null;this.pan.dispose();this.pan=null;this._a2g.dispose();this._a2g=null}return this};return t.Panner});i(function(t){t.Panner3D=function(){var e=this.optionsObject(arguments,["positionX","positionY","positionZ"],t.Panner3D.defaults);this._panner=this.input=this.output=this.context.createPanner();this._panner.panningModel=e.panningModel;this._panner.maxDistance=e.maxDistance;this._panner.distanceModel=e.distanceModel;this._panner.coneOuterGain=e.coneOuterGain;this._panner.coneOuterAngle=e.coneOuterAngle;this._panner.coneInnerAngle=e.coneInnerAngle;this._panner.refDistance=e.refDistance;this._panner.rolloffFactor=e.rolloffFactor;this._orientation=[e.orientationX,e.orientationY,e.orientationZ];this._position=[e.positionX,e.positionY,e.positionZ];this.orientationX=e.orientationX;this.orientationY=e.orientationY;this.orientationZ=e.orientationZ;this.positionX=e.positionX;this.positionY=e.positionY;this.positionZ=e.positionZ};t.extend(t.Panner3D);t.Panner3D.defaults={positionX:0,positionY:0,positionZ:0,orientationX:0,orientationY:0,orientationZ:0,panningModel:"equalpower",maxDistance:1e4,distanceModel:"inverse",coneOuterGain:0,coneOuterAngle:360,coneInnerAngle:360,refDistance:1,rolloffFactor:1};t.Panner3D.prototype._rampTimeConstant=.3;t.Panner3D.prototype.setPosition=function(t,e,i){if(this._panner.positionX){var s=this.now();this._panner.positionX.setTargetAtTime(t,s,this._rampTimeConstant);this._panner.positionY.setTargetAtTime(e,s,this._rampTimeConstant);this._panner.positionZ.setTargetAtTime(i,s,this._rampTimeConstant)}else{this._panner.setPosition(t,e,i)}this._position=Array.prototype.slice.call(arguments);return this};t.Panner3D.prototype.setOrientation=function(t,e,i){if(this._panner.orientationX){var s=this.now();this._panner.orientationX.setTargetAtTime(t,s,this._rampTimeConstant);this._panner.orientationY.setTargetAtTime(e,s,this._rampTimeConstant);this._panner.orientationZ.setTargetAtTime(i,s,this._rampTimeConstant)}else{this._panner.setOrientation(t,e,i)}this._orientation=Array.prototype.slice.call(arguments);return this};Object.defineProperty(t.Panner3D.prototype,"positionX",{set:function(t){this._position[0]=t;this.setPosition.apply(this,this._position)},get:function(){return this._position[0]}});Object.defineProperty(t.Panner3D.prototype,"positionY",{set:function(t){this._position[1]=t;this.setPosition.apply(this,this._position)},get:function(){return this._position[1]}});Object.defineProperty(t.Panner3D.prototype,"positionZ",{set:function(t){this._position[2]=t;this.setPosition.apply(this,this._position)},get:function(){return this._position[2]}});Object.defineProperty(t.Panner3D.prototype,"orientationX",{set:function(t){this._orientation[0]=t;this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[0]}});Object.defineProperty(t.Panner3D.prototype,"orientationY",{set:function(t){this._orientation[1]=t;this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[1]}});Object.defineProperty(t.Panner3D.prototype,"orientationZ",{set:function(t){this._orientation[2]=t;this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[2]}});t.Panner3D._aliasProperty=function(e){Object.defineProperty(t.Panner3D.prototype,e,{set:function(t){this._panner[e]=t},get:function(){return this._panner[e]}})};t.Panner3D._aliasProperty("panningModel");t.Panner3D._aliasProperty("refDistance");t.Panner3D._aliasProperty("rolloffFactor");t.Panner3D._aliasProperty("distanceModel");t.Panner3D._aliasProperty("coneInnerAngle");t.Panner3D._aliasProperty("coneOuterAngle");t.Panner3D._aliasProperty("coneOuterGain");t.Panner3D._aliasProperty("maxDistance");t.Panner3D.prototype.dispose=function(){this._panner.disconnect();this._panner=null;this._orientation=null;this._position=null;return this};return t.Panner3D});i(function(t){t.PanVol=function(){var e=this.optionsObject(arguments,["pan","volume"],t.PanVol.defaults);this._panner=this.input=new t.Panner(e.pan);this.pan=this._panner.pan;this._volume=this.output=new t.Volume(e.volume);this.volume=this._volume.volume;this._panner.connect(this._volume);this._readOnly(["pan","volume"])};t.extend(t.PanVol);t.PanVol.defaults={pan:.5,volume:0};t.PanVol.prototype.dispose=function(){t.prototype.dispose.call(this);this._writable(["pan","volume"]);this._panner.dispose();this._panner=null;this.pan=null;this._volume.dispose();this._volume=null;this.volume=null;return this};return t.PanVol});i(function(t){t.CtrlInterpolate=function(){var e=this.optionsObject(arguments,["values","index"],t.CtrlInterpolate.defaults);this.values=e.values;this.index=e.index};t.extend(t.CtrlInterpolate);t.CtrlInterpolate.defaults={index:0,values:[]};Object.defineProperty(t.CtrlInterpolate.prototype,"value",{get:function(){var t=this.index;t=Math.min(t,this.values.length-1);var e=Math.floor(t);var i=this.values[e];var s=this.values[Math.ceil(t)];return this._interpolate(t-e,i,s)}});t.CtrlInterpolate.prototype._interpolate=function(t,e,i){if(this.isArray(e)){var s=[];for(var n=0;n<e.length;n++){s[n]=this._interpolate(t,e[n],i[n])}return s}else if(this.isObject(e)){var o={};for(var r in e){o[r]=this._interpolate(t,e[r],i[r])}return o}else{e=this._toNumber(e);i=this._toNumber(i);return(1-t)*e+t*i}};t.CtrlInterpolate.prototype._toNumber=function(t){if(this.isNumber(t)){return t}else{return this.toSeconds(t)}};t.CtrlInterpolate.prototype.dispose=function(){this.values=null};return t.CtrlInterpolate});i(function(t){t.CtrlMarkov=function(t,e){this.values=this.defaultArg(t,{});this.value=this.defaultArg(e,Object.keys(this.values)[0])};t.extend(t.CtrlMarkov);t.CtrlMarkov.prototype.next=function(){if(this.values.hasOwnProperty(this.value)){var t=this.values[this.value];if(this.isArray(t)){var e=this._getProbDistribution(t);var i=Math.random();var s=0;for(var n=0;n<e.length;n++){var o=e[n];if(i>s&&i<s+o){var r=t[n];if(this.isObject(r)){this.value=r.value}else{this.value=r}}s+=o}}else{this.value=t}}return this.value};t.CtrlMarkov.prototype._getProbDistribution=function(t){var e=[];var i=0;var s=false;for(var n=0;n<t.length;n++){var o=t[n];if(this.isObject(o)){s=true;e[n]=o.probability}else{e[n]=1/t.length}i+=e[n]}if(s){for(var r=0;r<e.length;r++){e[r]=e[r]/i}}return e};t.CtrlMarkov.prototype.dispose=function(){this.values=null};return t.CtrlMarkov});i(function(t){t.CtrlPattern=function(){var e=this.optionsObject(arguments,["values","type"],t.CtrlPattern.defaults);this.values=e.values;this.index=0;this._type=null;this._shuffled=null;this._direction=null;this.type=e.type};t.extend(t.CtrlPattern);t.CtrlPattern.Type={Up:"up",Down:"down",UpDown:"upDown",DownUp:"downUp",AlternateUp:"alternateUp",AlternateDown:"alternateDown",Random:"random",RandomWalk:"randomWalk",RandomOnce:"randomOnce"};t.CtrlPattern.defaults={type:t.CtrlPattern.Type.Up,values:[]};Object.defineProperty(t.CtrlPattern.prototype,"value",{get:function(){if(this.values.length===0){return}else if(this.values.length===1){return this.values[0]}this.index=Math.min(this.index,this.values.length-1);var e=this.values[this.index];if(this.type===t.CtrlPattern.Type.RandomOnce){if(this.values.length!==this._shuffled.length){this._shuffleValues()}e=this.values[this._shuffled[this.index]]}return e}});Object.defineProperty(t.CtrlPattern.prototype,"type",{get:function(){return this._type},set:function(e){this._type=e;this._shuffled=null;if(this._type===t.CtrlPattern.Type.Up||this._type===t.CtrlPattern.Type.UpDown||this._type===t.CtrlPattern.Type.RandomOnce||this._type===t.CtrlPattern.Type.AlternateUp){this.index=0}else if(this._type===t.CtrlPattern.Type.Down||this._type===t.CtrlPattern.Type.DownUp||this._type===t.CtrlPattern.Type.AlternateDown){this.index=this.values.length-1}if(this._type===t.CtrlPattern.Type.UpDown||this._type===t.CtrlPattern.Type.AlternateUp){this._direction=t.CtrlPattern.Type.Up}else if(this._type===t.CtrlPattern.Type.DownUp||this._type===t.CtrlPattern.Type.AlternateDown){this._direction=t.CtrlPattern.Type.Down}if(this._type===t.CtrlPattern.Type.RandomOnce){this._shuffleValues()}else if(this._type===t.CtrlPattern.Random){this.index=Math.floor(Math.random()*this.values.length)}}});t.CtrlPattern.prototype.next=function(){var e=this.type;if(e===t.CtrlPattern.Type.Up){this.index++;if(this.index>=this.values.length){this.index=0}}else if(e===t.CtrlPattern.Type.Down){this.index--;if(this.index<0){this.index=this.values.length-1}}else if(e===t.CtrlPattern.Type.UpDown||e===t.CtrlPattern.Type.DownUp){if(this._direction===t.CtrlPattern.Type.Up){this.index++}else{this.index--}if(this.index<0){this.index=1;this._direction=t.CtrlPattern.Type.Up}else if(this.index>=this.values.length){this.index=this.values.length-2;this._direction=t.CtrlPattern.Type.Down}}else if(e===t.CtrlPattern.Type.Random){this.index=Math.floor(Math.random()*this.values.length)}else if(e===t.CtrlPattern.Type.RandomWalk){if(Math.random()<.5){this.index--;this.index=Math.max(this.index,0)}else{this.index++;this.index=Math.min(this.index,this.values.length-1)}}else if(e===t.CtrlPattern.Type.RandomOnce){this.index++;if(this.index>=this.values.length){this.index=0;this._shuffleValues()}}else if(e===t.CtrlPattern.Type.AlternateUp){if(this._direction===t.CtrlPattern.Type.Up){this.index+=2;this._direction=t.CtrlPattern.Type.Down}else{this.index-=1;this._direction=t.CtrlPattern.Type.Up}if(this.index>=this.values.length){this.index=0;this._direction=t.CtrlPattern.Type.Up}}else if(e===t.CtrlPattern.Type.AlternateDown){if(this._direction===t.CtrlPattern.Type.Up){this.index+=1;this._direction=t.CtrlPattern.Type.Down}else{this.index-=2;this._direction=t.CtrlPattern.Type.Up}if(this.index<0){this.index=this.values.length-1;this._direction=t.CtrlPattern.Type.Down}}return this.value};t.CtrlPattern.prototype._shuffleValues=function(){var t=[];this._shuffled=[];for(var e=0;e<this.values.length;e++){t[e]=e}while(t.length>0){var i=t.splice(Math.floor(t.length*Math.random()),1);this._shuffled.push(i[0])}};t.CtrlPattern.prototype.dispose=function(){this._shuffled=null;this.values=null};return t.CtrlPattern});i(function(t){t.CtrlRandom=function(){var e=this.optionsObject(arguments,["min","max"],t.CtrlRandom.defaults);this.min=e.min;this.max=e.max;this.integer=e.integer};t.extend(t.CtrlRandom);t.CtrlRandom.defaults={min:0,max:1,integer:false};Object.defineProperty(t.CtrlRandom.prototype,"value",{get:function(){var t=this.toSeconds(this.min);var e=this.toSeconds(this.max);var i=Math.random();var s=i*t+(1-i)*e;if(this.integer){s=Math.floor(s)}return s}});return t.CtrlRandom});i(function(t){t.Buffer=function(){var e=this.optionsObject(arguments,["url","onload","onerror"],t.Buffer.defaults);this._buffer=null;this._reversed=e.reverse;this._xhr=null;if(e.url instanceof AudioBuffer||e.url instanceof t.Buffer){this.set(e.url);if(e.onload){e.onload(this)}}else if(this.isString(e.url)){this.load(e.url,e.onload,e.onerror)}};t.extend(t.Buffer);t.Buffer.defaults={url:undefined,reverse:false};t.Buffer.prototype.set=function(e){if(e instanceof t.Buffer){this._buffer=e.get()}else{this._buffer=e}return this};t.Buffer.prototype.get=function(){return this._buffer};t.Buffer.prototype.load=function(e,i,s){var n=new Promise(function(n,o){this._xhr=t.Buffer.load(e,function(t){this._xhr=null;this.set(t);n(this);if(i){i(this)}}.bind(this),function(t){this._xhr=null;o(t);if(s){s(t)}}.bind(this))}.bind(this));return n};t.Buffer.prototype.dispose=function(){t.Emitter.prototype.dispose.call(this);this._buffer=null;if(this._xhr){t.Buffer._currentDownloads--;this._xhr.abort();this._xhr=null}return this};Object.defineProperty(t.Buffer.prototype,"loaded",{get:function(){return this.length>0}});Object.defineProperty(t.Buffer.prototype,"duration",{get:function(){if(this._buffer){return this._buffer.duration}else{return 0}}});Object.defineProperty(t.Buffer.prototype,"length",{get:function(){if(this._buffer){return this._buffer.length}else{return 0}}});Object.defineProperty(t.Buffer.prototype,"numberOfChannels",{get:function(){if(this._buffer){return this._buffer.numberOfChannels}else{return 0}}});t.Buffer.prototype.fromArray=function(t){var e=t[0].length>0;var i=e?t.length:1;var s=e?t[0].length:t.length;var n=this.context.createBuffer(i,s,this.context.sampleRate);if(!e&&i===1){t=[t]}for(var o=0;o<i;o++){if(this.isFunction(n.copyToChannel)){n.copyToChannel(t[o],o)}else{var r=n.getChannelData(o);var a=t[o];for(var l=0;l<a.length;l++){r[l]=a[l]}}}this._buffer=n;return this};t.Buffer.prototype.toArray=function(t){if(this.isNumber(t)){return this._buffer.getChannelData(t)}else{var e=[];for(var i=0;i<this.numberOfChannels;i++){e[i]=new Float32Array(this.length);if(this.isFunction(this._buffer.copyFromChannel)){this._buffer.copyFromChannel(e[i],i)}else{var s=this._buffer.getChannelData(i);var n=e[i];for(var o=0;o<s.length;o++){n[o]=s[o]}}}if(e.length===1){return e[0]}else{return e}}};t.Buffer.prototype.slice=function(e,i){i=this.defaultArg(i,this.duration);var s=Math.floor(this.context.sampleRate*this.toSeconds(e));var n=Math.floor(this.context.sampleRate*this.toSeconds(i));var o=[];for(var r=0;r<this.numberOfChannels;r++){o[r]=this.toArray(r).slice(s,n)}var a=(new t.Buffer).fromArray(o);return a};t.Buffer.prototype._reverse=function(){if(this.loaded){for(var t=0;t<this._buffer.numberOfChannels;t++){Array.prototype.reverse.call(this._buffer.getChannelData(t))}}return this};Object.defineProperty(t.Buffer.prototype,"reverse",{get:function(){return this._reversed},set:function(t){if(this._reversed!==t){this._reversed=t;this._reverse()}}});t.Emitter.mixin(t.Buffer);t.Buffer._downloadQueue=[];t.Buffer._currentDownloads=0;t.Buffer.baseUrl="";t.Buffer.load=function(e,i,s){i=i||t.noOp;function n(e){t.Buffer._currentDownloads--;if(s){s(e)}else{throw new Error(e)}}function o(){var e=0;for(var i=0;i<t.Buffer._downloadQueue.length;i++){e+=t.Buffer._downloadQueue[i].progress}t.Buffer.emit("progress",e/t.Buffer._downloadQueue.length)}var r=new XMLHttpRequest;r.open("GET",t.Buffer.baseUrl+e,true);r.responseType="arraybuffer";r.progress=0;t.Buffer._currentDownloads++;t.Buffer._downloadQueue.push(r);r.addEventListener("load",function(){if(r.status===200){t.context.decodeAudioData(r.response,function(e){r.progress=1;o();i(e);t.Buffer._currentDownloads--;if(t.Buffer._currentDownloads===0){t.Buffer._downloadQueue=[];t.Buffer.emit("load")}},function(){n("Tone.Buffer: could not decode audio data: "+e)})}else{n("Tone.Buffer: could not locate file: "+e)}});r.addEventListener("error",n);r.addEventListener("progress",function(t){if(t.lengthComputable){r.progress=t.loaded/t.total*.95;o()}});r.send();return r};t.Buffer.supportsType=function(t){var e=t.split(".");e=e[e.length-1];var i=document.createElement("audio").canPlayType("audio/"+e);return i!==""};return t.Buffer});i(function(t){t.Buffers=function(t,e,i){this._buffers={};this.baseUrl=this.defaultArg(i,"");t=this._flattenUrls(t);this._loadingCount=0;for(var s in t){this._loadingCount++;this.add(s,t[s],this._bufferLoaded.bind(this,e))}};t.extend(t.Buffers);t.Buffers.prototype.has=function(t){return this._buffers.hasOwnProperty(t)};t.Buffers.prototype.get=function(t){if(this.has(t)){return this._buffers[t]}else{throw new Error("Tone.Buffers: no buffer named "+t)}};t.Buffers.prototype._bufferLoaded=function(t){this._loadingCount--;if(this._loadingCount===0&&t){t(this)}};Object.defineProperty(t.Buffers.prototype,"loaded",{get:function(){var t=true;for(var e in this._buffers){var i=this.get(e);t=t&&i.loaded}return t}});t.Buffers.prototype.add=function(e,i,s){s=this.defaultArg(s,t.noOp);if(i instanceof t.Buffer){this._buffers[e]=i;s(this)}else if(i instanceof AudioBuffer){this._buffers[e]=new t.Buffer(i);s(this)}else if(this.isString(i)){this._buffers[e]=new t.Buffer(this.baseUrl+i,s)}return this};t.Buffers.prototype._flattenUrls=function(t){var e={};for(var i in t){if(!t.hasOwnProperty(i))continue;if(this.isObject(t[i])){var s=this._flattenUrls(t[i]);for(var n in s){if(!s.hasOwnProperty(n))continue;e[i+"."+n]=s[n]}}else{e[i]=t[i]}}return e};t.Buffers.prototype.dispose=function(){for(var t in this._buffers){this._buffers[t].dispose()}this._buffers=null;return this};return t.Buffers});i(function(t){var e={};t.prototype.send=function(i,s){if(!e.hasOwnProperty(i)){e[i]=this.context.createGain()}s=this.defaultArg(s,0);var n=new t.Gain(s,t.Type.Decibels);this.output.chain(n,e[i]);return n};t.prototype.receive=function(t,i){if(!e.hasOwnProperty(t)){e[t]=this.context.createGain()}if(this.isUndef(i)){i=this.input}e[t].connect(i);return this};t._initAudioContext(function(){e={}});return t});i(function(t){t.Listener=function(){var t=this.optionsObject(arguments,["positionX","positionY","positionZ"],e.defaults);this._listener=this.context.listener;this._orientation=[t.forwardX,t.forwardY,t.forwardZ,t.upX,t.upY,t.upZ];this._position=[t.positionX,t.positionY,t.positionZ];this.forwardX=t.forwardX;this.forwardY=t.forwardY;this.forwardZ=t.forwardZ;this.upX=t.upX;this.upY=t.upY;this.upZ=t.upZ;this.positionX=t.positionX;this.positionY=t.positionY;this.positionZ=t.positionZ};t.extend(t.Listener);t.Listener.defaults={positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:1,upX:0,upY:1,upZ:0};t.Listener.prototype._rampTimeConstant=.3;t.Listener.prototype.setPosition=function(t,e,i){if(this._listener.positionX){var s=this.now();this._listener.positionX.setTargetAtTime(t,s,this._rampTimeConstant);this._listener.positionY.setTargetAtTime(e,s,this._rampTimeConstant);this._listener.positionZ.setTargetAtTime(i,s,this._rampTimeConstant)}else{this._listener.setPosition(t,e,i)}this._position=Array.prototype.slice.call(arguments);return this};t.Listener.prototype.setOrientation=function(t,e,i,s,n,o){if(this._listener.forwardX){var r=this.now();this._listener.forwardX.setTargetAtTime(t,r,this._rampTimeConstant);this._listener.forwardY.setTargetAtTime(e,r,this._rampTimeConstant);this._listener.forwardZ.setTargetAtTime(i,r,this._rampTimeConstant);this._listener.upX.setTargetAtTime(s,r,this._rampTimeConstant);this._listener.upY.setTargetAtTime(n,r,this._rampTimeConstant);this._listener.upZ.setTargetAtTime(o,r,this._rampTimeConstant)}else{this._listener.setOrientation(t,e,i,s,n,o)}this._orientation=Array.prototype.slice.call(arguments);return this};Object.defineProperty(t.Listener.prototype,"positionX",{set:function(t){this._position[0]=t;this.setPosition.apply(this,this._position)},get:function(){return this._position[0]}});Object.defineProperty(t.Listener.prototype,"positionY",{set:function(t){this._position[1]=t;this.setPosition.apply(this,this._position)},get:function(){return this._position[1]}});Object.defineProperty(t.Listener.prototype,"positionZ",{set:function(t){this._position[2]=t;this.setPosition.apply(this,this._position)},get:function(){return this._position[2]}});Object.defineProperty(t.Listener.prototype,"forwardX",{set:function(t){this._orientation[0]=t;this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[0]}});Object.defineProperty(t.Listener.prototype,"forwardY",{set:function(t){this._orientation[1]=t;this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[1]}});Object.defineProperty(t.Listener.prototype,"forwardZ",{set:function(t){this._orientation[2]=t;this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[2]}});Object.defineProperty(t.Listener.prototype,"upX",{set:function(t){this._orientation[3]=t;this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[3]}});Object.defineProperty(t.Listener.prototype,"upY",{set:function(t){this._orientation[4]=t;this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[4]}});Object.defineProperty(t.Listener.prototype,"upZ",{set:function(t){this._orientation[5]=t;this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[5]}});t.Listener.prototype.dispose=function(){this._listener.disconnect();this._listener=null;this._orientation=null;this._position=null;return this};var e=t.Listener;t._initAudioContext(function(){if(typeof t.Listener==="function"){t.Listener=new t.Listener}else{e.call(t.Listener)}});return t.Listener});
i(function(t){t.Effect=function(){this.createInsOuts(1,1);var e=this.optionsObject(arguments,["wet"],t.Effect.defaults);this._dryWet=new t.CrossFade(e.wet);this.wet=this._dryWet.fade;this.effectSend=new t.Gain;this.effectReturn=new t.Gain;this.input.connect(this._dryWet.a);this.input.connect(this.effectSend);this.effectReturn.connect(this._dryWet.b);this._dryWet.connect(this.output);this._readOnly(["wet"])};t.extend(t.Effect);t.Effect.defaults={wet:1};t.Effect.prototype.connectEffect=function(t){this.effectSend.chain(t,this.effectReturn);return this};t.Effect.prototype.dispose=function(){t.prototype.dispose.call(this);this._dryWet.dispose();this._dryWet=null;this.effectSend.dispose();this.effectSend=null;this.effectReturn.dispose();this.effectReturn=null;this._writable(["wet"]);this.wet=null;return this};return t.Effect});i(function(t){t.AutoFilter=function(){var e=this.optionsObject(arguments,["frequency","baseFrequency","octaves"],t.AutoFilter.defaults);t.Effect.call(this,e);this._lfo=new t.LFO({frequency:e.frequency,amplitude:e.depth});this.depth=this._lfo.amplitude;this.frequency=this._lfo.frequency;this.filter=new t.Filter(e.filter);this._octaves=0;this.connectEffect(this.filter);this._lfo.connect(this.filter.frequency);this.type=e.type;this._readOnly(["frequency","depth"]);this.octaves=e.octaves;this.baseFrequency=e.baseFrequency};t.extend(t.AutoFilter,t.Effect);t.AutoFilter.defaults={frequency:1,type:"sine",depth:1,baseFrequency:200,octaves:2.6,filter:{type:"lowpass",rolloff:-12,Q:1}};t.AutoFilter.prototype.start=function(t){this._lfo.start(t);return this};t.AutoFilter.prototype.stop=function(t){this._lfo.stop(t);return this};t.AutoFilter.prototype.sync=function(t){this._lfo.sync(t);return this};t.AutoFilter.prototype.unsync=function(){this._lfo.unsync();return this};Object.defineProperty(t.AutoFilter.prototype,"type",{get:function(){return this._lfo.type},set:function(t){this._lfo.type=t}});Object.defineProperty(t.AutoFilter.prototype,"baseFrequency",{get:function(){return this._lfo.min},set:function(t){this._lfo.min=this.toFrequency(t);this.octaves=this._octaves}});Object.defineProperty(t.AutoFilter.prototype,"octaves",{get:function(){return this._octaves},set:function(t){this._octaves=t;this._lfo.max=this.baseFrequency*Math.pow(2,t)}});t.AutoFilter.prototype.dispose=function(){t.Effect.prototype.dispose.call(this);this._lfo.dispose();this._lfo=null;this.filter.dispose();this.filter=null;this._writable(["frequency","depth"]);this.frequency=null;this.depth=null;return this};return t.AutoFilter});i(function(t){t.AutoPanner=function(){var e=this.optionsObject(arguments,["frequency"],t.AutoPanner.defaults);t.Effect.call(this,e);this._lfo=new t.LFO({frequency:e.frequency,amplitude:e.depth,min:-1,max:1});this.depth=this._lfo.amplitude;this._panner=new t.Panner;this.frequency=this._lfo.frequency;this.connectEffect(this._panner);this._lfo.connect(this._panner.pan);this.type=e.type;this._readOnly(["depth","frequency"])};t.extend(t.AutoPanner,t.Effect);t.AutoPanner.defaults={frequency:1,type:"sine",depth:1};t.AutoPanner.prototype.start=function(t){this._lfo.start(t);return this};t.AutoPanner.prototype.stop=function(t){this._lfo.stop(t);return this};t.AutoPanner.prototype.sync=function(t){this._lfo.sync(t);return this};t.AutoPanner.prototype.unsync=function(){this._lfo.unsync();return this};Object.defineProperty(t.AutoPanner.prototype,"type",{get:function(){return this._lfo.type},set:function(t){this._lfo.type=t}});t.AutoPanner.prototype.dispose=function(){t.Effect.prototype.dispose.call(this);this._lfo.dispose();this._lfo=null;this._panner.dispose();this._panner=null;this._writable(["depth","frequency"]);this.frequency=null;this.depth=null;return this};return t.AutoPanner});i(function(t){t.AutoWah=function(){var e=this.optionsObject(arguments,["baseFrequency","octaves","sensitivity"],t.AutoWah.defaults);t.Effect.call(this,e);this.follower=new t.Follower(e.follower);this._sweepRange=new t.ScaleExp(0,1,.5);this._baseFrequency=e.baseFrequency;this._octaves=e.octaves;this._inputBoost=new t.Gain;this._bandpass=new t.Filter({rolloff:-48,frequency:0,Q:e.Q});this._peaking=new t.Filter(0,"peaking");this._peaking.gain.value=e.gain;this.gain=this._peaking.gain;this.Q=this._bandpass.Q;this.effectSend.chain(this._inputBoost,this.follower,this._sweepRange);this._sweepRange.connect(this._bandpass.frequency);this._sweepRange.connect(this._peaking.frequency);this.effectSend.chain(this._bandpass,this._peaking,this.effectReturn);this._setSweepRange();this.sensitivity=e.sensitivity;this._readOnly(["gain","Q"])};t.extend(t.AutoWah,t.Effect);t.AutoWah.defaults={baseFrequency:100,octaves:6,sensitivity:0,Q:2,gain:2,follower:{attack:.3,release:.5}};Object.defineProperty(t.AutoWah.prototype,"octaves",{get:function(){return this._octaves},set:function(t){this._octaves=t;this._setSweepRange()}});Object.defineProperty(t.AutoWah.prototype,"baseFrequency",{get:function(){return this._baseFrequency},set:function(t){this._baseFrequency=t;this._setSweepRange()}});Object.defineProperty(t.AutoWah.prototype,"sensitivity",{get:function(){return this.gainToDb(1/this._inputBoost.gain.value)},set:function(t){this._inputBoost.gain.value=1/this.dbToGain(t)}});t.AutoWah.prototype._setSweepRange=function(){this._sweepRange.min=this._baseFrequency;this._sweepRange.max=Math.min(this._baseFrequency*Math.pow(2,this._octaves),this.context.sampleRate/2)};t.AutoWah.prototype.dispose=function(){t.Effect.prototype.dispose.call(this);this.follower.dispose();this.follower=null;this._sweepRange.dispose();this._sweepRange=null;this._bandpass.dispose();this._bandpass=null;this._peaking.dispose();this._peaking=null;this._inputBoost.dispose();this._inputBoost=null;this._writable(["gain","Q"]);this.gain=null;this.Q=null;return this};return t.AutoWah});i(function(t){t.BitCrusher=function(){var e=this.optionsObject(arguments,["bits"],t.BitCrusher.defaults);t.Effect.call(this,e);var i=1/Math.pow(2,e.bits-1);this._subtract=new t.Subtract;this._modulo=new t.Modulo(i);this._bits=e.bits;this.effectSend.fan(this._subtract,this._modulo);this._modulo.connect(this._subtract,0,1);this._subtract.connect(this.effectReturn)};t.extend(t.BitCrusher,t.Effect);t.BitCrusher.defaults={bits:4};Object.defineProperty(t.BitCrusher.prototype,"bits",{get:function(){return this._bits},set:function(t){this._bits=t;var e=1/Math.pow(2,t-1);this._modulo.value=e}});t.BitCrusher.prototype.dispose=function(){t.Effect.prototype.dispose.call(this);this._subtract.dispose();this._subtract=null;this._modulo.dispose();this._modulo=null;return this};return t.BitCrusher});i(function(t){t.Chebyshev=function(){var e=this.optionsObject(arguments,["order"],t.Chebyshev.defaults);t.Effect.call(this,e);this._shaper=new t.WaveShaper(4096);this._order=e.order;this.connectEffect(this._shaper);this.order=e.order;this.oversample=e.oversample};t.extend(t.Chebyshev,t.Effect);t.Chebyshev.defaults={order:1,oversample:"none"};t.Chebyshev.prototype._getCoefficient=function(t,e,i){if(i.hasOwnProperty(e)){return i[e]}else if(e===0){i[e]=0}else if(e===1){i[e]=t}else{i[e]=2*t*this._getCoefficient(t,e-1,i)-this._getCoefficient(t,e-2,i)}return i[e]};Object.defineProperty(t.Chebyshev.prototype,"order",{get:function(){return this._order},set:function(t){this._order=t;var e=new Array(4096);var i=e.length;for(var s=0;s<i;++s){var n=s*2/i-1;if(n===0){e[s]=0}else{e[s]=this._getCoefficient(n,t,{})}}this._shaper.curve=e}});Object.defineProperty(t.Chebyshev.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(t){this._shaper.oversample=t}});t.Chebyshev.prototype.dispose=function(){t.Effect.prototype.dispose.call(this);this._shaper.dispose();this._shaper=null;return this};return t.Chebyshev});i(function(t){t.StereoEffect=function(){this.createInsOuts(1,1);var e=this.optionsObject(arguments,["wet"],t.Effect.defaults);this._dryWet=new t.CrossFade(e.wet);this.wet=this._dryWet.fade;this._split=new t.Split;this.effectSendL=this._split.left;this.effectSendR=this._split.right;this._merge=new t.Merge;this.effectReturnL=this._merge.left;this.effectReturnR=this._merge.right;this.input.connect(this._split);this.input.connect(this._dryWet,0,0);this._merge.connect(this._dryWet,0,1);this._dryWet.connect(this.output);this._readOnly(["wet"])};t.extend(t.StereoEffect,t.Effect);t.StereoEffect.prototype.dispose=function(){t.prototype.dispose.call(this);this._dryWet.dispose();this._dryWet=null;this._split.dispose();this._split=null;this._merge.dispose();this._merge=null;this.effectSendL=null;this.effectSendR=null;this.effectReturnL=null;this.effectReturnR=null;this._writable(["wet"]);this.wet=null;return this};return t.StereoEffect});i(function(t){t.FeedbackEffect=function(){var e=this.optionsObject(arguments,["feedback"]);e=this.defaultArg(e,t.FeedbackEffect.defaults);t.Effect.call(this,e);this._feedbackGain=new t.Gain(e.feedback,t.Type.NormalRange);this.feedback=this._feedbackGain.gain;this.effectReturn.chain(this._feedbackGain,this.effectSend);this._readOnly(["feedback"])};t.extend(t.FeedbackEffect,t.Effect);t.FeedbackEffect.defaults={feedback:.125};t.FeedbackEffect.prototype.dispose=function(){t.Effect.prototype.dispose.call(this);this._writable(["feedback"]);this._feedbackGain.dispose();this._feedbackGain=null;this.feedback=null;return this};return t.FeedbackEffect});i(function(t){t.StereoXFeedbackEffect=function(){var e=this.optionsObject(arguments,["feedback"],t.FeedbackEffect.defaults);t.StereoEffect.call(this,e);this.feedback=new t.Signal(e.feedback,t.Type.NormalRange);this._feedbackLR=new t.Gain;this._feedbackRL=new t.Gain;this.effectReturnL.chain(this._feedbackLR,this.effectSendR);this.effectReturnR.chain(this._feedbackRL,this.effectSendL);this.feedback.fan(this._feedbackLR.gain,this._feedbackRL.gain);this._readOnly(["feedback"])};t.extend(t.StereoXFeedbackEffect,t.FeedbackEffect);t.StereoXFeedbackEffect.prototype.dispose=function(){t.StereoEffect.prototype.dispose.call(this);this._writable(["feedback"]);this.feedback.dispose();this.feedback=null;this._feedbackLR.dispose();this._feedbackLR=null;this._feedbackRL.dispose();this._feedbackRL=null;return this};return t.StereoXFeedbackEffect});i(function(t){t.Chorus=function(){var e=this.optionsObject(arguments,["frequency","delayTime","depth"],t.Chorus.defaults);t.StereoXFeedbackEffect.call(this,e);this._depth=e.depth;this._delayTime=e.delayTime/1e3;this._lfoL=new t.LFO({frequency:e.frequency,min:0,max:1});this._lfoR=new t.LFO({frequency:e.frequency,min:0,max:1,phase:180});this._delayNodeL=new t.Delay;this._delayNodeR=new t.Delay;this.frequency=this._lfoL.frequency;this.effectSendL.chain(this._delayNodeL,this.effectReturnL);this.effectSendR.chain(this._delayNodeR,this.effectReturnR);this.effectSendL.connect(this.effectReturnL);this.effectSendR.connect(this.effectReturnR);this._lfoL.connect(this._delayNodeL.delayTime);this._lfoR.connect(this._delayNodeR.delayTime);this._lfoL.start();this._lfoR.start();this._lfoL.frequency.connect(this._lfoR.frequency);this.depth=this._depth;this.frequency.value=e.frequency;this.type=e.type;this._readOnly(["frequency"]);this.spread=e.spread};t.extend(t.Chorus,t.StereoXFeedbackEffect);t.Chorus.defaults={frequency:1.5,delayTime:3.5,depth:.7,feedback:.1,type:"sine",spread:180};Object.defineProperty(t.Chorus.prototype,"depth",{get:function(){return this._depth},set:function(t){this._depth=t;var e=this._delayTime*t;this._lfoL.min=Math.max(this._delayTime-e,0);this._lfoL.max=this._delayTime+e;this._lfoR.min=Math.max(this._delayTime-e,0);this._lfoR.max=this._delayTime+e}});Object.defineProperty(t.Chorus.prototype,"delayTime",{get:function(){return this._delayTime*1e3},set:function(t){this._delayTime=t/1e3;this.depth=this._depth}});Object.defineProperty(t.Chorus.prototype,"type",{get:function(){return this._lfoL.type},set:function(t){this._lfoL.type=t;this._lfoR.type=t}});Object.defineProperty(t.Chorus.prototype,"spread",{get:function(){return this._lfoR.phase-this._lfoL.phase},set:function(t){this._lfoL.phase=90-t/2;this._lfoR.phase=t/2+90}});t.Chorus.prototype.dispose=function(){t.StereoXFeedbackEffect.prototype.dispose.call(this);this._lfoL.dispose();this._lfoL=null;this._lfoR.dispose();this._lfoR=null;this._delayNodeL.dispose();this._delayNodeL=null;this._delayNodeR.dispose();this._delayNodeR=null;this._writable("frequency");this.frequency=null;return this};return t.Chorus});i(function(t){t.Convolver=function(){var e=this.optionsObject(arguments,["url","onload"],t.Convolver.defaults);t.Effect.call(this,e);this._convolver=this.context.createConvolver();this._buffer=new t.Buffer;if(this.isString(e.url)){this._buffer.load(e.url,function(t){this.buffer=t;e.onload()}.bind(this))}else if(e.url){this.buffer=e.url;e.onload()}this.connectEffect(this._convolver)};t.extend(t.Convolver,t.Effect);t.Convolver.defaults={onload:t.noOp};Object.defineProperty(t.Convolver.prototype,"buffer",{get:function(){return this._buffer.get()},set:function(t){this._buffer.set(t);this._convolver.buffer=this._buffer.get()}});t.Convolver.prototype.load=function(t,e){this._buffer.load(t,function(t){this.buffer=t;if(e){e()}}.bind(this));return this};t.Convolver.prototype.dispose=function(){t.Effect.prototype.dispose.call(this);this._convolver.disconnect();this._convolver=null;this._buffer.dispose();this._buffer=null;return this};return t.Convolver});i(function(t){t.Distortion=function(){var e=this.optionsObject(arguments,["distortion"],t.Distortion.defaults);t.Effect.call(this,e);this._shaper=new t.WaveShaper(4096);this._distortion=e.distortion;this.connectEffect(this._shaper);this.distortion=e.distortion;this.oversample=e.oversample};t.extend(t.Distortion,t.Effect);t.Distortion.defaults={distortion:.4,oversample:"none"};Object.defineProperty(t.Distortion.prototype,"distortion",{get:function(){return this._distortion},set:function(t){this._distortion=t;var e=t*100;var i=Math.PI/180;this._shaper.setMap(function(t){if(Math.abs(t)<.001){return 0}else{return(3+e)*t*20*i/(Math.PI+e*Math.abs(t))}})}});Object.defineProperty(t.Distortion.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(t){this._shaper.oversample=t}});t.Distortion.prototype.dispose=function(){t.Effect.prototype.dispose.call(this);this._shaper.dispose();this._shaper=null;return this};return t.Distortion});i(function(t){t.FeedbackDelay=function(){var e=this.optionsObject(arguments,["delayTime","feedback"],t.FeedbackDelay.defaults);t.FeedbackEffect.call(this,e);this._delayNode=new t.Delay(e.delayTime);this.delayTime=this._delayNode.delayTime;this.connectEffect(this._delayNode);this._readOnly(["delayTime"])};t.extend(t.FeedbackDelay,t.FeedbackEffect);t.FeedbackDelay.defaults={delayTime:.25};t.FeedbackDelay.prototype.dispose=function(){t.FeedbackEffect.prototype.dispose.call(this);this._delayNode.dispose();this._delayNode=null;this._writable(["delayTime"]);this.delayTime=null;return this};return t.FeedbackDelay});i(function(t){var e=[1557/44100,1617/44100,1491/44100,1422/44100,1277/44100,1356/44100,1188/44100,1116/44100];var i=[225,556,441,341];t.Freeverb=function(){var s=this.optionsObject(arguments,["roomSize","dampening"],t.Freeverb.defaults);t.StereoEffect.call(this,s);this.roomSize=new t.Signal(s.roomSize,t.Type.NormalRange);this.dampening=new t.Signal(s.dampening,t.Type.Frequency);this._combFilters=[];this._allpassFiltersL=[];this._allpassFiltersR=[];for(var n=0;n<i.length;n++){var o=this.context.createBiquadFilter();o.type="allpass";o.frequency.value=i[n];this._allpassFiltersL.push(o)}for(var r=0;r<i.length;r++){var a=this.context.createBiquadFilter();a.type="allpass";a.frequency.value=i[r];this._allpassFiltersR.push(a)}for(var l=0;l<e.length;l++){var h=new t.LowpassCombFilter(e[l]);if(l<e.length/2){this.effectSendL.chain(h,this._allpassFiltersL[0])}else{this.effectSendR.chain(h,this._allpassFiltersR[0])}this.roomSize.connect(h.resonance);this.dampening.connect(h.dampening);this._combFilters.push(h)}this.connectSeries.apply(this,this._allpassFiltersL);this.connectSeries.apply(this,this._allpassFiltersR);this._allpassFiltersL[this._allpassFiltersL.length-1].connect(this.effectReturnL);this._allpassFiltersR[this._allpassFiltersR.length-1].connect(this.effectReturnR);this._readOnly(["roomSize","dampening"])};t.extend(t.Freeverb,t.StereoEffect);t.Freeverb.defaults={roomSize:.7,dampening:3e3};t.Freeverb.prototype.dispose=function(){t.StereoEffect.prototype.dispose.call(this);for(var e=0;e<this._allpassFiltersL.length;e++){this._allpassFiltersL[e].disconnect();this._allpassFiltersL[e]=null}this._allpassFiltersL=null;for(var i=0;i<this._allpassFiltersR.length;i++){this._allpassFiltersR[i].disconnect();this._allpassFiltersR[i]=null}this._allpassFiltersR=null;for(var s=0;s<this._combFilters.length;s++){this._combFilters[s].dispose();this._combFilters[s]=null}this._combFilters=null;this._writable(["roomSize","dampening"]);this.roomSize.dispose();this.roomSize=null;this.dampening.dispose();this.dampening=null;return this};return t.Freeverb});i(function(t){var e=[1687/25e3,1601/25e3,2053/25e3,2251/25e3];var i=[.773,.802,.753,.733];var s=[347,113,37];t.JCReverb=function(){var n=this.optionsObject(arguments,["roomSize"],t.JCReverb.defaults);t.StereoEffect.call(this,n);this.roomSize=new t.Signal(n.roomSize,t.Type.NormalRange);this._scaleRoomSize=new t.Scale(-.733,.197);this._allpassFilters=[];this._feedbackCombFilters=[];for(var o=0;o<s.length;o++){var r=this.context.createBiquadFilter();r.type="allpass";r.frequency.value=s[o];this._allpassFilters.push(r)}for(var a=0;a<e.length;a++){var l=new t.FeedbackCombFilter(e[a],.1);this._scaleRoomSize.connect(l.resonance);l.resonance.value=i[a];this._allpassFilters[this._allpassFilters.length-1].connect(l);if(a<e.length/2){l.connect(this.effectReturnL)}else{l.connect(this.effectReturnR)}this._feedbackCombFilters.push(l)}this.roomSize.connect(this._scaleRoomSize);this.connectSeries.apply(this,this._allpassFilters);this.effectSendL.connect(this._allpassFilters[0]);this.effectSendR.connect(this._allpassFilters[0]);this._readOnly(["roomSize"])};t.extend(t.JCReverb,t.StereoEffect);t.JCReverb.defaults={roomSize:.5};t.JCReverb.prototype.dispose=function(){t.StereoEffect.prototype.dispose.call(this);for(var e=0;e<this._allpassFilters.length;e++){this._allpassFilters[e].disconnect();this._allpassFilters[e]=null}this._allpassFilters=null;for(var i=0;i<this._feedbackCombFilters.length;i++){this._feedbackCombFilters[i].dispose();this._feedbackCombFilters[i]=null}this._feedbackCombFilters=null;this._writable(["roomSize"]);this.roomSize.dispose();this.roomSize=null;this._scaleRoomSize.dispose();this._scaleRoomSize=null;return this};return t.JCReverb});i(function(t){t.MidSideEffect=function(){t.Effect.apply(this,arguments);this._midSideSplit=new t.MidSideSplit;this._midSideMerge=new t.MidSideMerge;this.midSend=this._midSideSplit.mid;this.sideSend=this._midSideSplit.side;this.midReturn=this._midSideMerge.mid;this.sideReturn=this._midSideMerge.side;this.effectSend.connect(this._midSideSplit);this._midSideMerge.connect(this.effectReturn)};t.extend(t.MidSideEffect,t.Effect);t.MidSideEffect.prototype.dispose=function(){t.Effect.prototype.dispose.call(this);this._midSideSplit.dispose();this._midSideSplit=null;this._midSideMerge.dispose();this._midSideMerge=null;this.midSend=null;this.sideSend=null;this.midReturn=null;this.sideReturn=null;return this};return t.MidSideEffect});i(function(t){t.Phaser=function(){var e=this.optionsObject(arguments,["frequency","octaves","baseFrequency"],t.Phaser.defaults);t.StereoEffect.call(this,e);this._lfoL=new t.LFO(e.frequency,0,1);this._lfoR=new t.LFO(e.frequency,0,1);this._lfoR.phase=180;this._baseFrequency=e.baseFrequency;this._octaves=e.octaves;this.Q=new t.Signal(e.Q,t.Type.Positive);this._filtersL=this._makeFilters(e.stages,this._lfoL,this.Q);this._filtersR=this._makeFilters(e.stages,this._lfoR,this.Q);this.frequency=this._lfoL.frequency;this.frequency.value=e.frequency;this.effectSendL.connect(this._filtersL[0]);this.effectSendR.connect(this._filtersR[0]);this._filtersL[e.stages-1].connect(this.effectReturnL);this._filtersR[e.stages-1].connect(this.effectReturnR);this._lfoL.frequency.connect(this._lfoR.frequency);this.baseFrequency=e.baseFrequency;this.octaves=e.octaves;this._lfoL.start();this._lfoR.start();this._readOnly(["frequency","Q"])};t.extend(t.Phaser,t.StereoEffect);t.Phaser.defaults={frequency:.5,octaves:3,stages:10,Q:10,baseFrequency:350};t.Phaser.prototype._makeFilters=function(t,e,i){var s=new Array(t);for(var n=0;n<t;n++){var o=this.context.createBiquadFilter();o.type="allpass";i.connect(o.Q);e.connect(o.frequency);s[n]=o}this.connectSeries.apply(this,s);return s};Object.defineProperty(t.Phaser.prototype,"octaves",{get:function(){return this._octaves},set:function(t){this._octaves=t;var e=this._baseFrequency*Math.pow(2,t);this._lfoL.max=e;this._lfoR.max=e}});Object.defineProperty(t.Phaser.prototype,"baseFrequency",{get:function(){return this._baseFrequency},set:function(t){this._baseFrequency=t;this._lfoL.min=t;this._lfoR.min=t;this.octaves=this._octaves}});t.Phaser.prototype.dispose=function(){t.StereoEffect.prototype.dispose.call(this);this._writable(["frequency","Q"]);this.Q.dispose();this.Q=null;this._lfoL.dispose();this._lfoL=null;this._lfoR.dispose();this._lfoR=null;for(var e=0;e<this._filtersL.length;e++){this._filtersL[e].disconnect();this._filtersL[e]=null}this._filtersL=null;for(var i=0;i<this._filtersR.length;i++){this._filtersR[i].disconnect();this._filtersR[i]=null}this._filtersR=null;this.frequency=null;return this};return t.Phaser});i(function(t){t.PingPongDelay=function(){var e=this.optionsObject(arguments,["delayTime","feedback"],t.PingPongDelay.defaults);t.StereoXFeedbackEffect.call(this,e);this._leftDelay=new t.Delay(0,e.maxDelayTime);this._rightDelay=new t.Delay(0,e.maxDelayTime);this._rightPreDelay=new t.Delay(0,e.maxDelayTime);this.delayTime=new t.Signal(e.delayTime,t.Type.Time);this.effectSendL.chain(this._leftDelay,this.effectReturnL);this.effectSendR.chain(this._rightPreDelay,this._rightDelay,this.effectReturnR);this.delayTime.fan(this._leftDelay.delayTime,this._rightDelay.delayTime,this._rightPreDelay.delayTime);this._feedbackLR.disconnect();this._feedbackLR.connect(this._rightDelay);this._readOnly(["delayTime"])};t.extend(t.PingPongDelay,t.StereoXFeedbackEffect);t.PingPongDelay.defaults={delayTime:.25,maxDelayTime:1};t.PingPongDelay.prototype.dispose=function(){t.StereoXFeedbackEffect.prototype.dispose.call(this);this._leftDelay.dispose();this._leftDelay=null;this._rightDelay.dispose();this._rightDelay=null;this._rightPreDelay.dispose();this._rightPreDelay=null;this._writable(["delayTime"]);this.delayTime.dispose();this.delayTime=null;return this};return t.PingPongDelay});i(function(t){t.PitchShift=function(){var e=this.optionsObject(arguments,["pitch"],t.PitchShift.defaults);t.FeedbackEffect.call(this,e);this._frequency=new t.Signal(0);this._delayA=new t.Delay(0,1);this._lfoA=new t.LFO({min:0,max:.1,type:"sawtooth"}).connect(this._delayA.delayTime);this._delayB=new t.Delay(0,1);this._lfoB=new t.LFO({min:0,max:.1,type:"sawtooth",phase:180}).connect(this._delayB.delayTime);this._crossFade=new t.CrossFade;this._crossFadeLFO=new t.LFO({min:0,max:1,type:"triangle",phase:90}).connect(this._crossFade.fade);this._feedbackDelay=new t.Delay(e.delayTime);this.delayTime=this._feedbackDelay.delayTime;this._readOnly("delayTime");this._pitch=e.pitch;this._windowSize=e.windowSize;this._delayA.connect(this._crossFade.a);this._delayB.connect(this._crossFade.b);this._frequency.fan(this._lfoA.frequency,this._lfoB.frequency,this._crossFadeLFO.frequency);this.effectSend.fan(this._delayA,this._delayB);this._crossFade.chain(this._feedbackDelay,this.effectReturn);var i=this.now();this._lfoA.start(i);this._lfoB.start(i);this._crossFadeLFO.start(i);this.windowSize=this._windowSize};t.extend(t.PitchShift,t.FeedbackEffect);t.PitchShift.defaults={pitch:0,windowSize:.1,delayTime:0,feedback:0};Object.defineProperty(t.PitchShift.prototype,"pitch",{get:function(){return this._pitch},set:function(t){this._pitch=t;var e=0;if(t<0){this._lfoA.min=0;this._lfoA.max=this._windowSize;this._lfoB.min=0;this._lfoB.max=this._windowSize;e=this.intervalToFrequencyRatio(t-1)+1}else{this._lfoA.min=this._windowSize;this._lfoA.max=0;this._lfoB.min=this._windowSize;this._lfoB.max=0;e=this.intervalToFrequencyRatio(t)-1}this._frequency.value=e*(1.2/this._windowSize)}});Object.defineProperty(t.PitchShift.prototype,"windowSize",{get:function(){return this._windowSize},set:function(t){this._windowSize=this.toSeconds(t);this.pitch=this._pitch}});t.PitchShift.prototype.dispose=function(){t.FeedbackEffect.prototype.dispose.call(this);this._frequency.dispose();this._frequency=null;this._delayA.disconnect();this._delayA=null;this._delayB.disconnect();this._delayB=null;this._lfoA.dispose();this._lfoA=null;this._lfoB.dispose();this._lfoB=null;this._crossFade.dispose();this._crossFade=null;this._crossFadeLFO.dispose();this._crossFadeLFO=null;this._writable("delayTime");this._feedbackDelay.dispose();this._feedbackDelay=null;this.delayTime=null;return this};return t.PitchShift});i(function(t){t.StereoFeedbackEffect=function(){var e=this.optionsObject(arguments,["feedback"],t.FeedbackEffect.defaults);t.StereoEffect.call(this,e);this.feedback=new t.Signal(e.feedback,t.Type.NormalRange);this._feedbackL=new t.Gain;this._feedbackR=new t.Gain;this.effectReturnL.chain(this._feedbackL,this.effectSendL);this.effectReturnR.chain(this._feedbackR,this.effectSendR);this.feedback.fan(this._feedbackL.gain,this._feedbackR.gain);this._readOnly(["feedback"])};t.extend(t.StereoFeedbackEffect,t.FeedbackEffect);t.StereoFeedbackEffect.prototype.dispose=function(){t.StereoEffect.prototype.dispose.call(this);this._writable(["feedback"]);this.feedback.dispose();this.feedback=null;this._feedbackL.dispose();this._feedbackL=null;this._feedbackR.dispose();this._feedbackR=null;return this};return t.StereoFeedbackEffect});i(function(t){t.StereoWidener=function(){var e=this.optionsObject(arguments,["width"],t.StereoWidener.defaults);t.MidSideEffect.call(this,e);this.width=new t.Signal(e.width,t.Type.NormalRange);this._midMult=new t.Expr("$0 * ($1 * (1 - $2))");this._sideMult=new t.Expr("$0 * ($1 * $2)");this._two=new t.Signal(2);this._two.connect(this._midMult,0,1);this.width.connect(this._midMult,0,2);this._two.connect(this._sideMult,0,1);this.width.connect(this._sideMult,0,2);this.midSend.chain(this._midMult,this.midReturn);this.sideSend.chain(this._sideMult,this.sideReturn);this._readOnly(["width"])};t.extend(t.StereoWidener,t.MidSideEffect);t.StereoWidener.defaults={width:.5};t.StereoWidener.prototype.dispose=function(){t.MidSideEffect.prototype.dispose.call(this);this._writable(["width"]);this.width.dispose();this.width=null;this._midMult.dispose();this._midMult=null;this._sideMult.dispose();this._sideMult=null;this._two.dispose();this._two=null;return this};return t.StereoWidener});i(function(t){t.Tremolo=function(){var e=this.optionsObject(arguments,["frequency","depth"],t.Tremolo.defaults);t.StereoEffect.call(this,e);this._lfoL=new t.LFO({phase:e.spread,min:1,max:0});this._lfoR=new t.LFO({phase:e.spread,min:1,max:0});this._amplitudeL=new t.Gain;this._amplitudeR=new t.Gain;this.frequency=new t.Signal(e.frequency,t.Type.Frequency);this.depth=new t.Signal(e.depth,t.Type.NormalRange);this._readOnly(["frequency","depth"]);this.effectSendL.chain(this._amplitudeL,this.effectReturnL);this.effectSendR.chain(this._amplitudeR,this.effectReturnR);this._lfoL.connect(this._amplitudeL.gain);this._lfoR.connect(this._amplitudeR.gain);this.frequency.fan(this._lfoL.frequency,this._lfoR.frequency);this.depth.fan(this._lfoR.amplitude,this._lfoL.amplitude);this.type=e.type;this.spread=e.spread};t.extend(t.Tremolo,t.StereoEffect);t.Tremolo.defaults={frequency:10,type:"sine",depth:.5,spread:180};t.Tremolo.prototype.start=function(t){this._lfoL.start(t);this._lfoR.start(t);return this};t.Tremolo.prototype.stop=function(t){this._lfoL.stop(t);this._lfoR.stop(t);return this};t.Tremolo.prototype.sync=function(t){this._lfoL.sync(t);this._lfoR.sync(t);return this};t.Tremolo.prototype.unsync=function(){this._lfoL.unsync();this._lfoR.unsync();return this};Object.defineProperty(t.Tremolo.prototype,"type",{get:function(){return this._lfoL.type},set:function(t){this._lfoL.type=t;this._lfoR.type=t}});Object.defineProperty(t.Tremolo.prototype,"spread",{get:function(){return this._lfoR.phase-this._lfoL.phase},set:function(t){this._lfoL.phase=90-t/2;this._lfoR.phase=t/2+90}});t.Tremolo.prototype.dispose=function(){t.StereoEffect.prototype.dispose.call(this);this._writable(["frequency","depth"]);this._lfoL.dispose();this._lfoL=null;this._lfoR.dispose();this._lfoR=null;this._amplitudeL.dispose();this._amplitudeL=null;this._amplitudeR.dispose();this._amplitudeR=null;this.frequency=null;this.depth=null;return this};return t.Tremolo});i(function(t){t.Vibrato=function(){var e=this.optionsObject(arguments,["frequency","depth"],t.Vibrato.defaults);t.Effect.call(this,e);this._delayNode=new t.Delay(0,e.maxDelay);this._lfo=new t.LFO({type:e.type,min:0,max:e.maxDelay,frequency:e.frequency,phase:-90}).start().connect(this._delayNode.delayTime);this.frequency=this._lfo.frequency;this.depth=this._lfo.amplitude;this.depth.value=e.depth;this._readOnly(["frequency","depth"]);this.effectSend.chain(this._delayNode,this.effectReturn)};t.extend(t.Vibrato,t.Effect);t.Vibrato.defaults={maxDelay:.005,frequency:5,depth:.1,type:"sine"};Object.defineProperty(t.Vibrato.prototype,"type",{get:function(){return this._lfo.type},set:function(t){this._lfo.type=t}});t.Vibrato.prototype.dispose=function(){t.Effect.prototype.dispose.call(this);this._delayNode.dispose();this._delayNode=null;this._lfo.dispose();this._lfo=null;this._writable(["frequency","depth"]);this.frequency=null;this.depth=null};return t.Vibrato});i(function(t){t.Event=function(){var e=this.optionsObject(arguments,["callback","value"],t.Event.defaults);this._loop=e.loop;this.callback=e.callback;this.value=e.value;this._loopStart=this.toTicks(e.loopStart);this._loopEnd=this.toTicks(e.loopEnd);this._state=new t.TimelineState(t.State.Stopped);this._playbackRate=1;this._startOffset=0;this.probability=e.probability;this.humanize=e.humanize;this.mute=e.mute;this.playbackRate=e.playbackRate};t.extend(t.Event);t.Event.defaults={callback:t.noOp,loop:false,loopEnd:"1m",loopStart:0,playbackRate:1,value:null,probability:1,mute:false,humanize:false};t.Event.prototype._rescheduleEvents=function(e){e=this.defaultArg(e,-1);this._state.forEachFrom(e,function(e){var i;if(e.state===t.State.Started){if(!this.isUndef(e.id)){t.Transport.clear(e.id)}var s=e.time+Math.round(this.startOffset/this._playbackRate);if(this._loop){i=Infinity;if(this.isNumber(this._loop)){i=this._loop*this._getLoopDuration()}var n=this._state.getEventAfter(s);if(n!==null){i=Math.min(i,n.time-s)}if(i!==Infinity){this._state.setStateAtTime(t.State.Stopped,s+i+1);i=t.Time(i,"i")}var o=t.Time(this._getLoopDuration(),"i");e.id=t.Transport.scheduleRepeat(this._tick.bind(this),o,t.TransportTime(s,"i"),i)}else{e.id=t.Transport.schedule(this._tick.bind(this),s+"i")}}}.bind(this));return this};Object.defineProperty(t.Event.prototype,"state",{get:function(){return this._state.getStateAtTime(t.Transport.ticks)}});Object.defineProperty(t.Event.prototype,"startOffset",{get:function(){return this._startOffset},set:function(t){this._startOffset=t}});t.Event.prototype.start=function(e){e=this.toTicks(e);if(this._state.getStateAtTime(e)===t.State.Stopped){this._state.addEvent({state:t.State.Started,time:e,id:undefined});this._rescheduleEvents(e)}return this};t.Event.prototype.stop=function(e){this.cancel(e);e=this.toTicks(e);if(this._state.getStateAtTime(e)===t.State.Started){this._state.setStateAtTime(t.State.Stopped,e);var i=this._state.getEventBefore(e);var s=e;if(i!==null){s=i.time}this._rescheduleEvents(s)}return this};t.Event.prototype.cancel=function(e){e=this.defaultArg(e,-Infinity);e=this.toTicks(e);this._state.forEachFrom(e,function(e){
t.Transport.clear(e.id)});this._state.cancel(e);return this};t.Event.prototype._tick=function(e){if(!this.mute&&this._state.getStateAtTime(t.Transport.ticks)===t.State.Started){if(this.probability<1&&Math.random()>this.probability){return}if(this.humanize){var i=.02;if(!this.isBoolean(this.humanize)){i=this.toSeconds(this.humanize)}e+=(Math.random()*2-1)*i}this.callback(e,this.value)}};t.Event.prototype._getLoopDuration=function(){return Math.round((this._loopEnd-this._loopStart)/this._playbackRate)};Object.defineProperty(t.Event.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=t;this._rescheduleEvents()}});Object.defineProperty(t.Event.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(t){this._playbackRate=t;this._rescheduleEvents()}});Object.defineProperty(t.Event.prototype,"loopEnd",{get:function(){return t.TransportTime(this._loopEnd,"i").toNotation()},set:function(t){this._loopEnd=this.toTicks(t);if(this._loop){this._rescheduleEvents()}}});Object.defineProperty(t.Event.prototype,"loopStart",{get:function(){return t.TransportTime(this._loopStart,"i").toNotation()},set:function(t){this._loopStart=this.toTicks(t);if(this._loop){this._rescheduleEvents()}}});Object.defineProperty(t.Event.prototype,"progress",{get:function(){if(this._loop){var e=t.Transport.ticks;var i=this._state.getEvent(e);if(i!==null&&i.state===t.State.Started){var s=this._getLoopDuration();var n=(e-i.time)%s;return n/s}else{return 0}}else{return 0}}});t.Event.prototype.dispose=function(){this.cancel();this._state.dispose();this._state=null;this.callback=null;this.value=null};return t.Event});i(function(t){t.Loop=function(){var e=this.optionsObject(arguments,["callback","interval"],t.Loop.defaults);this._event=new t.Event({callback:this._tick.bind(this),loop:true,loopEnd:e.interval,playbackRate:e.playbackRate,probability:e.probability});this.callback=e.callback;this.iterations=e.iterations};t.extend(t.Loop);t.Loop.defaults={interval:"4n",callback:t.noOp,playbackRate:1,iterations:Infinity,probability:true,mute:false};t.Loop.prototype.start=function(t){this._event.start(t);return this};t.Loop.prototype.stop=function(t){this._event.stop(t);return this};t.Loop.prototype.cancel=function(t){this._event.cancel(t);return this};t.Loop.prototype._tick=function(t){this.callback(t)};Object.defineProperty(t.Loop.prototype,"state",{get:function(){return this._event.state}});Object.defineProperty(t.Loop.prototype,"progress",{get:function(){return this._event.progress}});Object.defineProperty(t.Loop.prototype,"interval",{get:function(){return this._event.loopEnd},set:function(t){this._event.loopEnd=t}});Object.defineProperty(t.Loop.prototype,"playbackRate",{get:function(){return this._event.playbackRate},set:function(t){this._event.playbackRate=t}});Object.defineProperty(t.Loop.prototype,"humanize",{get:function(){return this._event.humanize},set:function(t){this._event.humanize=t}});Object.defineProperty(t.Loop.prototype,"probability",{get:function(){return this._event.probability},set:function(t){this._event.probability=t}});Object.defineProperty(t.Loop.prototype,"mute",{get:function(){return this._event.mute},set:function(t){this._event.mute=t}});Object.defineProperty(t.Loop.prototype,"iterations",{get:function(){if(this._event.loop===true){return Infinity}else{return this._event.loop}return this._pattern.index},set:function(t){if(t===Infinity){this._event.loop=true}else{this._event.loop=t}}});t.Loop.prototype.dispose=function(){this._event.dispose();this._event=null;this.callback=null};return t.Loop});i(function(t){t.Part=function(){var e=this.optionsObject(arguments,["callback","events"],t.Part.defaults);this._loop=e.loop;this._loopStart=this.toTicks(e.loopStart);this._loopEnd=this.toTicks(e.loopEnd);this._playbackRate=e.playbackRate;this._probability=e.probability;this._humanize=e.humanize;this._startOffset=0;this._state=new t.TimelineState(t.State.Stopped);this._events=[];this.callback=e.callback;this.mute=e.mute;var i=this.defaultArg(e.events,[]);if(!this.isUndef(e.events)){for(var s=0;s<i.length;s++){if(Array.isArray(i[s])){this.add(i[s][0],i[s][1])}else{this.add(i[s])}}}};t.extend(t.Part,t.Event);t.Part.defaults={callback:t.noOp,loop:false,loopEnd:"1m",loopStart:0,playbackRate:1,probability:1,humanize:false,mute:false};t.Part.prototype.start=function(e,i){var s=this.toTicks(e);if(this._state.getStateAtTime(s)!==t.State.Started){if(this._loop){i=this.defaultArg(i,this._loopStart)}else{i=this.defaultArg(i,0)}i=this.toTicks(i);this._state.addEvent({state:t.State.Started,time:s,offset:i});this._forEach(function(t){this._startNote(t,s,i)})}return this};t.Part.prototype._startNote=function(e,i,s){i-=s;if(this._loop){if(e.startOffset>=this._loopStart&&e.startOffset<this._loopEnd){if(e.startOffset<s){i+=this._getLoopDuration()}e.start(t.TransportTime(i,"i"))}else if(e.startOffset<this._loopStart&&e.startOffset>=s){e.loop=false;e.start(t.TransportTime(i,"i"))}}else{if(e.startOffset>=s){e.start(t.TransportTime(i,"i"))}}};Object.defineProperty(t.Part.prototype,"startOffset",{get:function(){return this._startOffset},set:function(t){this._startOffset=t;this._forEach(function(t){t.startOffset+=this._startOffset})}});t.Part.prototype.stop=function(e){var i=this.toTicks(e);this._state.cancel(i);this._state.setStateAtTime(t.State.Stopped,i);this._forEach(function(t){t.stop(e)});return this};t.Part.prototype.at=function(e,i){e=t.TransportTime(e);var s=t.Time(1,"i").toSeconds();for(var n=0;n<this._events.length;n++){var o=this._events[n];if(Math.abs(e.toTicks()-o.startOffset)<s){if(!this.isUndef(i)){o.value=i}return o}}if(!this.isUndef(i)){this.add(e,i);return this._events[this._events.length-1]}else{return null}};t.Part.prototype.add=function(e,i){if(e.hasOwnProperty("time")){i=e;e=i.time}e=this.toTicks(e);var s;if(i instanceof t.Event){s=i;s.callback=this._tick.bind(this)}else{s=new t.Event({callback:this._tick.bind(this),value:i})}s.startOffset=e;s.set({loopEnd:this.loopEnd,loopStart:this.loopStart,loop:this.loop,humanize:this.humanize,playbackRate:this.playbackRate,probability:this.probability});this._events.push(s);this._restartEvent(s);return this};t.Part.prototype._restartEvent=function(e){var i=this._state.getEvent(t.Transport.ticks);if(i&&i.state===t.State.Started){this._startNote(e,i.time,i.offset)}};t.Part.prototype.remove=function(e,i){if(e.hasOwnProperty("time")){i=e;e=i.time}e=this.toTicks(e);for(var s=this._events.length-1;s>=0;s--){var n=this._events[s];if(n instanceof t.Part){n.remove(e,i)}else{if(n.startOffset===e){if(this.isUndef(i)||!this.isUndef(i)&&n.value===i){this._events.splice(s,1);n.dispose()}}}}return this};t.Part.prototype.removeAll=function(){this._forEach(function(t){t.dispose()});this._events=[];return this};t.Part.prototype.cancel=function(t){t=this.toTicks(t);this._forEach(function(e){e.cancel(t)});this._state.cancel(t);return this};t.Part.prototype._forEach=function(e,i){i=this.defaultArg(i,this);for(var s=this._events.length-1;s>=0;s--){var n=this._events[s];if(n instanceof t.Part){n._forEach(e,i)}else{e.call(i,n)}}return this};t.Part.prototype._setAll=function(t,e){this._forEach(function(i){i[t]=e})};t.Part.prototype._tick=function(t,e){if(!this.mute){this.callback(t,e)}};t.Part.prototype._testLoopBoundries=function(e){if(e.startOffset<this._loopStart||e.startOffset>=this._loopEnd){e.cancel()}else{if(e.state===t.State.Stopped){this._restartEvent(e)}}};Object.defineProperty(t.Part.prototype,"probability",{get:function(){return this._probability},set:function(t){this._probability=t;this._setAll("probability",t)}});Object.defineProperty(t.Part.prototype,"humanize",{get:function(){return this._humanize},set:function(t){this._humanize=t;this._setAll("humanize",t)}});Object.defineProperty(t.Part.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=t;this._forEach(function(e){e._loopStart=this._loopStart;e._loopEnd=this._loopEnd;e.loop=t;this._testLoopBoundries(e)})}});Object.defineProperty(t.Part.prototype,"loopEnd",{get:function(){return t.TransportTime(this._loopEnd,"i").toNotation()},set:function(t){this._loopEnd=this.toTicks(t);if(this._loop){this._forEach(function(t){t.loopEnd=this.loopEnd;this._testLoopBoundries(t)})}}});Object.defineProperty(t.Part.prototype,"loopStart",{get:function(){return t.TransportTime(this._loopStart,"i").toNotation()},set:function(t){this._loopStart=this.toTicks(t);if(this._loop){this._forEach(function(t){t.loopStart=this.loopStart;this._testLoopBoundries(t)})}}});Object.defineProperty(t.Part.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(t){this._playbackRate=t;this._setAll("playbackRate",t)}});Object.defineProperty(t.Part.prototype,"length",{get:function(){return this._events.length}});t.Part.prototype.dispose=function(){this.removeAll();this._state.dispose();this._state=null;this.callback=null;this._events=null;return this};return t.Part});i(function(t){t.Pattern=function(){var e=this.optionsObject(arguments,["callback","values","pattern"],t.Pattern.defaults);t.Loop.call(this,e);this._pattern=new t.CtrlPattern({values:e.values,type:e.pattern,index:e.index})};t.extend(t.Pattern,t.Loop);t.Pattern.defaults={pattern:t.CtrlPattern.Type.Up,values:[]};t.Pattern.prototype._tick=function(t){this.callback(t,this._pattern.value);this._pattern.next()};Object.defineProperty(t.Pattern.prototype,"index",{get:function(){return this._pattern.index},set:function(t){this._pattern.index=t}});Object.defineProperty(t.Pattern.prototype,"values",{get:function(){return this._pattern.values},set:function(t){this._pattern.values=t}});Object.defineProperty(t.Pattern.prototype,"value",{get:function(){return this._pattern.value}});Object.defineProperty(t.Pattern.prototype,"pattern",{get:function(){return this._pattern.type},set:function(t){this._pattern.type=t}});t.Pattern.prototype.dispose=function(){t.Loop.prototype.dispose.call(this);this._pattern.dispose();this._pattern=null};return t.Pattern});i(function(t){t.Sequence=function(){var e=this.optionsObject(arguments,["callback","events","subdivision"],t.Sequence.defaults);var i=e.events;delete e.events;t.Part.call(this,e);this._subdivision=this.toTicks(e.subdivision);if(this.isUndef(e.loopEnd)&&!this.isUndef(i)){this._loopEnd=i.length*this._subdivision}this._loop=true;if(!this.isUndef(i)){for(var s=0;s<i.length;s++){this.add(s,i[s])}}};t.extend(t.Sequence,t.Part);t.Sequence.defaults={subdivision:"4n"};Object.defineProperty(t.Sequence.prototype,"subdivision",{get:function(){return t.Time(this._subdivision,"i").toNotation()}});t.Sequence.prototype.at=function(e,i){if(this.isArray(i)){this.remove(e)}return t.Part.prototype.at.call(this,this._indexTime(e),i)};t.Sequence.prototype.add=function(e,i){if(i===null){return this}if(this.isArray(i)){var s=Math.round(this._subdivision/i.length);i=new t.Sequence(this._tick.bind(this),i,t.Time(s,"i"))}t.Part.prototype.add.call(this,this._indexTime(e),i);return this};t.Sequence.prototype.remove=function(e,i){t.Part.prototype.remove.call(this,this._indexTime(e),i);return this};t.Sequence.prototype._indexTime=function(e){if(e instanceof t.TransportTime){return e}else{return t.TransportTime(e*this._subdivision+this.startOffset,"i")}};t.Sequence.prototype.dispose=function(){t.Part.prototype.dispose.call(this);return this};return t.Sequence});i(function(t){t.PulseOscillator=function(){var e=this.optionsObject(arguments,["frequency","width"],t.Oscillator.defaults);t.Source.call(this,e);this.width=new t.Signal(e.width,t.Type.NormalRange);this._widthGate=new t.Gain;this._sawtooth=new t.Oscillator({frequency:e.frequency,detune:e.detune,type:"sawtooth",phase:e.phase});this.frequency=this._sawtooth.frequency;this.detune=this._sawtooth.detune;this._thresh=new t.WaveShaper(function(t){if(t<0){return-1}else{return 1}});this._sawtooth.chain(this._thresh,this.output);this.width.chain(this._widthGate,this._thresh);this._readOnly(["width","frequency","detune"])};t.extend(t.PulseOscillator,t.Oscillator);t.PulseOscillator.defaults={frequency:440,detune:0,phase:0,width:.2};t.PulseOscillator.prototype._start=function(t){t=this.toSeconds(t);this._sawtooth.start(t);this._widthGate.gain.setValueAtTime(1,t)};t.PulseOscillator.prototype._stop=function(t){t=this.toSeconds(t);this._sawtooth.stop(t);this._widthGate.gain.setValueAtTime(0,t)};Object.defineProperty(t.PulseOscillator.prototype,"phase",{get:function(){return this._sawtooth.phase},set:function(t){this._sawtooth.phase=t}});Object.defineProperty(t.PulseOscillator.prototype,"type",{get:function(){return"pulse"}});Object.defineProperty(t.PulseOscillator.prototype,"partials",{get:function(){return[]}});t.PulseOscillator.prototype.dispose=function(){t.Source.prototype.dispose.call(this);this._sawtooth.dispose();this._sawtooth=null;this._writable(["width","frequency","detune"]);this.width.dispose();this.width=null;this._widthGate.dispose();this._widthGate=null;this._thresh.dispose();this._thresh=null;this.frequency=null;this.detune=null;return this};return t.PulseOscillator});i(function(t){t.PWMOscillator=function(){var e=this.optionsObject(arguments,["frequency","modulationFrequency"],t.PWMOscillator.defaults);t.Source.call(this,e);this._pulse=new t.PulseOscillator(e.modulationFrequency);this._pulse._sawtooth.type="sine";this._modulator=new t.Oscillator({frequency:e.frequency,detune:e.detune,phase:e.phase});this._scale=new t.Multiply(2);this.frequency=this._modulator.frequency;this.detune=this._modulator.detune;this.modulationFrequency=this._pulse.frequency;this._modulator.chain(this._scale,this._pulse.width);this._pulse.connect(this.output);this._readOnly(["modulationFrequency","frequency","detune"])};t.extend(t.PWMOscillator,t.Oscillator);t.PWMOscillator.defaults={frequency:440,detune:0,phase:0,modulationFrequency:.4};t.PWMOscillator.prototype._start=function(t){t=this.toSeconds(t);this._modulator.start(t);this._pulse.start(t)};t.PWMOscillator.prototype._stop=function(t){t=this.toSeconds(t);this._modulator.stop(t);this._pulse.stop(t)};Object.defineProperty(t.PWMOscillator.prototype,"type",{get:function(){return"pwm"}});Object.defineProperty(t.PWMOscillator.prototype,"partials",{get:function(){return[]}});Object.defineProperty(t.PWMOscillator.prototype,"phase",{get:function(){return this._modulator.phase},set:function(t){this._modulator.phase=t}});t.PWMOscillator.prototype.dispose=function(){t.Source.prototype.dispose.call(this);this._pulse.dispose();this._pulse=null;this._scale.dispose();this._scale=null;this._modulator.dispose();this._modulator=null;this._writable(["modulationFrequency","frequency","detune"]);this.frequency=null;this.detune=null;this.modulationFrequency=null;return this};return t.PWMOscillator});i(function(t){t.FMOscillator=function(){var e=this.optionsObject(arguments,["frequency","type","modulationType"],t.FMOscillator.defaults);t.Source.call(this,e);this._carrier=new t.Oscillator(e.frequency,e.type);this.frequency=new t.Signal(e.frequency,t.Type.Frequency);this.detune=this._carrier.detune;this.detune.value=e.detune;this.modulationIndex=new t.Multiply(e.modulationIndex);this.modulationIndex.units=t.Type.Positive;this._modulator=new t.Oscillator(e.frequency,e.modulationType);this.harmonicity=new t.Multiply(e.harmonicity);this.harmonicity.units=t.Type.Positive;this._modulationNode=new t.Gain(0);this.frequency.connect(this._carrier.frequency);this.frequency.chain(this.harmonicity,this._modulator.frequency);this.frequency.chain(this.modulationIndex,this._modulationNode);this._modulator.connect(this._modulationNode.gain);this._modulationNode.connect(this._carrier.frequency);this._carrier.connect(this.output);this.detune.connect(this._modulator.detune);this.phase=e.phase;this._readOnly(["modulationIndex","frequency","detune","harmonicity"])};t.extend(t.FMOscillator,t.Oscillator);t.FMOscillator.defaults={frequency:440,detune:0,phase:0,modulationIndex:2,modulationType:"square",harmonicity:1};t.FMOscillator.prototype._start=function(t){t=this.toSeconds(t);this._modulator.start(t);this._carrier.start(t)};t.FMOscillator.prototype._stop=function(t){t=this.toSeconds(t);this._modulator.stop(t);this._carrier.stop(t)};Object.defineProperty(t.FMOscillator.prototype,"type",{get:function(){return this._carrier.type},set:function(t){this._carrier.type=t}});Object.defineProperty(t.FMOscillator.prototype,"modulationType",{get:function(){return this._modulator.type},set:function(t){this._modulator.type=t}});Object.defineProperty(t.FMOscillator.prototype,"phase",{get:function(){return this._carrier.phase},set:function(t){this._carrier.phase=t;this._modulator.phase=t}});Object.defineProperty(t.FMOscillator.prototype,"partials",{get:function(){return this._carrier.partials},set:function(t){this._carrier.partials=t}});t.FMOscillator.prototype.dispose=function(){t.Source.prototype.dispose.call(this);this._writable(["modulationIndex","frequency","detune","harmonicity"]);this.frequency.dispose();this.frequency=null;this.detune=null;this.harmonicity.dispose();this.harmonicity=null;this._carrier.dispose();this._carrier=null;this._modulator.dispose();this._modulator=null;this._modulationNode.dispose();this._modulationNode=null;this.modulationIndex.dispose();this.modulationIndex=null;return this};return t.FMOscillator});i(function(t){t.AMOscillator=function(){var e=this.optionsObject(arguments,["frequency","type","modulationType"],t.AMOscillator.defaults);t.Source.call(this,e);this._carrier=new t.Oscillator(e.frequency,e.type);this.frequency=this._carrier.frequency;this.detune=this._carrier.detune;this.detune.value=e.detune;this._modulator=new t.Oscillator(e.frequency,e.modulationType);this._modulationScale=new t.AudioToGain;this.harmonicity=new t.Multiply(e.harmonicity);this.harmonicity.units=t.Type.Positive;this._modulationNode=new t.Gain(0);this.frequency.chain(this.harmonicity,this._modulator.frequency);this.detune.connect(this._modulator.detune);this._modulator.chain(this._modulationScale,this._modulationNode.gain);this._carrier.chain(this._modulationNode,this.output);this.phase=e.phase;this._readOnly(["frequency","detune","harmonicity"])};t.extend(t.AMOscillator,t.Oscillator);t.AMOscillator.defaults={frequency:440,detune:0,phase:0,modulationType:"square",harmonicity:1};t.AMOscillator.prototype._start=function(t){t=this.toSeconds(t);this._modulator.start(t);this._carrier.start(t)};t.AMOscillator.prototype._stop=function(t){t=this.toSeconds(t);this._modulator.stop(t);this._carrier.stop(t)};Object.defineProperty(t.AMOscillator.prototype,"type",{get:function(){return this._carrier.type},set:function(t){this._carrier.type=t}});Object.defineProperty(t.AMOscillator.prototype,"modulationType",{get:function(){return this._modulator.type},set:function(t){this._modulator.type=t}});Object.defineProperty(t.AMOscillator.prototype,"phase",{get:function(){return this._carrier.phase},set:function(t){this._carrier.phase=t;this._modulator.phase=t}});Object.defineProperty(t.AMOscillator.prototype,"partials",{get:function(){return this._carrier.partials},set:function(t){this._carrier.partials=t}});t.AMOscillator.prototype.dispose=function(){t.Source.prototype.dispose.call(this);this._writable(["frequency","detune","harmonicity"]);this.frequency=null;this.detune=null;this.harmonicity.dispose();this.harmonicity=null;this._carrier.dispose();this._carrier=null;this._modulator.dispose();this._modulator=null;this._modulationNode.dispose();this._modulationNode=null;this._modulationScale.dispose();this._modulationScale=null;return this};return t.AMOscillator});i(function(t){t.FatOscillator=function(){var e=this.optionsObject(arguments,["frequency","type","spread"],t.FatOscillator.defaults);t.Source.call(this,e);this.frequency=new t.Signal(e.frequency,t.Type.Frequency);this.detune=new t.Signal(e.detune,t.Type.Cents);this._oscillators=[];this._spread=e.spread;this._type=e.type;this._phase=e.phase;this._partials=this.defaultArg(e.partials,[]);this.count=e.count;this._readOnly(["frequency","detune"])};t.extend(t.FatOscillator,t.Oscillator);t.FatOscillator.defaults={frequency:440,detune:0,phase:0,spread:20,count:3,type:"sawtooth"};t.FatOscillator.prototype._start=function(t){t=this.toSeconds(t);this._forEach(function(e){e.start(t)})};t.FatOscillator.prototype._stop=function(t){t=this.toSeconds(t);this._forEach(function(e){e.stop(t)})};t.FatOscillator.prototype._forEach=function(t){for(var e=0;e<this._oscillators.length;e++){t.call(this,this._oscillators[e],e)}};Object.defineProperty(t.FatOscillator.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t;this._forEach(function(e){e.type=t})}});Object.defineProperty(t.FatOscillator.prototype,"spread",{get:function(){return this._spread},set:function(t){this._spread=t;if(this._oscillators.length>1){var e=-t/2;var i=t/(this._oscillators.length-1);this._forEach(function(t,s){t.detune.value=e+i*s})}}});Object.defineProperty(t.FatOscillator.prototype,"count",{get:function(){return this._oscillators.length},set:function(e){e=Math.max(e,1);if(this._oscillators.length!==e){this._forEach(function(t){t.dispose()});this._oscillators=[];for(var i=0;i<e;i++){var s=new t.Oscillator;if(this.type===t.Oscillator.Type.Custom){s.partials=this._partials}else{s.type=this._type}s.phase=this._phase;s.volume.value=-6-e;this.frequency.connect(s.frequency);this.detune.connect(s.detune);s.connect(this.output);this._oscillators[i]=s}this.spread=this._spread;if(this.state===t.State.Started){this._forEach(function(t){t.start()})}}}});Object.defineProperty(t.FatOscillator.prototype,"phase",{get:function(){return this._phase},set:function(t){this._phase=t;this._forEach(function(e){e.phase=t})}});Object.defineProperty(t.FatOscillator.prototype,"partials",{get:function(){return this._partials},set:function(e){this._partials=e;this._type=t.Oscillator.Type.Custom;this._forEach(function(t){t.partials=e})}});t.FatOscillator.prototype.dispose=function(){t.Source.prototype.dispose.call(this);this._writable(["frequency","detune"]);this.frequency.dispose();this.frequency=null;this.detune.dispose();this.detune=null;this._forEach(function(t){t.dispose()});this._oscillators=null;this._partials=null;return this};return t.FatOscillator});i(function(t){t.OmniOscillator=function(){var e=this.optionsObject(arguments,["frequency","type"],t.OmniOscillator.defaults);t.Source.call(this,e);this.frequency=new t.Signal(e.frequency,t.Type.Frequency);this.detune=new t.Signal(e.detune,t.Type.Cents);this._sourceType=undefined;this._oscillator=null;this.type=e.type;this._readOnly(["frequency","detune"]);this.set(e)};t.extend(t.OmniOscillator,t.Oscillator);t.OmniOscillator.defaults={frequency:440,detune:0,type:"sine",phase:0};var e={Pulse:"PulseOscillator",PWM:"PWMOscillator",Osc:"Oscillator",FM:"FMOscillator",AM:"AMOscillator",Fat:"FatOscillator"};t.OmniOscillator.prototype._start=function(t){this._oscillator.start(t)};t.OmniOscillator.prototype._stop=function(t){this._oscillator.stop(t)};Object.defineProperty(t.OmniOscillator.prototype,"type",{get:function(){var t="";if(this._sourceType===e.FM){t="fm"}else if(this._sourceType===e.AM){t="am"}else if(this._sourceType===e.Fat){t="fat"}return t+this._oscillator.type},set:function(t){if(t.substr(0,2)==="fm"){this._createNewOscillator(e.FM);this._oscillator.type=t.substr(2)}else if(t.substr(0,2)==="am"){this._createNewOscillator(e.AM);this._oscillator.type=t.substr(2)}else if(t.substr(0,3)==="fat"){this._createNewOscillator(e.Fat);this._oscillator.type=t.substr(3)}else if(t==="pwm"){this._createNewOscillator(e.PWM)}else if(t==="pulse"){this._createNewOscillator(e.Pulse)}else{this._createNewOscillator(e.Osc);this._oscillator.type=t}}});Object.defineProperty(t.OmniOscillator.prototype,"partials",{get:function(){return this._oscillator.partials},set:function(t){this._oscillator.partials=t}});t.OmniOscillator.prototype.set=function(e,i){if(e==="type"){this.type=i}else if(this.isObject(e)&&e.hasOwnProperty("type")){this.type=e.type}t.prototype.set.apply(this,arguments);return this};t.OmniOscillator.prototype._createNewOscillator=function(e){if(e!==this._sourceType){this._sourceType=e;var i=t[e];var s=this.now()+this.blockTime;if(this._oscillator!==null){var n=this._oscillator;n.stop(s);setTimeout(function(){n.dispose();n=null},this.blockTime*1e3)}this._oscillator=new i;this.frequency.connect(this._oscillator.frequency);this.detune.connect(this._oscillator.detune);this._oscillator.connect(this.output);if(this.state===t.State.Started){this._oscillator.start(s)}}};Object.defineProperty(t.OmniOscillator.prototype,"phase",{get:function(){return this._oscillator.phase},set:function(t){this._oscillator.phase=t}});Object.defineProperty(t.OmniOscillator.prototype,"width",{get:function(){if(this._sourceType===e.Pulse){return this._oscillator.width}}});Object.defineProperty(t.OmniOscillator.prototype,"count",{get:function(){if(this._sourceType===e.Fat){return this._oscillator.count}},set:function(t){if(this._sourceType===e.Fat){this._oscillator.count=t}}});Object.defineProperty(t.OmniOscillator.prototype,"spread",{get:function(){if(this._sourceType===e.Fat){return this._oscillator.spread}},set:function(t){if(this._sourceType===e.Fat){this._oscillator.spread=t}}});Object.defineProperty(t.OmniOscillator.prototype,"modulationType",{get:function(){if(this._sourceType===e.FM||this._sourceType===e.AM){return this._oscillator.modulationType}},set:function(t){if(this._sourceType===e.FM||this._sourceType===e.AM){this._oscillator.modulationType=t}}});Object.defineProperty(t.OmniOscillator.prototype,"modulationIndex",{get:function(){if(this._sourceType===e.FM){return this._oscillator.modulationIndex}}});Object.defineProperty(t.OmniOscillator.prototype,"harmonicity",{get:function(){if(this._sourceType===e.FM||this._sourceType===e.AM){return this._oscillator.harmonicity}}});Object.defineProperty(t.OmniOscillator.prototype,"modulationFrequency",{get:function(){if(this._sourceType===e.PWM){return this._oscillator.modulationFrequency}}});t.OmniOscillator.prototype.dispose=function(){t.Source.prototype.dispose.call(this);this._writable(["frequency","detune"]);this.detune.dispose();this.detune=null;this.frequency.dispose();this.frequency=null;this._oscillator.dispose();this._oscillator=null;this._sourceType=null;return this};return t.OmniOscillator});i(function(t){t.Instrument=function(e){e=this.defaultArg(e,t.Instrument.defaults);this._volume=this.output=new t.Volume(e.volume);this.volume=this._volume.volume;this._readOnly("volume")};t.extend(t.Instrument);t.Instrument.defaults={volume:0};t.Instrument.prototype.triggerAttack=t.noOp;t.Instrument.prototype.triggerRelease=t.noOp;t.Instrument.prototype.triggerAttackRelease=function(t,e,i,s){if(this.isUndef(i)){i=this.now()+this.blockTime}else{i=this.toSeconds(i)}e=this.toSeconds(e);this.triggerAttack(t,i,s);this.triggerRelease(i+e);return this};t.Instrument.prototype.dispose=function(){t.prototype.dispose.call(this);this._volume.dispose();this._volume=null;this._writable(["volume"]);this.volume=null;return this};return t.Instrument});i(function(t){t.Monophonic=function(e){e=this.defaultArg(e,t.Monophonic.defaults);t.Instrument.call(this,e);this.portamento=e.portamento};t.extend(t.Monophonic,t.Instrument);t.Monophonic.defaults={portamento:0};t.Monophonic.prototype.triggerAttack=function(t,e,i){if(this.isUndef(e)){e=this.now()+this.blockTime}else{e=this.toSeconds(e)}this._triggerEnvelopeAttack(e,i);this.setNote(t,e);return this};t.Monophonic.prototype.triggerRelease=function(t){if(this.isUndef(t)){t=this.now()+this.blockTime}else{t=this.toSeconds(t)}this._triggerEnvelopeRelease(t);return this};t.Monophonic.prototype._triggerEnvelopeAttack=function(){};t.Monophonic.prototype._triggerEnvelopeRelease=function(){};t.Monophonic.prototype.setNote=function(t,e){e=this.toSeconds(e);if(this.portamento>0){var i=this.frequency.value;this.frequency.setValueAtTime(i,e);var s=this.toSeconds(this.portamento);this.frequency.exponentialRampToValueAtTime(t,e+s)}else{this.frequency.setValueAtTime(t,e)}return this};return t.Monophonic});i(function(t){t.Synth=function(e){e=this.defaultArg(e,t.Synth.defaults);t.Monophonic.call(this,e);this.oscillator=new t.OmniOscillator(e.oscillator);this.frequency=this.oscillator.frequency;this.detune=this.oscillator.detune;this.envelope=new t.AmplitudeEnvelope(e.envelope);this.oscillator.chain(this.envelope,this.output);this.oscillator.start();this._readOnly(["oscillator","frequency","detune","envelope"])};t.extend(t.Synth,t.Monophonic);t.Synth.defaults={oscillator:{type:"triangle"},envelope:{attack:.005,decay:.1,sustain:.3,release:1}};t.Synth.prototype._triggerEnvelopeAttack=function(t,e){this.envelope.triggerAttack(t,e);return this};t.Synth.prototype._triggerEnvelopeRelease=function(t){this.envelope.triggerRelease(t);return this};t.Synth.prototype.dispose=function(){t.Monophonic.prototype.dispose.call(this);this._writable(["oscillator","frequency","detune","envelope"]);this.oscillator.dispose();this.oscillator=null;this.envelope.dispose();this.envelope=null;this.frequency=null;this.detune=null;return this};return t.Synth});i(function(t){t.AMSynth=function(e){e=this.defaultArg(e,t.AMSynth.defaults);t.Monophonic.call(this,e);this._carrier=new t.Synth;this._carrier.volume.value=-10;this.oscillator=this._carrier.oscillator;this.envelope=this._carrier.envelope.set(e.envelope);this._modulator=new t.Synth;this._modulator.volume.value=-10;this.modulation=this._modulator.oscillator.set(e.modulation);this.modulationEnvelope=this._modulator.envelope.set(e.modulationEnvelope);this.frequency=new t.Signal(440,t.Type.Frequency);this.detune=new t.Signal(e.detune,t.Type.Cents);this.harmonicity=new t.Multiply(e.harmonicity);this.harmonicity.units=t.Type.Positive;this._modulationScale=new t.AudioToGain;this._modulationNode=new t.Gain;this.frequency.connect(this._carrier.frequency);this.frequency.chain(this.harmonicity,this._modulator.frequency);this.detune.fan(this._carrier.detune,this._modulator.detune);this._modulator.chain(this._modulationScale,this._modulationNode.gain);this._carrier.chain(this._modulationNode,this.output);this._readOnly(["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"])};t.extend(t.AMSynth,t.Monophonic);t.AMSynth.defaults={harmonicity:3,detune:0,oscillator:{type:"sine"},envelope:{attack:.01,decay:.01,sustain:1,release:.5},moduation:{type:"square"},modulationEnvelope:{attack:.5,decay:0,sustain:1,release:.5}};t.AMSynth.prototype._triggerEnvelopeAttack=function(t,e){t=this.toSeconds(t);this.envelope.triggerAttack(t,e);this.modulationEnvelope.triggerAttack(t,e);return this};t.AMSynth.prototype._triggerEnvelopeRelease=function(t){this.envelope.triggerRelease(t);this.modulationEnvelope.triggerRelease(t);return this};t.AMSynth.prototype.dispose=function(){t.Monophonic.prototype.dispose.call(this);this._writable(["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"]);this._carrier.dispose();this._carrier=null;this._modulator.dispose();this._modulator=null;this.frequency.dispose();this.frequency=null;this.detune.dispose();this.detune=null;this.harmonicity.dispose();this.harmonicity=null;this._modulationScale.dispose();this._modulationScale=null;this._modulationNode.dispose();this._modulationNode=null;this.oscillator=null;this.envelope=null;this.modulationEnvelope=null;this.modulation=null;return this};return t.AMSynth});i(function(t){t.MonoSynth=function(e){e=this.defaultArg(e,t.MonoSynth.defaults);t.Monophonic.call(this,e);this.oscillator=new t.OmniOscillator(e.oscillator);this.frequency=this.oscillator.frequency;this.detune=this.oscillator.detune;this.filter=new t.Filter(e.filter);this.filterEnvelope=new t.FrequencyEnvelope(e.filterEnvelope);this.envelope=new t.AmplitudeEnvelope(e.envelope);this.oscillator.chain(this.filter,this.envelope,this.output);this.oscillator.start();this.filterEnvelope.connect(this.filter.frequency);this._readOnly(["oscillator","frequency","detune","filter","filterEnvelope","envelope"])};t.extend(t.MonoSynth,t.Monophonic);
t.MonoSynth.defaults={frequency:"C4",detune:0,oscillator:{type:"square"},filter:{Q:6,type:"lowpass",rolloff:-24},envelope:{attack:.005,decay:.1,sustain:.9,release:1},filterEnvelope:{attack:.06,decay:.2,sustain:.5,release:2,baseFrequency:200,octaves:7,exponent:2}};t.MonoSynth.prototype._triggerEnvelopeAttack=function(t,e){this.envelope.triggerAttack(t,e);this.filterEnvelope.triggerAttack(t);return this};t.MonoSynth.prototype._triggerEnvelopeRelease=function(t){this.envelope.triggerRelease(t);this.filterEnvelope.triggerRelease(t);return this};t.MonoSynth.prototype.dispose=function(){t.Monophonic.prototype.dispose.call(this);this._writable(["oscillator","frequency","detune","filter","filterEnvelope","envelope"]);this.oscillator.dispose();this.oscillator=null;this.envelope.dispose();this.envelope=null;this.filterEnvelope.dispose();this.filterEnvelope=null;this.filter.dispose();this.filter=null;this.frequency=null;this.detune=null;return this};return t.MonoSynth});i(function(t){t.DuoSynth=function(e){e=this.defaultArg(e,t.DuoSynth.defaults);t.Monophonic.call(this,e);this.voice0=new t.MonoSynth(e.voice0);this.voice0.volume.value=-10;this.voice1=new t.MonoSynth(e.voice1);this.voice1.volume.value=-10;this._vibrato=new t.LFO(e.vibratoRate,-50,50);this._vibrato.start();this.vibratoRate=this._vibrato.frequency;this._vibratoGain=new t.Gain(e.vibratoAmount,t.Type.Positive);this.vibratoAmount=this._vibratoGain.gain;this.frequency=new t.Signal(440,t.Type.Frequency);this.harmonicity=new t.Multiply(e.harmonicity);this.harmonicity.units=t.Type.Positive;this.frequency.connect(this.voice0.frequency);this.frequency.chain(this.harmonicity,this.voice1.frequency);this._vibrato.connect(this._vibratoGain);this._vibratoGain.fan(this.voice0.detune,this.voice1.detune);this.voice0.connect(this.output);this.voice1.connect(this.output);this._readOnly(["voice0","voice1","frequency","vibratoAmount","vibratoRate"])};t.extend(t.DuoSynth,t.Monophonic);t.DuoSynth.defaults={vibratoAmount:.5,vibratoRate:5,harmonicity:1.5,voice0:{volume:-10,portamento:0,oscillator:{type:"sine"},filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}},voice1:{volume:-10,portamento:0,oscillator:{type:"sine"},filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}}};t.DuoSynth.prototype._triggerEnvelopeAttack=function(t,e){t=this.toSeconds(t);this.voice0.envelope.triggerAttack(t,e);this.voice1.envelope.triggerAttack(t,e);this.voice0.filterEnvelope.triggerAttack(t);this.voice1.filterEnvelope.triggerAttack(t);return this};t.DuoSynth.prototype._triggerEnvelopeRelease=function(t){this.voice0.triggerRelease(t);this.voice1.triggerRelease(t);return this};t.DuoSynth.prototype.dispose=function(){t.Monophonic.prototype.dispose.call(this);this._writable(["voice0","voice1","frequency","vibratoAmount","vibratoRate"]);this.voice0.dispose();this.voice0=null;this.voice1.dispose();this.voice1=null;this.frequency.dispose();this.frequency=null;this._vibratoGain.dispose();this._vibratoGain=null;this._vibrato=null;this.harmonicity.dispose();this.harmonicity=null;this.vibratoAmount.dispose();this.vibratoAmount=null;this.vibratoRate=null;return this};return t.DuoSynth});i(function(t){t.FMSynth=function(e){e=this.defaultArg(e,t.FMSynth.defaults);t.Monophonic.call(this,e);this._carrier=new t.Synth(e.carrier);this._carrier.volume.value=-10;this.oscillator=this._carrier.oscillator;this.envelope=this._carrier.envelope.set(e.envelope);this._modulator=new t.Synth(e.modulator);this._modulator.volume.value=-10;this.modulation=this._modulator.oscillator.set(e.modulation);this.modulationEnvelope=this._modulator.envelope.set(e.modulationEnvelope);this.frequency=new t.Signal(440,t.Type.Frequency);this.detune=new t.Signal(e.detune,t.Type.Cents);this.harmonicity=new t.Multiply(e.harmonicity);this.harmonicity.units=t.Type.Positive;this.modulationIndex=new t.Multiply(e.modulationIndex);this.modulationIndex.units=t.Type.Positive;this._modulationNode=new t.Gain(0);this.frequency.connect(this._carrier.frequency);this.frequency.chain(this.harmonicity,this._modulator.frequency);this.frequency.chain(this.modulationIndex,this._modulationNode);this.detune.fan(this._carrier.detune,this._modulator.detune);this._modulator.connect(this._modulationNode.gain);this._modulationNode.connect(this._carrier.frequency);this._carrier.connect(this.output);this._readOnly(["frequency","harmonicity","modulationIndex","oscillator","envelope","modulation","modulationEnvelope","detune"])};t.extend(t.FMSynth,t.Monophonic);t.FMSynth.defaults={harmonicity:3,modulationIndex:10,detune:0,oscillator:{type:"sine"},envelope:{attack:.01,decay:.01,sustain:1,release:.5},moduation:{type:"square"},modulationEnvelope:{attack:.5,decay:0,sustain:1,release:.5}};t.FMSynth.prototype._triggerEnvelopeAttack=function(t,e){t=this.toSeconds(t);this.envelope.triggerAttack(t,e);this.modulationEnvelope.triggerAttack(t);return this};t.FMSynth.prototype._triggerEnvelopeRelease=function(t){t=this.toSeconds(t);this.envelope.triggerRelease(t);this.modulationEnvelope.triggerRelease(t);return this};t.FMSynth.prototype.dispose=function(){t.Monophonic.prototype.dispose.call(this);this._writable(["frequency","harmonicity","modulationIndex","oscillator","envelope","modulation","modulationEnvelope","detune"]);this._carrier.dispose();this._carrier=null;this._modulator.dispose();this._modulator=null;this.frequency.dispose();this.frequency=null;this.detune.dispose();this.detune=null;this.modulationIndex.dispose();this.modulationIndex=null;this.harmonicity.dispose();this.harmonicity=null;this._modulationNode.dispose();this._modulationNode=null;this.oscillator=null;this.envelope=null;this.modulationEnvelope=null;this.modulation=null;return this};return t.FMSynth});i(function(t){t.MembraneSynth=function(e){e=this.defaultArg(e,t.MembraneSynth.defaults);t.Instrument.call(this,e);this.oscillator=new t.Oscillator(e.oscillator).start();this.envelope=new t.AmplitudeEnvelope(e.envelope);this.octaves=e.octaves;this.pitchDecay=e.pitchDecay;this.oscillator.chain(this.envelope,this.output);this._readOnly(["oscillator","envelope"])};t.extend(t.MembraneSynth,t.Instrument);t.MembraneSynth.defaults={pitchDecay:.05,octaves:10,oscillator:{type:"sine"},envelope:{attack:.001,decay:.4,sustain:.01,release:1.4,attackCurve:"exponential"}};t.MembraneSynth.prototype.triggerAttack=function(t,e,i){e=this.toSeconds(e);t=this.toFrequency(t);var s=t*this.octaves;this.oscillator.frequency.setValueAtTime(s,e);this.oscillator.frequency.exponentialRampToValueAtTime(t,e+this.toSeconds(this.pitchDecay));this.envelope.triggerAttack(e,i);return this};t.MembraneSynth.prototype.triggerRelease=function(t){this.envelope.triggerRelease(t);return this};t.MembraneSynth.prototype.dispose=function(){t.Instrument.prototype.dispose.call(this);this._writable(["oscillator","envelope"]);this.oscillator.dispose();this.oscillator=null;this.envelope.dispose();this.envelope=null;return this};return t.MembraneSynth});i(function(t){var e=[1,1.483,1.932,2.546,2.63,3.897];t.MetalSynth=function(i){i=this.defaultArg(i,t.MetalSynth.defaults);t.Instrument.call(this,i);this.frequency=new t.Signal(i.frequency,t.Type.Frequency);this._oscillators=[];this._freqMultipliers=[];this._amplitue=new t.Gain(0).connect(this.output);this._highpass=new t.Filter({type:"highpass",Q:0}).connect(this._amplitue);this._octaves=i.octaves;this._filterFreqScaler=new t.Scale(i.resonance,7e3);this.envelope=new t.Envelope({attack:i.envelope.attack,attackCurve:"exponential",decay:i.envelope.decay,sustain:0,release:i.envelope.release}).chain(this._filterFreqScaler,this._highpass.frequency);this.envelope.connect(this._amplitue.gain);for(var s=0;s<e.length;s++){var n=new t.FMOscillator({type:"square",modulationType:"square",harmonicity:i.harmonicity,modulationIndex:i.modulationIndex});n.connect(this._highpass).start(0);this._oscillators[s]=n;var o=new t.Multiply(e[s]);this._freqMultipliers[s]=o;this.frequency.chain(o,n.frequency)}this.octaves=i.octaves};t.extend(t.MetalSynth,t.Instrument);t.MetalSynth.defaults={frequency:200,envelope:{attack:.0015,decay:1.4,release:.2},harmonicity:5.1,modulationIndex:32,resonance:4e3,octaves:1.5};t.MetalSynth.prototype.triggerAttack=function(t,e){t=this.toSeconds(t);e=this.defaultArg(e,1);this.envelope.triggerAttack(t,e);return this};t.MetalSynth.prototype.triggerRelease=function(t){t=this.toSeconds(t);this.envelope.triggerRelease(t);return this};t.MetalSynth.prototype.triggerAttackRelease=function(t,e,i){e=this.toSeconds(e);t=this.toSeconds(t);this.triggerAttack(e,i);this.triggerRelease(e+t);return this};Object.defineProperty(t.MetalSynth.prototype,"modulationIndex",{get:function(){return this._oscillators[0].modulationIndex.value},set:function(t){for(var e=0;e<this._oscillators.length;e++){this._oscillators[e].modulationIndex.value=t}}});Object.defineProperty(t.MetalSynth.prototype,"harmonicity",{get:function(){return this._oscillators[0].harmonicity.value},set:function(t){for(var e=0;e<this._oscillators.length;e++){this._oscillators[e].harmonicity.value=t}}});Object.defineProperty(t.MetalSynth.prototype,"resonance",{get:function(){return this._filterFreqScaler.min},set:function(t){this._filterFreqScaler.min=t;this.octaves=this._octaves}});Object.defineProperty(t.MetalSynth.prototype,"octaves",{get:function(){return this._octaves},set:function(t){this._octaves=t;this._filterFreqScaler.max=this._filterFreqScaler.min*Math.pow(2,t)}});t.MetalSynth.prototype.dispose=function(){t.Instrument.prototype.dispose.call(this);for(var e=0;e<this._oscillators.length;e++){this._oscillators[e].dispose();this._freqMultipliers[e].dispose()}this._oscillators=null;this._freqMultipliers=null;this.frequency.dispose();this.frequency=null;this._filterFreqScaler.dispose();this._filterFreqScaler=null;this._amplitue.dispose();this._amplitue=null;this.envelope.dispose();this.envelope=null;this._highpass.dispose();this._highpass=null};return t.MetalSynth});i(function(t){t.Noise=function(){var e=this.optionsObject(arguments,["type"],t.Noise.defaults);t.Source.call(this,e);this._source=null;this._buffer=null;this._playbackRate=e.playbackRate;this.type=e.type};t.extend(t.Noise,t.Source);t.Noise.defaults={type:"white",playbackRate:1};Object.defineProperty(t.Noise.prototype,"type",{get:function(){if(this._buffer===s){return"white"}else if(this._buffer===i){return"brown"}else if(this._buffer===e){return"pink"}},set:function(n){if(this.type!==n){switch(n){case"white":this._buffer=s;break;case"pink":this._buffer=e;break;case"brown":this._buffer=i;break;default:throw new TypeError("Tone.Noise: invalid type: "+n)}if(this.state===t.State.Started){var o=this.now()+this.blockTime;this._stop(o);this._start(o)}}}});Object.defineProperty(t.Noise.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(t){this._playbackRate=t;if(this._source){this._source.playbackRate.value=t}}});t.Noise.prototype._start=function(t){this._source=this.context.createBufferSource();this._source.buffer=this._buffer;this._source.loop=true;this._source.playbackRate.value=this._playbackRate;this._source.connect(this.output);this._source.start(this.toSeconds(t),Math.random()*(this._buffer.duration-.001))};t.Noise.prototype._stop=function(t){if(this._source){this._source.stop(this.toSeconds(t))}};t.Noise.prototype.dispose=function(){t.Source.prototype.dispose.call(this);if(this._source!==null){this._source.disconnect();this._source=null}this._buffer=null;return this};var e=null,i=null,s=null;t._initAudioContext(function(t){var n=t.sampleRate;var o=n*4;e=function(){var e=t.createBuffer(2,o,n);for(var i=0;i<e.numberOfChannels;i++){var s=e.getChannelData(i);var r,a,l,h,u,p,c;r=a=l=h=u=p=c=0;for(var f=0;f<o;f++){var d=Math.random()*2-1;r=.99886*r+d*.0555179;a=.99332*a+d*.0750759;l=.969*l+d*.153852;h=.8665*h+d*.3104856;u=.55*u+d*.5329522;p=-.7616*p-d*.016898;s[f]=r+a+l+h+u+p+c+d*.5362;s[f]*=.11;c=d*.115926}}return e}();i=function(){var e=t.createBuffer(2,o,n);for(var i=0;i<e.numberOfChannels;i++){var s=e.getChannelData(i);var r=0;for(var a=0;a<o;a++){var l=Math.random()*2-1;s[a]=(r+.02*l)/1.02;r=s[a];s[a]*=3.5}}return e}();s=function(){var e=t.createBuffer(2,o,n);for(var i=0;i<e.numberOfChannels;i++){var s=e.getChannelData(i);for(var r=0;r<o;r++){s[r]=Math.random()*2-1}}return e}()});return t.Noise});i(function(t){t.NoiseSynth=function(e){e=this.defaultArg(e,t.NoiseSynth.defaults);t.Instrument.call(this,e);this.noise=new t.Noise;this.envelope=new t.AmplitudeEnvelope(e.envelope);this.noise.chain(this.envelope,this.output);this.noise.start();this._readOnly(["noise","envelope"])};t.extend(t.NoiseSynth,t.Instrument);t.NoiseSynth.defaults={noise:{type:"white"},envelope:{attack:.005,decay:.1,sustain:0}};t.NoiseSynth.prototype.triggerAttack=function(t,e){this.envelope.triggerAttack(t,e);return this};t.NoiseSynth.prototype.triggerRelease=function(t){this.envelope.triggerRelease(t);return this};t.NoiseSynth.prototype.triggerAttackRelease=function(t,e,i){e=this.toSeconds(e);t=this.toSeconds(t);this.triggerAttack(e,i);this.triggerRelease(e+t);return this};t.NoiseSynth.prototype.dispose=function(){t.Instrument.prototype.dispose.call(this);this._writable(["noise","envelope"]);this.noise.dispose();this.noise=null;this.envelope.dispose();this.envelope=null;return this};return t.NoiseSynth});i(function(t){t.PluckSynth=function(e){e=this.defaultArg(e,t.PluckSynth.defaults);t.Instrument.call(this,e);this._noise=new t.Noise("pink");this.attackNoise=1;this._lfcf=new t.LowpassCombFilter({resonance:e.resonance,dampening:e.dampening});this.resonance=this._lfcf.resonance;this.dampening=this._lfcf.dampening;this._noise.connect(this._lfcf);this._lfcf.connect(this.output);this._readOnly(["resonance","dampening"])};t.extend(t.PluckSynth,t.Instrument);t.PluckSynth.defaults={attackNoise:1,dampening:4e3,resonance:.9};t.PluckSynth.prototype.triggerAttack=function(t,e){t=this.toFrequency(t);e=this.toSeconds(e);var i=1/t;this._lfcf.delayTime.setValueAtTime(i,e);this._noise.start(e);this._noise.stop(e+i*this.attackNoise);return this};t.PluckSynth.prototype.dispose=function(){t.Instrument.prototype.dispose.call(this);this._noise.dispose();this._lfcf.dispose();this._noise=null;this._lfcf=null;this._writable(["resonance","dampening"]);this.dampening=null;this.resonance=null;return this};return t.PluckSynth});i(function(t){t.PolySynth=function(){t.Instrument.call(this);var e=this.optionsObject(arguments,["polyphony","voice"],t.PolySynth.defaults);e=this.defaultArg(e,t.Instrument.defaults);e.polyphony=Math.min(t.PolySynth.MAX_POLYPHONY,e.polyphony);this.voices=new Array(e.polyphony);this._triggers=new Array(e.polyphony);this.detune=new t.Signal(e.detune,t.Type.Cents);this._readOnly("detune");for(var i=0;i<e.polyphony;i++){var s=new e.voice(arguments[2],arguments[3]);this.voices[i]=s;s.connect(this.output);if(s.hasOwnProperty("detune")){this.detune.connect(s.detune)}this._triggers[i]={release:-1,note:null,voice:s}}this.volume.value=e.volume};t.extend(t.PolySynth,t.Instrument);t.PolySynth.defaults={polyphony:4,volume:0,detune:0,voice:t.Synth};t.PolySynth.prototype.triggerAttack=function(t,e,i){if(!Array.isArray(t)){t=[t]}e=this.toSeconds(e);for(var s=0;s<t.length;s++){var n=t[s];var o=this._triggers[0];var r=0;for(var a=1;a<this._triggers.length;a++){if(this._triggers[a].release<o.release){o=this._triggers[a];r=a}}o.release=Infinity;o.note=JSON.stringify(n);o.voice.triggerAttack(n,e,i)}return this};t.PolySynth.prototype.triggerAttackRelease=function(t,e,i,s){i=this.toSeconds(i);this.triggerAttack(t,i,s);if(this.isArray(e)&&this.isArray(t)){for(var n=0;n<t.length;n++){var o=e[Math.min(n,e.length-1)];this.triggerRelease(t[n],i+this.toSeconds(o))}}else{this.triggerRelease(t,i+this.toSeconds(e))}return this};t.PolySynth.prototype.triggerRelease=function(t,e){if(!Array.isArray(t)){t=[t]}e=this.toSeconds(e);for(var i=0;i<t.length;i++){var s=JSON.stringify(t[i]);for(var n=0;n<this._triggers.length;n++){var o=this._triggers[n];if(o.note===s&&o.release>e){o.voice.triggerRelease(e);o.release=e}}}return this};t.PolySynth.prototype.set=function(t,e,i){for(var s=0;s<this.voices.length;s++){this.voices[s].set(t,e,i)}return this};t.PolySynth.prototype.get=function(t){return this.voices[0].get(t)};t.PolySynth.prototype.releaseAll=function(t){t=this.toSeconds(t);for(var e=0;e<this._triggers.length;e++){var i=this._triggers[e];if(i.release>t){i.release=t;i.voice.triggerRelease(t)}}return this};t.PolySynth.prototype.dispose=function(){t.Instrument.prototype.dispose.call(this);for(var e=0;e<this.voices.length;e++){this.voices[e].dispose();this.voices[e]=null}this._writable("detune");this.detune.dispose();this.detune=null;this.voices=null;this._triggers=null;return this};t.PolySynth.MAX_POLYPHONY=20;return t.PolySynth});i(function(t){t.Player=function(e){var i;if(e instanceof t.Buffer){e=e.get();i=t.Player.defaults}else{i=this.optionsObject(arguments,["url","onload"],t.Player.defaults)}t.Source.call(this,i);this._source=null;this.autostart=i.autostart;this._buffer=new t.Buffer({url:i.url,onload:this._onload.bind(this,i.onload),reverse:i.reverse});if(e instanceof AudioBuffer){this._buffer.set(e)}this._loop=i.loop;this._loopStart=i.loopStart;this._loopEnd=i.loopEnd;this._playbackRate=i.playbackRate;this.retrigger=i.retrigger};t.extend(t.Player,t.Source);t.Player.defaults={onload:t.noOp,playbackRate:1,loop:false,autostart:false,loopStart:0,loopEnd:0,retrigger:false,reverse:false};t.Player.prototype.load=function(t,e){this._buffer.load(t,this._onload.bind(this,e));return this};t.Player.prototype._onload=function(t){t(this);if(this.autostart){this.start()}};t.Player.prototype._start=function(e,i,s){if(this._buffer.loaded){if(this._loop){i=this.defaultArg(i,this._loopStart)}else{i=this.defaultArg(i,0)}i=this.toSeconds(i);s=this.defaultArg(s,Math.max(this._buffer.duration-i,0));s=this.toSeconds(s);e=this.toSeconds(e);this._source=this.context.createBufferSource();this._source.buffer=this._buffer.get();if(this._loop){this._source.loop=this._loop;this._source.loopStart=this.toSeconds(this._loopStart);this._source.loopEnd=this.toSeconds(this._loopEnd)}else{this._state.setStateAtTime(t.State.Stopped,e+s)}this._source.playbackRate.value=this._playbackRate;this._source.connect(this.output);if(this._loop){var n=this._source.loopEnd||this._buffer.duration;var o=this._source.loopStart;var r=n-o;if(i>r){i=o+i%r;if(i>n){i-=r}}this._source.start(e,i)}else{this._source.start(e,i,s)}}else{throw Error("Tone.Player: tried to start Player before the buffer was loaded")}return this};t.Player.prototype._stop=function(t){if(this._source){this._source.stop(this.toSeconds(t));this._source=null}return this};t.Player.prototype.seek=function(e,i){i=this.toSeconds(i);if(this._state.getStateAtTime(i)===t.State.Started){e=this.toSeconds(e);this._stop(i);this._start(i,e)}return this};t.Player.prototype.setLoopPoints=function(t,e){this.loopStart=t;this.loopEnd=e;return this};Object.defineProperty(t.Player.prototype,"loopStart",{get:function(){return this._loopStart},set:function(t){this._loopStart=t;if(this._source){this._source.loopStart=this.toSeconds(t)}}});Object.defineProperty(t.Player.prototype,"loopEnd",{get:function(){return this._loopEnd},set:function(t){this._loopEnd=t;if(this._source){this._source.loopEnd=this.toSeconds(t)}}});Object.defineProperty(t.Player.prototype,"buffer",{get:function(){return this._buffer},set:function(t){this._buffer.set(t)}});Object.defineProperty(t.Player.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=t;if(this._source){this._source.loop=t}}});Object.defineProperty(t.Player.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(t){this._playbackRate=t;if(this._source){this._source.playbackRate.value=t}}});Object.defineProperty(t.Player.prototype,"reverse",{get:function(){return this._buffer.reverse},set:function(t){this._buffer.reverse=t}});t.Player.prototype.dispose=function(){t.Source.prototype.dispose.call(this);if(this._source!==null){this._source.disconnect();this._source=null}this._buffer.dispose();this._buffer=null;return this};return t.Player});i(function(t){t.Sampler=function(){var e=this.optionsObject(arguments,["url","onload"],t.Sampler.defaults);t.Instrument.call(this,e);this.player=new t.Player(e.url,e.onload);this.player.retrigger=true;this.envelope=new t.AmplitudeEnvelope(e.envelope);this.player.chain(this.envelope,this.output);this._readOnly(["player","envelope"]);this.loop=e.loop;this.reverse=e.reverse};t.extend(t.Sampler,t.Instrument);t.Sampler.defaults={onload:t.noOp,loop:false,reverse:false,envelope:{attack:.001,decay:0,sustain:1,release:.1}};t.Sampler.prototype.triggerAttack=function(t,e,i){e=this.toSeconds(e);t=this.defaultArg(t,0);this.player.playbackRate=this.intervalToFrequencyRatio(t);this.player.start(e);this.envelope.triggerAttack(e,i);return this};t.Sampler.prototype.triggerRelease=function(t){t=this.toSeconds(t);this.envelope.triggerRelease(t);this.player.stop(this.toSeconds(this.envelope.release)+t);return this};Object.defineProperty(t.Sampler.prototype,"loop",{get:function(){return this.player.loop},set:function(t){this.player.loop=t}});Object.defineProperty(t.Sampler.prototype,"reverse",{get:function(){return this.player.reverse},set:function(t){this.player.reverse=t}});Object.defineProperty(t.Sampler.prototype,"buffer",{get:function(){return this.player.buffer},set:function(t){this.player.buffer=t}});t.Sampler.prototype.dispose=function(){t.Instrument.prototype.dispose.call(this);this._writable(["player","envelope"]);this.player.dispose();this.player=null;this.envelope.dispose();this.envelope=null;return this};return t.Sampler});i(function(t){t.SimpleSynth=function(e){console.warn("Tone.SimpleSynth is now called Tone.Synth");t.Synth.call(this,e)};t.extend(t.SimpleSynth,t.Synth);return t.SimpleSynth});i(function(t){t.GainToAudio=function(){this._norm=this.input=this.output=new t.WaveShaper(function(t){return Math.abs(t)*2-1})};t.extend(t.GainToAudio,t.SignalBase);t.GainToAudio.prototype.dispose=function(){t.prototype.dispose.call(this);this._norm.dispose();this._norm=null;return this};return t.GainToAudio});i(function(t){t.Normalize=function(e,i){this._inputMin=this.defaultArg(e,0);this._inputMax=this.defaultArg(i,1);this._sub=this.input=new t.Add(0);this._div=this.output=new t.Multiply(1);this._sub.connect(this._div);this._setRange()};t.extend(t.Normalize,t.SignalBase);Object.defineProperty(t.Normalize.prototype,"min",{get:function(){return this._inputMin},set:function(t){this._inputMin=t;this._setRange()}});Object.defineProperty(t.Normalize.prototype,"max",{get:function(){return this._inputMax},set:function(t){this._inputMax=t;this._setRange()}});t.Normalize.prototype._setRange=function(){this._sub.value=-this._inputMin;this._div.value=1/(this._inputMax-this._inputMin)};t.Normalize.prototype.dispose=function(){t.prototype.dispose.call(this);this._sub.dispose();this._sub=null;this._div.dispose();this._div=null;return this};return t.Normalize});i(function(t){t.BufferSource=function(){var e=this.optionsObject(arguments,["buffer","onended"],t.BufferSource.defaults);this.onended=e.onended;this._startTime=-1;this._gainNode=this.output=new t.Gain;this._source=this.context.createBufferSource();this._source.connect(this._gainNode);this._source.onended=this._onended.bind(this);this.playbackRate=new t.Param(this._source.playbackRate,t.Type.Positive);this.fadeIn=e.fadeIn;this.fadeOut=e.fadeOut;this._gain=1;if(!this.isUndef(e.buffer)){this.buffer=e.buffer}this.loop=e.loop};t.extend(t.BufferSource);t.BufferSource.defaults={onended:t.noOp,fadeIn:0,fadeOut:0};Object.defineProperty(t.BufferSource.prototype,"state",{get:function(){var e=this.now();if(this._startTime!==-1&&e>this._startTime){return t.State.Started}else{return t.State.Stopped}}});t.BufferSource.prototype.start=function(t,e,i,s,n){if(this._startTime!==-1){throw new Error("Tone.BufferSource: can only be started once.")}if(this.buffer){t=this.toSeconds(t);if(this.loop){e=this.defaultArg(e,this.loopStart)}else{e=this.defaultArg(e,0)}e=this.toSeconds(e);t=this.toSeconds(t);this._source.start(t,e);s=this.defaultArg(s,1);this._gain=s;if(this.isUndef(n)){n=this.toSeconds(this.fadeIn)}else{n=this.toSeconds(n)}if(n>0){this._gainNode.gain.setValueAtTime(0,t);this._gainNode.gain.linearRampToValueAtTime(this._gain,t+n)}else{this._gainNode.gain.setValueAtTime(s,t)}this._startTime=t+n;if(!this.isUndef(i)){i=this.defaultArg(i,this.buffer.duration-e);i=this.toSeconds(i);this.stop(t+i+n,n)}}return this};t.BufferSource.prototype.stop=function(t,e){if(this.buffer){t=this.toSeconds(t);if(this.isUndef(e)){e=this.toSeconds(this.fadeOut)}else{e=this.toSeconds(e)}this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime);if(e>0){this._gainNode.gain.setValueAtTime(this._gain,t);this._gainNode.gain.linearRampToValueAtTime(0,t+e);t+=e}else{this._gainNode.gain.setValueAtTime(0,t)}if(!this.isNumber(this._source.playbackState)||this._source.playbackState===2){this._source.stop(t)}}return this};t.BufferSource.prototype._onended=function(){this.onended(this);this.dispose()};Object.defineProperty(t.BufferSource.prototype,"loopStart",{get:function(){return this._source.loopStart},set:function(t){this._source.loopStart=this.toSeconds(t)}});Object.defineProperty(t.BufferSource.prototype,"loopEnd",{get:function(){return this._source.loopEnd},set:function(t){this._source.loopEnd=this.toSeconds(t)}});Object.defineProperty(t.BufferSource.prototype,"buffer",{get:function(){if(this._source){return this._source.buffer}else{return null}},set:function(e){if(e instanceof t.Buffer){this._source.buffer=e.get()}else{this._source.buffer=e}}});Object.defineProperty(t.BufferSource.prototype,"loop",{get:function(){return this._source.loop},set:function(t){this._source.loop=t}});t.BufferSource.prototype.dispose=function(){this.onended=null;if(this._source){this._source.onended=null;this._source.disconnect();this._source=null}if(this._gainNode){this._gainNode.dispose();this._gainNode=null}this._startTime=-1;this.playbackRate=null;this.output=null;return this};return t.BufferSource});i(function(t){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;t.ExternalInput=function(){var e=this.optionsObject(arguments,["inputNum"],t.ExternalInput.defaults);t.Source.call(this,e);this._mediaStream=null;this._stream=null;this._constraints={audio:true};this._inputNum=e.inputNum;this._gate=new t.Gain(0).connect(this.output)};t.extend(t.ExternalInput,t.Source);t.ExternalInput.defaults={inputNum:0};t.ExternalInput.prototype._getUserMedia=function(e,i){if(!t.ExternalInput.supported){i("browser does not support 'getUserMedia'")}if(t.ExternalInput.sources[this._inputNum]){this._constraints={audio:{optional:[{sourceId:t.ExternalInput.sources[this._inputNum].id}]}}}navigator.getUserMedia(this._constraints,function(t){this._onStream(t);e()}.bind(this),function(t){i(t)})};t.ExternalInput.prototype._onStream=function(t){if(!this.isFunction(this.context.createMediaStreamSource)){throw new Error("Tone.ExternalInput: browser does not support the 'MediaStreamSourceNode'")}if(!this._stream){this._stream=t;this._mediaStream=this.context.createMediaStreamSource(t);this._mediaStream.connect(this._gate)}};t.ExternalInput.prototype.open=function(e,i){e=this.defaultArg(e,t.noOp);i=this.defaultArg(i,t.noOp);t.ExternalInput.getSources(function(){this._getUserMedia(e,i)}.bind(this));return this};t.ExternalInput.prototype.close=function(){if(this._stream){var t=this._stream.getTracks()[this._inputNum];if(!this.isUndef(t)){t.stop()}this._stream=null}return this};t.ExternalInput.prototype._start=function(t){t=this.toSeconds(t);this._gate.gain.setValueAtTime(1,t);return this};t.ExternalInput.prototype._stop=function(t){t=this.toSeconds(t);this._gate.gain.setValueAtTime(0,t);return this};t.ExternalInput.prototype.dispose=function(){t.Source.prototype.dispose.call(this);this.close();if(this._mediaStream){this._mediaStream.disconnect();this._mediaStream=null}this._constraints=null;this._gate.dispose();this._gate=null;return this};t.ExternalInput.sources=[];t.ExternalInput._canGetSources=!t.prototype.isUndef(window.MediaStreamTrack)&&t.prototype.isFunction(MediaStreamTrack.getSources);Object.defineProperty(t.ExternalInput,"supported",{get:function(){return t.prototype.isFunction(navigator.getUserMedia)}});t.ExternalInput.getSources=function(e){if(t.ExternalInput.sources.length===0&&t.ExternalInput._canGetSources){MediaStreamTrack.getSources(function(i){for(var s=0;s<i.length;s++){if(i[s].kind==="audio"){t.ExternalInput.sources[s]=i[s]}}e(t.ExternalInput.sources)})}else{e(t.ExternalInput.sources)}return this};return t.ExternalInput});i(function(t){t.MultiPlayer=function(){var e=this.optionsObject(arguments,["urls","onload"],t.MultiPlayer.defaults);if(e.urls instanceof t.Buffers){this.buffers=e.urls}else{this.buffers=new t.Buffers(e.urls,e.onload)}this._activeSources=[];this.fadeIn=e.fadeIn;this.fadeOut=e.fadeOut;this._volume=this.output=new t.Volume(e.volume);this.volume=this._volume.volume;this._readOnly("volume");this._volume.output.output.channelCount=2;this._volume.output.output.channelCountMode="explicit";this.mute=e.mute};t.extend(t.MultiPlayer,t.Source);t.MultiPlayer.defaults={onload:t.noOp,fadeIn:0,fadeOut:0};t.MultiPlayer.prototype._getBuffer=function(e){if(this.isNumber(e)||this.isString(e)){return this.buffers.get(e).get()}else if(e instanceof t.Buffer){return e.get()}else{return e}};t.MultiPlayer.prototype.start=function(e,i,s,n,o,r){e=this._getBuffer(e);var a=new t.BufferSource(e).connect(this.output);this._activeSources.push(a);i=this.toSeconds(i);a.start(i,s,n,this.defaultArg(r,1),this.fadeIn);if(n){a.stop(i+this.toSeconds(n),this.fadeOut)}a.onended=this._onended.bind(this);o=this.defaultArg(o,0);a.playbackRate.value=this.intervalToFrequencyRatio(o);return this};t.MultiPlayer.prototype.startLoop=function(e,i,s,n,o,r,a){e=this._getBuffer(e);var l=new t.BufferSource(e).connect(this.output);this._activeSources.push(l);i=this.toSeconds(i);l.loop=true;l.loopStart=this.toSeconds(this.defaultArg(n,0));l.loopEnd=this.toSeconds(this.defaultArg(o,0));l.start(i,s,undefined,this.defaultArg(a,1),this.fadeIn);l.onended=this._onended.bind(this);r=this.defaultArg(r,0);l.playbackRate.value=this.intervalToFrequencyRatio(r);return this};t.MultiPlayer.prototype._onended=function(t){var e=this._activeSources.indexOf(t);this._activeSources.splice(e,1)};t.MultiPlayer.prototype.stop=function(t,e){t=this._getBuffer(t);e=this.toSeconds(e);for(var i=0;i<this._activeSources.length;i++){if(this._activeSources[i].buffer===t){this._activeSources[i].stop(e,this.fadeOut)}}return this};t.MultiPlayer.prototype.stopAll=function(t){t=this.toSeconds(t);for(var e=0;e<this._activeSources.length;e++){this._activeSources[e].stop(t,this.fadeOut)}return this};t.MultiPlayer.prototype.add=function(t,e,i){this.buffers.add(t,e,i);return this};Object.defineProperty(t.MultiPlayer.prototype,"state",{get:function(){return this._activeSources.length>0?t.State.Started:t.State.Stopped}});Object.defineProperty(t.MultiPlayer.prototype,"mute",{get:function(){return this._volume.mute},set:function(t){this._volume.mute=t}});t.MultiPlayer.prototype.dispose=function(){t.prototype.dispose.call(this);this._volume.dispose();this._volume=null;this._writable("volume");this.volume=null;this.buffers.dispose();this.buffers=null;for(var e=0;e<this._activeSources.length;e++){this._activeSources[e].dispose()}this._activeSources=null;return this};return t.MultiPlayer});i(function(t){t.GrainPlayer=function(){var e=this.optionsObject(arguments,["url","onload"],t.GrainPlayer.defaults);t.Source.call(this);this.buffer=new t.Buffer(e.url,e.onload);this._player=this.output=new t.MultiPlayer;this._clock=new t.Clock(this._tick.bind(this),1);this._loopStart=0;this._loopEnd=0;this._playbackRate=e.playbackRate;this._grainSize=e.grainSize;this._overlap=e.overlap;this.detune=e.detune;
this.drift=e.drift;this.overlap=e.overlap;this.loop=e.loop;this.playbackRate=e.playbackRate;this.grainSize=e.grainSize;this.loopStart=e.loopStart;this.loopEnd=e.loopEnd;this.reverse=e.reverse};t.extend(t.GrainPlayer,t.Source);t.GrainPlayer.defaults={onload:t.noOp,overlap:.1,grainSize:.2,drift:0,playbackRate:1,detune:0,loop:false,loopStart:0,loopEnd:0,reverse:false};t.GrainPlayer.prototype._start=function(t,e){e=this.defaultArg(e,0);e=this.toSeconds(e);t=this.toSeconds(t);this._offset=e;this._clock.start(t)};t.GrainPlayer.prototype._stop=function(t){this._clock.stop(t);this._player.stop(this.buffer,t);this._offset=0};t.GrainPlayer.prototype._tick=function(t){var e=this.buffer.duration;if(this.loop&&this._loopEnd>0){e=this._loopEnd}var i=(Math.random()*2-1)*this.drift;var s=this._offset-this._overlap+i;var n=this.detune/100;var o=this._player.fadeIn;if(this.loop&&this._offset>e){var r=this._offset-e;this._player.start(this.buffer,t,s,r+this._overlap,n);s=this._offset%e;this._offset=this._loopStart;this._player.fadeIn=0;this._player.start(this.buffer,t+r,this._offset,s+this._overlap,n)}else if(this._offset>e){this.stop(t)}else{if(s<0){this._player.fadeIn=Math.max(this._player.fadeIn+s,0);s=0}this._player.start(this.buffer,t,s,this.grainSize+this._overlap,n)}this._player.fadeIn=o;var a=this._clock._nextTick-t;this._offset+=a*this._playbackRate};t.GrainPlayer.prototype.scrub=function(t,e){this._offset=this.toSeconds(t);this._tick(this.toSeconds(e));return this};Object.defineProperty(t.GrainPlayer.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(t){this._playbackRate=t;this.grainSize=this._grainSize}});Object.defineProperty(t.GrainPlayer.prototype,"loopStart",{get:function(){return this._loopStart},set:function(t){this._loopStart=this.toSeconds(t)}});Object.defineProperty(t.GrainPlayer.prototype,"loopEnd",{get:function(){return this._loopEnd},set:function(t){this._loopEnd=this.toSeconds(t)}});Object.defineProperty(t.GrainPlayer.prototype,"reverse",{get:function(){return this.buffer.reverse},set:function(t){this.buffer.reverse=t}});Object.defineProperty(t.GrainPlayer.prototype,"grainSize",{get:function(){return this._grainSize},set:function(t){this._grainSize=this.toSeconds(t);this._clock.frequency.value=this._playbackRate/this._grainSize}});Object.defineProperty(t.GrainPlayer.prototype,"overlap",{get:function(){return this._overlap},set:function(t){t=this.toSeconds(t);this._overlap=t;if(this._overlap<0){this._player.fadeIn=.01;this._player.fadeOut=.01}else{this._player.fadeIn=t;this._player.fadeOut=t}}});t.GrainPlayer.prototype.dispose=function(){t.Source.prototype.dispose.call(this);this.buffer.dispose();this.buffer=null;this._player.dispose();this._player=null;this._clock.dispose();this._clock=null;return this};return t.GrainPlayer});i(function(t){t.Microphone=function(){t.ExternalInput.call(this,0)};t.extend(t.Microphone,t.ExternalInput);Object.defineProperty(t.Microphone,"supported",{get:function(){return t.ExternalInput.supported}});return t.Microphone});return t})},{}],4:[function(t,e,i){"use strict";var s=t("./utilities/Caller");var n=function(){function t(t){var e=this;this.events={onInputChange:new s.default,onMessage:new s.default,onNote:new s.default,onPad:new s.default,onPitchBend:new s.default,onModWheel:new s.default};this.access=t.access;this.curateMidiInputs();this.access.onstatechange=function(){return e.curateMidiInputs()}}t.prototype.subscribe=function(t){var e=this;for(var i in this.events)if(this.events[i]&&t[i])this.events[i].add(t[i]);return function(){for(var i in e.events)if(e.events[i]&&t[i])e.events[i].remove(t[i])}};t.prototype.clear=function(){for(var t in this.events)this.events[t].clear()};t.prototype.curateMidiInputs=function(){var t=this;var e=[];var i=0;for(var s=0,n=Array.from(this.access.inputs.values());s<n.length;s++){var o=n[s];o.onmidimessage=function(e){return t.handleMidiMessage(e)};e.push(o.name);if(o.state==="connected"&&o.connection==="open")i+=1}if(i!==this.numberOfActiveInputs){this.events.onInputChange.invoke({inputNames:e});this.numberOfActiveInputs=i}};t.prototype.parseMidiMessage=function(t){return{data:t.data,command:t.data[0]>>4,channel:t.data[0]&15,code:t.data[1],value:t.data[2]/127}};t.prototype.noteCodeToFrequency=function(t){return 440*Math.pow(2,(t-69)/12)};t.prototype.handleMidiMessage=function(t){var e=this.parseMidiMessage(t);var i=e.data,s=e.command,n=e.channel,o=e.code,r=e.value;this.events.onMessage.invoke(e);if(s===8||s===9){var a=s===9;var l=a?r:-r;if(n===0||n===15)this.events.onNote.invoke({code:o,velocity:l,frequency:this.noteCodeToFrequency(o)});else if(n===9)this.events.onPad.invoke({code:o,velocity:l})}else if(s===11){if(o===1)this.events.onModWheel.invoke({value:r})}else if(s===14){this.events.onPitchBend.invoke({value:r})}};return t}();Object.defineProperty(i,"__esModule",{value:true});i.default=n},{"./utilities/Caller":5}],5:[function(t,e,i){"use strict";var s=function(){function t(){this.callbacks=[]}t.prototype.add=function(t){this.callbacks.push(t)};t.prototype.remove=function(t){this.callbacks=this.callbacks.filter(function(e){return e!==t})};t.prototype.clear=function(){this.callbacks=[]};t.prototype.invoke=function(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}for(var i=0,s=this.callbacks;i<s.length;i++){var n=s[i];n.apply(null,t)}};return t}();Object.defineProperty(i,"__esModule",{value:true});i.default=s},{}]},{},[2]);
